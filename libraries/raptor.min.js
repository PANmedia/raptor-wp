!function(){function e(){var e=Array.prototype.slice.call(arguments);e.unshift("[Raptor]: "),(console.debug||console.log).apply(console,e)}function t(e){if(!console||!console.error)throw e;var t=Array.prototype.slice.call(arguments);if(console.error.apply)console.error.apply(console,t),t[0]instanceof Error&&(console.error.apply(console,[t[0].toString()]),console.error.apply(console,[t[0].stack]));else for(var i=0,n=t.length;n>i;i++)console.error(t[i])}function n(e,i){t(e+", got: ",i,typeof i)}function o(i){i.prototype.events={},i.prototype.bindOptions=function(e){for(var t in e)this.bind(t,e[t])},i.prototype.bind=function(e,i){if("undefined"==typeof i||!Oo.isFunction(i))return t("Must bind a valid callback, "+e+" was a "+typeof i),void 0;for(var n=e.split(/,\s*/),o=0,s=n.length;s>o;o++)this.events[n[o]]||(this.events[n[o]]=[]),this.events[n[o]].push(i)},i.prototype.fire=function(t,i){var n=[];if(xo===ko&&e("Firing event: "+t),this.events[t])for(var o=0;o<this.events[t].length;o++){var s=this.events[t][o],a=s.apply(this,i);"undefined"!=typeof a&&(n=n.concat(a))}return n}}function s(e,t){"undefined"==typeof t&&(t=2);for(var i=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],n=0;e>1024&&8>n;n++)e/=1024;return Math.round(e,t)+" "+i[n]}function a(e,i,n){Io[e]&&t("Locale "+e+" has already been registered, and will be overwritten."),xo>To&&t("Locale "+e+" registered."),Io[e]=n,Do[e]=i}function r(e,i,n){if("undefined"==typeof Io[e])a(e,i,n);else{xo>To&&t("Locale "+e+" extended."),n=n||i;for(var o in n)Io[e][o]=n[o]}}function l(t){So!==t&&(e("Changing locale",t),So=t,Go.eachInstance(function(){this.localeChange()}))}function d(e,i){if("undefined"!=typeof Io[So]&&"undefined"!=typeof Io[So][e])return Io[So][e];if("undefined"!=typeof Io[Po]&&"undefined"!=typeof Io[Po][e])return Io[Po][e];for(var n in Do)if("undefined"!=typeof Io[n][e])return Io[n][e];return i?!1:(xo>=To&&t("Missing locale string: "+e),e)}function c(e,t){if(!So){var i=Go.persist("locale");i&&(So=i)}if(So||(So="en"),e=d(e,t===!1),e===!1)return!1;if(t){for(var n in t)e=e.replace("{{"+n+"}}",t[n]);return e}return e}function u(e){if(!e||!e.id){var t;do t="ruid-"+Math.random().toString().replace(".","");while(document.getElementById(t));if(!e)return t;e.id=t}return e.id}function p(e,t){return h(e,t)[0]}function h(e,t){var i=document.createElement(t||"div");return i.innerHTML=e,i.children}function g(e,t,i){e.classList.add(t),e.classList.remove(i)}function m(e){var t=0;do{if("BODY"===e.tagName)break;t+=e.offsetTop,e=e.offsetParent}while(e);return t}function f(e){for(var t in e)this[t]=e[t]}function v(e){e.registerPlugin=function(e){return"object"!=typeof e?(t('Plugin "'+e+'" is invalid (must be an object)'),void 0):"string"!=typeof e.name?(t('Plugin "'+e+'" is invalid (must have a name property)'),void 0):(this.prototype.plugins[e.name]&&t('Plugin "'+e.name+'" has already been registered, and will be overwritten'),this.prototype.plugins[e.name]=e,void 0)},e.prototype.plugins={},e.prototype.pluginInstances={}}function y(e,i,n,o){var s=Oo.extend({},i),a=Oo.extend({},e.options,{baseClass:"raptor-plugin-"+T(i.name)},s.options,n);s.pluggable=e,s.options=a;for(var r in o)s[r]=o[r];s.init||t("Component missing init function: "+s.name);var l=s.init();return{ui:l,instance:s}}function b(e,t){t?Lo[e]=t:delete Lo[e]}function C(e){var t=!1;for(var i in Lo)"function"==typeof Lo[i]?Lo[i]()&&(t=!0):Lo[i]&&(t=!0);if(t){var n="There are unsaved changes on this page. Are you sure you wish to navigate away?";return(e||window.event).returnValue=n,n}}function w(e){return e.charAt(0).toUpperCase()+e.slice(1)}function T(e,t){return e.replace(/([A-Z])/g,function(e){return(t||"-")+e.toLowerCase()})}function E(e){return No[e]}function k(e,i){return e=e.replace(/tr\(['"]{1}(.*?)['"]{1}\)/g,function(e,t){return t=t.replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}}),c(t)}),i=Oo.extend({},this.options,i||{}),i=x(i),e=e.replace(/\{\{(.*?)\}\}/g,function(e,n){return"undefined"==typeof i[n]&&t(new Error("Missing template variable: "+n)),i[n]})}function x(e,t,i){t=t?t+".":"";var n=5;i||(i=1);var o={};for(var s in e)if("object"==typeof e[s]&&n>i){var a=x(e[s],t+s,++i);for(var r in a)o[r]=a[r]}else o[t+s]=e[s];return o}function S(e,i,n,o){n=Oo(n||document.createElement("div"));for(var s=0,a=i.length;a>s;s++){for(var r=Oo("<div/>").addClass("raptor-layout-toolbar-group"),l=i[s],d=0,c=l.length;c>d;d++)if(e.plugins[l[d]]){var u=e.plugins[l[d]];if(u!==!1){var p=y(e,e.plugins[l[d]],u,o);e.pluginInstances[l[d]]=p.instance,B(p.ui)&&(p.ui.removeClass("ui-corner-all"),r.append(p.ui))}}else t('Plugin identified by key "'+l[d]+'" does not exist');r.children().length>0&&r.appendTo(n)}return n.find(".ui-button:first-child").addClass("ui-corner-left"),n.find(".ui-button:last-child").addClass("ui-corner-right"),n[0]}function P(e){return!isNaN(e-0)&&null!==e}function I(e){return"string"==typeof e}function D(e){return e instanceof Array}function L(e){return e instanceof Node}function N(e){return L(e)?e.nodeType===Node.TEXT_NODE:B(e)?L(e[0]):!1}function B(e){return e instanceof jQuery}function R(e){return e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e instanceof jQuery}function A(e,t){return R(e)||n("Parameter 1 to aButton is expected to be a jQuery compatible object",e),Oo(e).button(t)}function M(e,t){return R(e)||n("Parameter 1 to aButtonSetLabel is expected to be a jQuery compatible object",e),Oo(e).button("option","text",!0),Oo(e).button("option","label",t)}function H(e,t){return R(e)||n("Parameter 1 to aButtonSetIcon is expected to be a jQuery compatible object",e),Oo(e).button("option","icons",{primary:t})}function O(e){return R(e)||n("Parameter 1 to aButtonEnable is expected to be a jQuery compatible object",e),Oo(e).button("option","disabled",!1)}function U(e){return!Oo(e).is(".ui-state-disabled")}function F(e){return R(e)||n("Parameter 1 to aButtonDisable is expected to be a jQuery compatible object",e),Oo(e).button("option","disabled",!0)}function j(e){return R(e)||n("Parameter 1 to aButtonActive is expected to be a jQuery compatible object",e),Oo(e).addClass("ui-state-highlight")}function z(e){return R(e)||n("Parameter 1 to aButtonInactive is expected to be a jQuery compatible object",e),Oo(e).removeClass("ui-state-highlight")}function q(e,t){return R(e)||n("Parameter 1 to aMenu is expected to be a jQuery compatible object",e),Oo(e).menu(t)}function W(e,t){R(e)||n("Parameter 1 to aDialog is expected to be a jQuery compatible object",e),t.dialogClass="undefined"!=typeof t.dialogClass?t.dialogClass+" ui-dialog-fixed":"ui-dialog-fixed";var i=Oo(e).dialog(t);return i.parent().css({top:(parseInt(i.parent().css("top"))||0)-Oo(window).scrollTop()}),i.dialog("option","position","center"),i}function Q(e){return R(e)||n("Parameter 1 to aDialogOpen is expected to be a jQuery compatible object",e),Oo(e).dialog("open")}function G(e){return R(e)||n("Parameter 1 to aDialogClose is expected to be a jQuery compatible object",e),Oo(e).dialog("close")}function V(e){return R(e)||n("Parameter 1 to aDialogClose is expected to be a jQuery compatible object",e),Oo(e).dialog("destroy").remove()}function _(e,t){return R(e)||n("Parameter 1 to aTabs is expected to be a jQuery compatible object",e),Oo(e).tabs(t)}function X(e){"success"==e.type&&(e.state="confirmation"),Oo.pnotify(Oo.extend({type:"success",styling:"jqueryui",history:!1},e))}function K(e,i,n){return B(i)||t("Target must be a jQuery instance when previewing an action",i),J(e,i),e=un(i),n(),rangy.getSelection().removeAllRanges(),e}function J(e,t){if(e){var i=pn(t,e);return i.ranges&&rangy.getSelection().setRanges(i.ranges),i.element}return t}function $(e){e()}function Y(){}function Z(){}function et(e,t){for(var i in t){var n=t[i],o=!1;do if(o=Oo(e).find(i),o.length){o=Oo(o.get(0));var s=Oo(n).clone();s.html(o.html()),s.attr(Tt(o)),o.replaceWith(s)}while(o.length)}}function tt(e){Oo(e).unwrap()}function it(e,t){if(!B(e))return n("Paramter 1 to cleanEmptyAttributes is expected a jQuery element"),void 0;for(i=0;i<t.length;i++)Oo.trim(e.attr(t[i]))||e.removeAttr(t[i]),e.find("["+t[i]+"]").filter(function(){return""===Oo.trim(Oo(this).attr(t[i]))}).removeAttr(t[i])}function nt(e){return B(e)?(e.contents().each(function(){this.nodeType==Node.COMMENT_NODE&&Oo(this).remove()}),e.children().each(function(){nt(Oo(this))}),e):(n("Paramter 1 to cleanRemoveComments is expected a jQuery element"),void 0)}function ot(e,t){if(!B(e))return n("Paramter 1 to cleanEmptyElements is expected a jQuery element"),void 0;var i;do i=!1,e.find(t.join(",")).each(function(){""===Oo.trim(Oo(this).html())&&(Oo(this).remove(),i=!0)});while(i);return e}function st(e,t){if(!L(e))return n("Paramter 1 to cleanWrapTextNodes is expected a node."),void 0;for(var i=ei(e),o=0,s=i.length;s>o;o++){var a=i[o].cloneNode(),r=document.createElement(t);r.appendChild(a),e.insertBefore(r,i[o]),e.removeChild(i[o])}}function at(e,t){var i;do i=!1,Oo(e).find(t).each(function(){Oo(this).parent().is(t)&&(Oo(this).unwrap(),i=!0)});while(i)}function rt(e){Oo(e).find(".rangySelectionBoundary").remove()}function lt(e,t){var i,n=Oo("<div>").addClass("spacer");"top"===t.position?(i={position:"fixed",top:t.under?Oo(t.under).outerHeight():0,left:0,right:0},t.spacer&&(t.under?n.insertAfter(t.under):n.prependTo("body"))):"topLeft"===t.position?(i={position:"fixed",top:t.under?Oo(t.under).outerHeight():0,left:0},t.spacer&&(t.under?n.insertAfter(t.under):n.prependTo("body"))):"topRight"===t.position?(i={position:"fixed",top:t.under?Oo(t.under).outerHeight():0,right:0},t.spacer&&(t.under?n.insertAfter(t.under):n.prependTo("body"))):"bottom"===t.position?(i={position:"fixed",bottom:0,left:0,right:0},t.spacer&&n.appendTo("body")):"bottomLeft"===t.position?(i={position:"fixed",bottom:0,left:0},t.spacer&&n.appendTo("body")):"bottomRight"===t.position&&(i={position:"fixed",bottom:0,right:0},t.spacer&&n.appendTo("body"));var o=fn(e,i);return n.css("height",e.outerHeight()),setTimeout(function(){n.css("height",e.outerHeight())},300),{dockedElement:e,spacer:n,styleState:o}}function dt(e){return yn(e.dockedElement,e.styleState),e.spacer.remove(),e.dockedElement.detach()}function ct(e,t,i){var n=t.wrap("<div>").parent(),o=vn(n,t,{"float":"none",display:"block",clear:"none",position:"static",margin:0,marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,padding:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,outline:0,width:"auto",border:"none"}),s=fn(e,{position:"static"});return n.prepend(e).addClass(i.wrapperClass?i.wrapperClass:""),{dockedElement:e,dockedTo:t,innerStyleState:o,dockedElementStyleState:s}}function ut(e){yn(e.dockedTo,e.innerStyleState),yn(e.dockedElement,e.dockedElementStyleState);var t=e.dockedElement.detach();return e.dockedTo.unwrap(),t}function pt(e,t){return e.children().each(function(){var e=Oo.map(this.attributes,function(e){return-1===Oo.inArray(e.name,t)?e.name:void 0}),i=Oo(this);Oo.each(e,function(e,t){i.removeAttr(t)}),element.removeAttributes(Oo(this),t)}),e}function ht(e){var t=1;e.siblings().each(function(){var e=Oo(this).css("z-index");!isNaN(e)&&e>t&&(t=e+1)}),e.css("z-index",t)}function gt(e){return e.clone().wrap("<div/>").parent().html()}function mt(e){return e.clone().wrap("<div/>").parent().text()}function ft(e){return"block"===yt(e.tagName)}function vt(e){var t=!1;return e.contents().each(function(){return!N(this)&&ft(this)?(t=!0,void 0):void 0}),t}function yt(e){var t,i=document.createElement(e),n="getComputedStyle"in window;return document.body.appendChild(i),t=(n?window.getComputedStyle(i,""):i.currentStyle).display,document.body.removeChild(i),t}function bt(e,t){return-1!==Oo.inArray(Oo(e)[0].tagName.toLowerCase(),t)}function Ct(e,i,o){if(!L(e))return n("Parameter 1 to elementFirstInvalidElementOfValidParent must be a node",e),void 0;var s=e.parentNode;return s[0]===o[0]?bt(s,i)?e:(t("elementFirstInvalidElementOfValidParent requires a valid wrapper"),void 0):bt(s,i)?e:Ct(s,i,o)}function wt(e){if(!R(e))return n("Parameter 1 to elementVisibleRect is expected to be a jQuery compatible object",e),void 0;e=Oo(e);var t={top:Math.round(e.offset().top),left:Math.round(e.offset().left),width:Math.round(e.outerWidth()),height:Math.round(e.outerHeight())},i=Oo(window).scrollTop(),o=Oo(window).height(),s=i+o,a=Math.round(t.height+t.top);return i<t.top&&s>a?t:(i>t.top&&(t.top=i),t.height=a>s?s-t.top:o-(s-a),t)}function Tt(e){for(var t=Oo(e).get(0).attributes,i={},n=0,o=t.length;o>n;n++)i[t[n].name]=t[n].value;return i}function Et(e){for(var t={},i=window.getComputedStyle(e[0],null),n=0;n<i.length;n++)t[i.item(n)]=i.getPropertyValue(i.item(n));return t}function kt(e,t){var i=new jQuery;ki();for(var n=0,o=e.length;o>n;n++){var s=Oo("<"+t+"/>").html(Oo(e[n]).html());e.html(s),i.push(s[0])}return xi(),i}function xt(e,t){Oo.each(t,function(t,i){Oo(e).css(t)===i?Oo(e).css(t,""):Oo(e).css(t,i)})}function St(e,t,i){for(var n in i)e.css(n,t.css(n)),t.css(n,i[n])}function Pt(e){return B(e)?e.is("img")||e.find("img").length?!1:/&nbsp;/.test(e.html())?!1:""===e.text():(n("Parameter 1 to elementIsEmpty must be a jQuery element",e),void 0)}function It(e,t){var i=Oo(t).offset(),n=Oo(t).outerHeight();Oo(e).css({top:i.top+n-Oo(window).scrollTop()+"px",left:i.left+"px"})}function Dt(e,t){var i=Oo(e).parent();Oo(e).detach(),t(e),i.append(e)}function Lt(e,t){if(!B(e))return n("Parameter 1 to elementClosestBlock must be a jQuery element",e),void 0;if(!B(t))return n("Parameter 2 to elementClosestBlock must be a jQuery element",t),void 0;for(;e.length>0&&e[0]!==t[0]&&(e[0].nodeType===Node.TEXT_NODE||"inline"===e.css("display"));)e=e.parent();return e[0]===t[0]?null:e}function Nt(){for(var e="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());Oo("#"+e).length;)e="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());return e}function Bt(e,t){B(e)||n("Parameter 1 to elementChangeTag must be a jQuery element",e);for(var i=[],o=e.length-1;o>=0;o--){var s=document.createElement(t);s.innerHTML=e[o].innerHTML,Oo.each(e[o].attributes,function(){Oo(s).attr(this.name,this.value)}),Oo(e[o]).after(s).remove(),i[o]=s}return Oo(i)}function Rt(e,t){if(e.outerHeight()>t.outerHeight()-20){var i=wt(t),n=t.offset();e.css({position:"absolute",top:n.top-e.outerHeight(),left:i.left+(i.width/2-e.outerWidth()/2)})}else{var i=wt(t);e.css({position:"absolute",top:i.top+(i.height/2-e.outerHeight()/2),left:i.left+(i.width/2-e.outerWidth()/2)})}}function At(e,t){for(var i="",n=0,o=e.childNodes.length;o>n;n++){var s=e.childNodes.item(n),a=s.nodeType===Node.TEXT_NODE?s.nodeValue:gt(Oo(s));a&&(i+=a)}return t&&(i=Oo("<"+t+">"+i+"</"+t+">"),i.find("p").wrapInner("<"+t+"/>"),i.find("p > *").unwrap(),i=Oo("<div/>").html(i).html()),i}function Mt(e,t,i){for(var n=0,o=e.childNodes.length;o>n;n++){var s=e.childNodes.item(n),a=s.nodeType===Node.TEXT_NODE?s.nodeValue:Oo(s).html();a&&Oo("<"+i+"/>").html(Oo.trim(a)).insertBefore(t)}}function Ht(e,t,i){return""!==i.html().trim()&&_i()?Ut(e,t,i)?(console.log("listShouldConvertType"),Jt(e,t,i)):Ot(e,t)?(console.log("listShouldUnwrap"),Kt(e,t,i)):Ft(e,t,i)?(console.log("listShouldWrap"),zt(e,t,i)):void 0:void 0}function Ot(e,t){var i=Oo(Fi());return i.is(e)?!0:"blockquote"!==e||i.parent().is(e)?i.is(t)&&i.parent().is(e)?!0:i.parentsUntil(e,t).length?!0:!1:!1}function Ut(e,t,i){var n=Xi(),o=Oo(pi(n));if(hi(n)){var s=o.closest(t,i);s.length?ri(n,[s]):oi(n)}return o=Oo(pi(n)),"blockquote"!==e||mi(n,o.get(0))?Oo(o).is(t)&&!Oo(o).parent().is(e)?!0:!1:!1}function Ft(e,t,i){return"blockquote"===e?bt(i,Ao):bt(i,Ro)}function jt(e,t,i,o){o="undefined"==typeof o?!0:o,B(e)||n("Parameter 1 for listEnforceValidChildren must be a jQuery element",e);var s=function(e){return Oo(e).is("img")||Oo(e).find("img").length?void 0:Oo(e).text().trim()?void 0:(Oo(e).remove(),!0)};e.find("> "+t).each(function(){return o&&s(this)?!0:(Oo(this).contents().each(function(){if(o&&s(this))return!0;if("p"===t){if(!N(this)&&!bt(this,i))return Oo(this).contents().unwrap(),!0}else{if(N(this))return!0;if(!bt(this,i))return Oo(this).contents().unwrap(),s(this),!0}}),void 0)})}function zt(e,t,i){{var n=Xi();pi(n)}n.startContainer,n.endContainer;var o=n.extractContents(),s=At(o),a=p("<"+e+">"+s+"</"+e+">"),r=Oo(a);return r.children().wrap("<li>"),Li(r),void 0;var o}function qt(e,t){return e=Oo("<div/>").html(e),vt(e)?(e.contents().each(function(){return Oo(this).is("img")?!0:Pt(Oo(this))?Oo(this).remove():(Oo(this).wrap("<"+t+"/>"),ft(this)||Oo(this).wrap("<p>"),void 0)}),e.html()):"p"===t?"<"+t+">"+e.html()+"</"+t+">":"<"+t+"><p>"+e.html()+"</p></"+t+">"}function Wt(e,t,i){B(e)||n("Parameter 1 for listConvertListItem must be a jQuery element",e);var o=e.contents();return o.length?(o.each(function(){return""===Oo(this).text().trim()?Oo(this).remove():N(this)||!ft(this)?Oo(this).wrap("<"+i+">"):void 0}),e.contents().unwrap()):Bt(e,i)}function Qt(e,t,i){return B(e)||n("Parameter 1 for listUnwrap must be a jQuery element",e),e.find(t).each(function(){Wt(Oo(this),i,"p")}),e.contents().unwrap()}function Gt(e,t,i){B(e)||n("Parameter 1 for listTidyModified must be a jQuery element",e),Vt(e,t,i),_t(e,t,i)}function Vt(e,t,i){B(e)||n("Parameter 1 for listRemoveEmptyItems must be a jQuery element",e),e.is(t)&&e.find(i).each(function(){""===Oo(this).text().trim()&&Oo(this).remove()})}function _t(e,t){B(e)||n("Parameter 1 for listRemoveEmpty must be a jQuery element",e),e.is(t)&&""===e.text().trim()&&e.remove()}function Xt(e,t,i,n){var o=ci(e),s=ui(e),a=Nt();oi(e);var r="blockquote"===t?Ao:Mo;r=Oo.grep(r,function(e){return"li"!==e}),wi(e,Oo("<p/>").attr("id",a),n,r);var l=Oo("#"+a);Gt(l.prev(),t,i),Gt(l.next(),t,i);var d=[o];return o!==s&&(Oo(o).nextUntil(s).each(function(){this!==s&&d.push(this)}),d.push(s)),d.reverse(),Oo(d).each(function(){l.after(this),Wt(Oo(this),t,"p")}),l.remove(),jt(Oo(pi(e)),i,Bo)}function Kt(e,t,i){var n=Xi();hi(n)&&ri(n,[t]);var o=Oo(pi(n));if(o.is(e)){var s=ci(n),a=ui(n);return Oo(a).is(e)&&Oo(s).is(e)?Qt(o,t,e):Xt(n,e,t,i)}return o.is(t)||(o=o.closest(t)),o.prev().length||o.next().length?o.next().length&&o.prev().length?Xt(n,e,t,i):o.next().length&&!o.prev().length?(o.parent().before(Wt(o,e,"p")),o.remove(),void 0):!o.next().length&&o.prev().length?(o.parent().after(Wt(o,"p",e)),o.remove(),void 0):void 0:Qt(o.closest(e),t,e)}function Jt(e,t,i){var n=Xi();hi(n)&&ri(n,[t]);var o=ci(n),s=ui(n),a=Nt();oi(n);var r=Oo.grep(Mo,function(e){return e!==t});wi(n,Oo("<p/>").attr("id",a),i,r);var l=Oo("#"+a);Gt(l.prev(),e,t),Gt(l.next(),e,t);var d=[o];o!==s&&(Oo(o).nextUntil(s).each(function(){this!==s&&d.push(this)}),d.push(s)),d.reverse(),Oo(d).each(function(){l.after(this)}),l.remove();var c=Oo(d).wrap("<"+e+">").parent();return jt(c,t,Bo)}function $t(e,t,i,n){var o=Ui();if(!o.closest(t).length)return!1;var s=o.closest(e);if(!s.length||i.get(0)===s.get(0))return!1;Hi(o),cn();var a=Oo("<"+e+"/>"),r=Oo("<"+e+"/>"),l=!1;return s.children().each(function(){return o.closest(t).get(0)===this?(l=!0,a.append(this),void 0):(l?r.append(this):a.append(this),void 0)}),s.replaceWith(a),n=Oo(n).appendTo(Oo("body")),a.after(n,r),n}function Yt(e,t){var i=Ui();if(!i.closest(t).length)return!1;cn(),Hi(i);var n=Oi();""===n.trim()&&(n="&nbsp;"),cn(),""===i.text().trim()&&i.html("&nbsp;");var o=Oo("<"+t+">").html(n);return i.closest(t).after(o),jt(i.closest(e),t,Bo,!1),o}function Zt(e){for(;e.nodeType===Node.TEXT_NODE;)e=e.parentNode;return e}function ei(e){for(var t=[],i=/^\s*$/,n=0,o=e.childNodes.length;o>n;n++)e.childNodes[n].nodeType==Node.TEXT_NODE&&(i.test(e.childNodes[n].nodeValue)||t.push(e.childNodes[n]));return t}function ti(e,t){for(var i=e.parentNode;null!=i;){if(i==t)return!0;i=i.parentNode}return!1}function ii(e,t){if(localStorage){var i;i=localStorage.raptor?JSON.parse(localStorage.raptor):{},i[e]=t,localStorage.raptor=JSON.stringify(i)}}function ni(e){if(localStorage){var t;return t=localStorage.raptor?JSON.parse(localStorage.raptor):{},t[e]}}function oi(e){return Bn(e)?(e.setStartBefore(e.startContainer),e.setEndAfter(e.endContainer),void 0):(n("Parameter 1 to rangeExpandToParent is expected to be a range",e),void 0)}function si(e,t){return Bn(e)?B(t)?(e.selectNode(Oo(t)[0]),void 0):(n("Parameter 2 to rangeSelectElement is expected to be a jQuery element",t),void 0):(n("Parameter 1 to rangeSelectElement is expected to be a range",e),void 0)}function ai(e,t){return Bn(e)?B(t)||L(t)?(e.selectNodeContents(Oo(t).get(0)),void 0):(n("Parameter 2 to rangeSelectElementContent is expected to be a jQuery element or node",t),void 0):(n("Parameter 1 to rangeSelectElementContent is expected to be a range",e),void 0)}function ri(e,t){if(!Bn(e))return n("Parameter 1 to rangeReplace is expected to be a range",e),void 0;if(!D(t))return n("Parameter 2 to rangeExpandTo is expected to be an array",t),void 0;do{oi(e);for(var i=0,o=t.length;o>i;i++)if(Oo(e.commonAncestorContainer).is(t[i]))return}while(e.commonAncestorContainer)}function li(e,t){if(!Bn(e))return n("Parameter 1 to rangeReplace is expected to be a range",e),void 0;if(!B(t)&&!I(t))return n("Parameter 2 to rangeReplace is expected to be a string or jQuery element",t),void 0;var i=[],o=Oo("<div/>").append(t)[0].childNodes;return e.deleteContents(),void 0===o.length||1===o.length?e.insertNode(o[0].cloneNode(!0)):Oo.each(o,function(t,n){i.unshift(n.cloneNode(!0)),e.insertNodeAtEnd(i[0])}),i}function di(e){var t=Ti(e);return"string"==typeof t&&(t=t.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")),mn(t)}function ci(e){return Bn(e)||n("Parameter 1 to rangeGetStartElement is expected to be a range",e),Zt(e.startContainer)}function ui(e){return Bn(e)||n("Parameter 1 to rangeGetEndElement is expected to be a range",e),Zt(e.endContainer)}function pi(e){return Bn(e)||n("Parameter 1 to rangeGetCommonAncestor is expected to be a range",e),Zt(e.commonAncestorContainer)}function hi(e){return Bn(e)||n("Parameter 1 to rangeGetCommonAncestor is expected to be a range",e),e.startOffset===e.endOffset&&e.startContainer===e.endContainer}function gi(e,t){Bn(e)||n("Parameter 1 to rangeIsContainedBy is expected to be a range",e),L(t)||n("Parameter 1 to rangeIsContainedBy is expected to be a node",t);var i=e.cloneRange();return i.selectNodeContents(t),i.containsRange(e)}function mi(e,t){return Bn(e)||n("Parameter 1 to rangeContainsNode is expected to be a range",e),L(t)||n("Parameter 1 to rangeContainsNode is expected to be a node",t),e.containsNode(t)}function fi(e,t){return Bn(e)||n("Parameter 1 to rangeContainsText is expected to be a range",e),L(t)||n("Parameter 1 to rangeContainsText is expected to be a node",t),e.containsNodeText(t)}function vi(e){if(Bn(e)||n("Parameter 1 to rangeTrim is expected to be a range",e),e.startContainer.data)for(;/\s/.test(e.startContainer.data.substr(e.startOffset,1));)e.setStart(e.startContainer,e.startOffset+1);if(e.endContainer.data)for(;e.endOffset>0&&/\s/.test(e.endContainer.data.substr(e.endOffset-1,1));)e.setEnd(e.endContainer,e.endOffset-1)}function yi(e,t){return Bn(e)||n("Parameter 1 to rangeSerialize is expected to be an range",e),L(t)||n("Parameter 1 to rangeSerialize is expected to be a node",t),rangy.serializeRange(e,!0,t)}function bi(e,t){I(e)||n("Parameter 1 to rangeDeserialize is expected to be a string",e);for(var i=e.split("|"),o=[],s=0,a=i.length;a>s;s++)o[s]=rangy.deserializeRange(i[s],t);return o}function Ci(e,t,i,o){Bn(e)||n("Parameter 1 to rangeReplaceSplitInvalidTags is expected to be a range",e);var s=pi(e);bt(s,o)||(s=Ct(s,o,i));var a=rangy.createRange();a.setStartBefore(s),a.setEnd(e.startContainer,e.startOffset);var r=a.cloneContents(),l=rangy.createRange();l.setStart(e.endContainer,e.endOffset),l.setEndAfter(s);var d=l.cloneContents(),c=gt(Oo(At(r)));return c+=gt(Oo(t).attr("data-replacement",!0)),c+=gt(Oo(At(d))),c=Oo(c),Oo(s).replaceWith(c),c=c.parent().find("[data-replacement]").removeAttr("data-replacement"),c.prev().is(s.tagName.toLowerCase())&&!c.prev().html().trim()&&c.prev().remove(),c.next().is(s.tagName.toLowerCase())&&!c.next().html().trim()&&c.next().remove(),c}function wi(e,t,i,n){var o=Zt(e.startContainer),s=Zt(e.endContainer),a=pi(e),r=bt(a,n),l=bt(o,n),d=bt(s,n);return r&&l&&d?li(e,t):Ci(e,t,i,n)}function Ti(e){return At(e.cloneContents())}function Ei(){var e=rangy.getSelection();return e.rangeCount>0?e.getRangeAt(0):null}function ki(e){(!Ho||e)&&(Ho=rangy.saveSelection())}function xi(){Ho&&(rangy.restoreSelection(Ho),Ho=!1)}function Si(){Ho&&rangy.removeMarkers(Ho),Ho=!1}function Pi(){return Ho!==!1}function Ii(e,t,i){t=t||rangy.getSelection();for(var n,o=0;n=t.getAllRanges()[o++];)e.call(i,n)}function Di(e){rangy.getSelection().setSingleRange(e)}function Li(e,t){var i=[];return Ii(function(t){i=i.concat(li(t,e))},t,this),i}function Ni(e,t){if(!L(e))return n("Parameter 1 to selectionSelectInner is expected a Node",e),void 0;t=t||rangy.getSelection();var i=rangy.createRange();i.selectNodeContents(e),t.setSingleRange(i)}function Bi(e){if(!L(e))return n("Parameter 1 to selectionSelectOuter must be a node",e),void 0;var t=rangy.createRange();t.selectNode(e),rangy.getSelection().setSingleRange(t)}function Ri(e,t,i){t=t||rangy.getSelection(),t.removeAllRanges(),Oo(e).each(function(){var e=rangy.createRange();e.selectNodeContents(this),e.collapse(i),t.addRange(e)})}function Ai(e,t){Ri(e,t,!1)}function Mi(e,t){Ri(e,t,!0)}function Hi(e,t){if(!B(e))return n("Parameter 1 to selectionSelectToEndOfElement is expected to be Element",e),void 0;t=t||rangy.getSelection();var i=Xi();t.removeAllRanges(),i.setEndAfter(e.get(0)),t.addRange(i)}function Oi(e){return e=e||rangy.getSelection(),e.toHtml()}function Ui(e,t){if(t=t||rangy.getSelection(),!_i())return new jQuery;var i,e=Xi();return i=e.commonAncestorContainer.nodeType===Node.TEXT_NODE?e.commonAncestorContainer.parentNode:e.commonAncestorContainer,Oo(i)}function Fi(e){var t=new jQuery;return Ii(function(e){t.push(Ui(e)[0])},e,this),t}function ji(){var e=rangy.getSelection();return null===e.anchorNode?null:e.isBackwards()?e.focusNode.nodeType===Node.TEXT_NODE?Oo(e.focusNode.parentElement):Oo(e.focusNode):(e.anchorNode||console.trace(),e.anchorNode.nodeType===Node.TEXT_NODE?Oo(e.anchorNode.parentElement):Oo(e.anchorNode))}function zi(){var e=rangy.getSelection();return null===e.anchorNode?null:e.isBackwards()?e.anchorNode.nodeType===Node.TEXT_NODE?Oo(e.anchorNode.parentElement):Oo(e.anchorNode):e.focusNode.nodeType===Node.TEXT_NODE?Oo(e.focusNode.parentElement):Oo(e.focusNode)}function qi(){var e=rangy.getSelection(),t=e.isBackwards()?e.anchorNode:e.focusNode,i=e.isBackwards()?e.focusOffset:e.anchorOffset;if(i!==t.textContent.length)return!1;var n=t.nextSibling;return n&&""!==Oo(n).html()?!1:!0}function Wi(){var e=rangy.getSelection(),t=e.isBackwards()?e.focusNode:e.anchorNode;if(e.isBackwards()?e.focusOffset:0!==e.anchorOffset)return!1;var i=t.previousSibling;return i&&""!==Oo(i).html()?!1:!0}function Qi(){return""===rangy.getSelection().toHtml()}function Gi(e,t){t=t||{};var i=rangy.createCssClassApplier(t.classes||"",{normalize:!0,elementTagName:e,elementProperties:t.attributes||{}});Ii(function(n){if(di(n)){var o=Oo("<"+e+"/>").addClass(t.classes).attr(t.attributes||{}).append(At(n.cloneContents()));li(n,o)}else i.toggleRange(n)},null,this)}function Vi(e,t,i){Ii(function(n){var o=Ui(n);o.is(e)?o.attr(t):Gi(e,{classes:i,attributes:t})},null,this)}function _i(){return 0!==rangy.getSelection().rangeCount}function Xi(){return _i()||t("Tried to get selection range when there is no selection"),rangy.getSelection().getRangeAt(0)}function Ki(e,t){t=t||rangy.getSelection();var i=i(),n=Fi()[0],o=rangy.createRange();o.setStartBefore(n),o.setEnd(i.startContainer,i.startOffset);var s=o.cloneContents(),a=rangy.createRange();a.setStart(i.endContainer,i.endOffset),a.setEndAfter(n);var r=a.cloneContents(),l=gt(Oo(At(s)));return l+=gt(Oo(e).attr("data-replacement",!0)),l+=gt(Oo(At(r))),l=Oo(l),Oo(n).replaceWith(l),l.parent().find("[data-replacement]").removeAttr("data-replacement")}function Ji(e,t,i){if(i=i||rangy.getSelection(),_i()){var n=ji()[0],o=zi()[0],s=Fi()[0],a=bt(s,t),r=bt(n,t),l=bt(o,t);return a&&r&&l?Li(e):Ki(e,i)}}function $i(e,t){Ii(function(i){for(var n=Oo(i.commonAncestorContainer);n.length&&n[0]!==t[0]&&(n[0].nodeType===Node.TEXT_NODE||"inline"===n.css("display"));)n=n.parent();n[0]===t[0]&&"inline"!==t.css("display")&&(kt(t,"div"),n=t.children().first()),xt(n,e)},null,this)}function Yi(e,t,i){return Oo.isFunction(e)?t instanceof jQuery?"undefined"!=typeof i&&"string"!=typeof i?(n("Paramter 3 to selectionEachBlock is expected be undefined or a string",i),void 0):(Ii(function(n){var o,s=Lt(Oo(n.startContainer),t),a=Lt(Oo(n.endContainer),t);if(s&&a){s.is(a)?o=s:s&&a&&(o=s.nextUntil(a).andSelf().add(a));for(var r=0,l=o.length;l>r;r++)e(o[r])}else e(kt(t,i).get(0))}),void 0):(n("Paramter 2 to selectionEachBlock is expected a jQuery element",t),void 0):(n("Paramter 1 to selectionEachBlock is expected to be a function",e),void 0)}function Zi(e,t,i,o){if(!Oo.isArray(e))return n("Paramter 1 to selectionToggleBlockClasses is expected to be an array of classes",e),void 0;if(!Oo.isArray(t))return n("Paramter 2 to selectionToggleBlockClasses is expected to be an array of classes",t),void 0;if(!(i instanceof jQuery))return n("Paramter 3 to selectionToggleBlockClasses is expected a jQuery element",i),void 0;if("undefined"!=typeof o&&"string"!=typeof o)return n("Paramter 4 to selectionToggleBlockClasses is expected be undefined or a string",o),void 0;var s=!1,a=new jQuery;Yi(function(t){if(a.push(t),!s)for(var i=0,n=e.length;n>i;i++)Oo(t).hasClass(e[i])||(s=!0)},i,o),Oo(a).removeClass(t.join(" ")),s?Oo(a).addClass(e.join(" ")):Oo(a).removeClass(e.join(" "))}function en(e,t){if(!L(e))return n("Parameter 1 to selectionConstrain must be a node",e),void 0;t=t||rangy.getSelection();for(var i=t.getAllRanges(),o=[],s=0,a=i.length;a>s;s++){var r=i[s].cloneRange();i[s].startContainer===e||ti(i[s].startContainer,e)||r.setStart(e,0),i[s].endContainer===e||ti(i[s].endContainer,e)||r.setEnd(e,e.childNodes.length),o.push(r)}t.setRanges(o)}function tn(e,t){if(e&&!L(e))return n("Parameter 1 to selectionClearFormatting must be a node",e),void 0;if(e=e||document.body,t=t||rangy.getSelection(),_i()){var i=Xi().cloneRange(),o=i.extractContents();""===At(o)&&(ai(i,i.commonAncestorContainer),t.setSingleRange(i),o=i.extractContents()),o=Oo("<div/>").append(At(o)).html().replace(/(<\/?.*?>)/gi,function(e){return null!==e.match(/^<(img|object|param|embed|iframe)/)?e:""});for(var s=i.commonAncestorContainer;s&&s.parentNode!==e;)s=s.parentNode;if(s){i.setEndAfter(s);var a=i.extractContents();i.collapseAfter(s),i.insertNode(a),i.collapseAfter(s)}o=Oo.parseHTML(o),null!==o&&Oo(o.reverse()).each(function(){return Oo(this).is("img")?(i.insertNode(Oo(this).removeAttr("width height class style").get(0)),void 0):(i.insertNode(this),void 0)})}}function nn(e,t,i,n){ki();var o="domTools"+Math.ceil(1e7*Math.random());Ii(function(e){var s=rangy.createCssClassApplier(n,{elementTagName:i});s.isAppliedToRange(e)?s.toggleSelection():rangy.createCssClassApplier(t,{elementTagName:o}).toggleSelection()},null,this),Oo(o).each(function(){Oo(this).replaceWith(Oo("<"+e+"/>").addClass(t).html(Oo(this).html()))}),xi()}function on(){var e=rangy.getSelection().getAllRanges();1===e.length&&""===Ti(e[0])&&rangy.getSelection().expand("word")}function sn(e,t,i){for(var n=rangy.getSelection().getAllRanges(),o=0,s=n.length;s>o;o++){var a=Oo(Zt(n[o].startContainer));(i||!a.is(e)&&!a.is(t))&&(a=a.parentsUntil(t,e)),a=i?a.last():a.first(),1!==a.length||a.is(t)||n[o].setStart(a[0],0),a=Oo(Zt(n[o].endContainer)),(i||!a.is(e)&&!a.is(t))&&(a=a.parentsUntil(t,e)),a=i?a.last():a.first(),1!==a.length||a.is(t)||n[o].setEnd(a[0],a[0].childNodes.length)}rangy.getSelection().setRanges(n)}function an(){if(_i()){var e=Xi();vi(e),Di(e)}}function rn(e,t){var i=new jQuery;return Ii(function(n){for(var o=n.startContainer;o.nodeType===Node.TEXT_NODE;)o=o.parentNode;for(var s=n.endContainer;s.nodeType===Node.TEXT_NODE;)s=s.parentNode;
var a=function(){t.is(this)||i.push(this)};do{if(Oo(o).filter(e).each(a),t.is(o)||0!==i.length||Oo(o).parentsUntil(t,e).each(a),Oo(o).find(e).each(a),Oo(s).is(o))break;o=Oo(o).next()}while(o.length>0&&0===Oo(o).prevAll().has(s).length)}),i}function ln(e,t,i){var n=rn(t.join(","),i);if(n.length)ki(),Bt(n,e),xi();else{var o=i.get(0);o.innerHTML.trim()?(ki(),o.innerHTML="<"+e+">"+o.innerHTML+"</"+e+">",xi()):(o.innerHTML="<"+e+">&nbsp;</"+e+">",Ni(o.childNodes[0]))}}function dn(e,t){var i=!0;return Ii(function(n){var o=Oo(n.commonAncestorContainer).find("*");0!==Oo(n.commonAncestorContainer).parentsUntil(t,e).length||0!==o.length&&o.length===o.filter(e).length||(i=!1)}),i}function cn(e){e=e||rangy.getSelection(),e.deleteFromDocument()}function un(e){e instanceof Oo||t("Element must be a jQuery instance when saving a state",e);var i=Ei();return{element:e.clone(!0),ranges:i?yi(i,e.get(0)):null}}function pn(e,i){e instanceof Oo||t("Element must be a jQuery instance when restoring a state",e),i.element instanceof Oo||t("Preview state element must be a jQuery instance when restoring a state",i.element),e.replaceWith(i.element);var n=null;try{i.ranges&&(n=bi(i.ranges,i.element.get(0)))}catch(o){t(o)}return{element:i.element,ranges:n}}function hn(e,t){allowed=[];for(var i=0;i<t.length;i++)t[i].match(/[a-z][a-z0-9]{0,}/g)&&allowed.push(t[i]);var n=/<\/?([a-z][a-z0-9]*)\b[^>]*\/?>/gi,o=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return e.replace(o,"").replace(n,function(e,t){return allowed.indexOf(t.toLowerCase())>-1?e:""})}function gn(e,t){return e.replace(/([A-Z])/g,function(e){return(t||"-")+e.toLowerCase()})}function mn(e){return I(e)?Oo(Oo.parseHTML(e)).is(":empty"):(n("Parameter 1 to stringHtmlStringIsEmpty must be a string",e),void 0)}function fn(e,t){var i=e.get(0),n={};for(var o in t)n[o]=i.style[o];for(o in t)e.css(o,t[o]);return n}function vn(e,t,i){var n=t.get(0),o={};for(var s in i)o[s]=n.style[s];for(s in i)e.css(s,t.css(s)),t.css(s,i[s]);return o}function yn(e,t){for(var i in t)e.css(i,t[i]||"")}function bn(e,t,i){i=i||{};for(var n=document.createElement("table");t--;)for(var o=n.insertRow(0),s=0;e>s;s++){var a=o.insertCell(0);i.placeHolder&&(a.innerHTML=i.placeHolder)}return n}function Cn(e,t,i){return resizeTable(e,0,0,1,t,i||{})}function wn(e,t){resizeTable(e,0,0,-1,t)}function Tn(e,t,i){var n=new GoogTable(e);return n.insertRow(t,i)}function En(e,t){resizeTable(e,-1,t,0,0)}function kn(e){for(var t,i,n,o,s=[],a=e.parentNode.parentNode.parentNode.tBodies[0].rows,r=0;r<a.length;r++){i=a[r].sectionRowIndex,i=r;for(var l=0;l<a[r].cells.length;l++){for(t=l;s[i]&&s[i][t];)t++;for(n=t;n<t+(a[r].cells[l].colSpan||1);++n)for(o=i;o<i+(a[r].cells[l].rowSpan||1);++o)s[o]||(s[o]=[]),s[o][n]=!0;if(e===a[r].cells[l])return{x:t,y:i}}}}function xn(e,t){for(var i=e.tBodies[0].rows,n=0;n<i.length;n++)for(var o=0;o<i[n].cells.length;o++){var s=kn(i[n].cells[o]);if(s.x===t.x&&s.y===t.y)return i[n].cells[o]}return null}function Sn(e,t,i){for(var n=Math.min(t.x,i.x),o=n,s=Math.min(t.y,i.y),a=Math.max(t.x,i.x),r=Math.max(t.y,i.y),l=[];r>=s;){for(;a>=o;){var d=xn(e,{x:o,y:s});null!==d&&l.push(d),o++}o=n,s++}return l}function Pn(){}function In(e,t,i,n,o){var s=new GoogTable(e);s.mergeCells(t,i,n,o)}function Dn(){}function Ln(e,t,i){var n=new GoogTable(e);n.splitCell(t,i)}function Nn(e){for(var t=0,i=e.rows.length;i>t;t++)if(e.rows[t].cells.length>0)return!1;return!0}function Bn(e){return e instanceof rangy.WrappedRange}function Rn(e){return e instanceof rangy.WrappedSelection}function An(){if(void 0===Uo){Uo=!0,Fo=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),Fo&&(Oo("html").addClass("raptor-ios"),Fo&&Oo(document).on("scroll",function(){setInterval(function(){Oo("body").css("height","+=1").css("height","-=1")},0)})),zo=/Firefox/i.test(navigator.userAgent),zo&&Oo("html").addClass("raptor-ff");var e=function(){var e=-1;return-1!=navigator.appVersion.indexOf("MSIE")&&(e=parseFloat(navigator.appVersion.split("MSIE")[1])),e}();qo=-1!==e,qo&&9>e&&(Uo=!1,Oo(function(){var e=Oo("<div/>").addClass("raptor-unsupported").html('<div class="raptor-unsupported-overlay"></div><div class="raptor-unsupported-content">    It has been detected that you a using a browser that is not supported by Raptor, please    use one of the following browsers:    <ul>        <li><a href="http://www.google.com/chrome">Google Chrome</a></li>        <li><a href="http://www.firefox.com">Mozilla Firefox</a></li>        <li><a href="http://windows.microsoft.com/ie">Internet Explorer</a></li>    </ul>    <div class="raptor-unsupported-input">        <button class="raptor-unsupported-close">Close</button>        <input name="raptor-unsupported-show" type="checkbox" />        <label>Don\'t show this message again</label>    </div><div>').appendTo("body"),t=function(e){var t=1;e.siblings().each(function(){var e=Oo(this).css("z-index");!isNaN(e)&&e>t&&(t=e+1)}),e.css("z-index",t)};t(e),e.find(".raptor-unsupported-close").click(function(){e.remove()})})),jo=void 0!==jQuery.hotkeys}return Uo}function Mn(e,t){for(var i=e.split("."),n=t.split("."),o=0;o<i.length;++o){if(n.length==o)return e;var s=parseInt(i[o]),a=parseInt(n[o]);if(s!=a)return s>a?e:t}return i.length!=n.length?t:null}function Hn(e){this.name=e}function On(e,t){this.name=e;for(var i in t)this[i]=t[i]}function Un(e,t){this.raptor=e,this.uiOrder=t}function Fn(){Hn.call(this,"toolbar"),this.wrapper=null}function jn(){Hn.call(this,"hoverPanel"),this.hoverPanel=null,this.visible=!1}function zn(){Hn.call(this,"elementHoverPanel"),this.elements="img",this.hoverPanel=null,this.visible=!1,this.target=null,this.enabled=!0}function qn(e){this.text=!1,this.label=null,this.icon=null,this.hotkey=null;for(var t in e)this[t]=e[t]}function Wn(e){this.preview=!0,this.previewing=!1,qn.call(this,e)}function Qn(e){this.disable=!1,qn.call(this,e)}function Gn(e){Wn.call(this,e)}function Vn(e){qn.call(this,e)}function _n(e){Gn.call(this,e)}function Xn(e){this.state=null,qn.call(this,e)}function Kn(e){Xn.call(this,e),Qn.call(this,e)}function Jn(e,t){this.menu=e,this.name=e.name,this.raptor=e.raptor,this.options=e.options,qn.call(this,t)}function $n(e){this.menu=null,this.menuContent="",this.button=null;for(var t in e)this[t]=e[t]}function Yn(e){$n.call(this,e)}function Zn(){Yn.call(this,{name:"classMenu"})}function eo(){this.colors=["white","black","grey","blue","red","green","purple","orange"],this.currentColor="automatic",Yn.call(this,{name:"colorMenuBasic"})}function to(e,t){this.options={dockToElement:!1,docked:!1,position:"top",spacer:!0,persist:!0},this.dockState=!1,this.marker=!1,On.call(this,e||"dock",t)}function io(e){this.raptor=e,this.label=c("linkTypeDocumentLabel")}function no(e){this.raptor=e,this.label=c("linkTypeEmailLabel")}function oo(e){this.raptor=e,this.label=c("linkTypeExternalLabel")}function so(e){this.raptor=e,this.label=c("linkTypeInternalLabel")}function ao(e,t){On.call(this,e||"noBreak",t)}function ro(e,t){On.call(this,e||"normaliseLineBreaks",t)}function lo(e,t){this.options={allowedTags:["h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","p","a","span","hr","br","strong","em"],allowedAttributes:["href","title"],allowedEmptyTags:["hr","br"],panels:["formatted-clean","plain-text","formatted-unclean","source"]},On.call(this,e||"paste",t)}function co(e,t){this.options={content:c("placeholderPluginDefaultContent"),tag:"p",select:!0},On.call(this,e||"placeholder",t)}function uo(){Yn.call(this,{name:"snippetMenu"})}function po(e){Vn.call(this,e)}function ho(){$n.call(this,{name:"tableCreate"})}function go(e,t){On.call(this,e||"tableSupport",t)}function mo(){Yn.call(this,{name:"tagMenu"})}function fo(e){Gn.call(this,e)}function vo(e,t){On.call(this,e||"toolTip",t)}function yo(e,t){On.call(this,e||"unsavedEditWarning",t)}function bo(e){return e.split(".").pop()}function Co(e){var t=bo(e).toLowerCase();return"jpg"===t||"jpeg"===t||"png"===t||"gif"===t}var wo={};wo.x=function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){return new XMLHttpRequest}}},wo.prepare=function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")},wo.send=function(e,t,i,n,o){var s=wo.x();s.open(i,e,o),s.onreadystatechange=function(){4==s.readyState&&t(s.responseText,s)},s.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==i&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(n)},wo.get=function(e,t,i,n){wo.send(e+(t?"?"+wo.prepare(t):""),i,"GET",null,n)},wo.post=function(e,t,i,n){var o=[];for(var s in t)o.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));wo.send(e,i,"POST",wo.prepare(t),n)};var To=100,Eo=500,ko=1e3,xo="undefined"!=typeof window.debugLevel?window.debugLevel:To,So=null,Po="en",Io={},Do={};f.prototype.init=function(){};var Lo={};jQuery(window).on("beforeunload",C);var No={unsupported:'<div class="{{baseClass}}-unsupported-overlay"></div> <div class="{{baseClass}}-unsupported-content"> It has been detected that you a using a browser that is not supported by Raptor, please use one of the following browsers: <ul> <li><a href="http://www.google.com/chrome">Google Chrome</a></li> <li><a href="http://www.firefox.com">Mozilla Firefox</a></li> <li><a href="http://www.google.com/chromeframe">Internet Explorer with Chrome Frame</a></li> </ul> <div class="{{baseClass}}-unsupported-input"> <button class="{{baseClass}}-unsupported-close">Close</button> <input name="{{baseClass}}-unsupported-show" type="checkbox" /> <label>Don\'t show this message again</label> </div> <div>',"class-menu.item":'<li><a data-value="{{value}}">{{label}}</a></li>',"click-button-to-edit.button":"<button class=\"{{baseClass}}-button\">tr('clickButtonToEditPluginButton')</button>","color-menu-basic.menu":'<li><a data-color="automatic"><div class="{{baseClass}}-swatch" style="display: none"></div> <span>tr(\'colorMenuBasicAutomatic\')</span></a></li> <li><a data-color="white"><div class="{{baseClass}}-swatch" style="background-color: #ffffff"></div> <span>tr(\'colorMenuBasicWhite\')</span></a></li> <li><a data-color="black"><div class="{{baseClass}}-swatch" style="background-color: #000000"></div> <span>tr(\'colorMenuBasicBlack\')</span></a></li> <li><a data-color="grey"><div class="{{baseClass}}-swatch" style="background-color: #999"></div> <span>tr(\'colorMenuBasicGrey\')</span></a></li> <li><a data-color="blue"><div class="{{baseClass}}-swatch" style="background-color: #4f81bd"></div> <span>tr(\'colorMenuBasicBlue\')</span></a></li> <li><a data-color="red"><div class="{{baseClass}}-swatch" style="background-color: #c0504d"></div> <span>tr(\'colorMenuBasicRed\')</span></a></li> <li><a data-color="green"><div class="{{baseClass}}-swatch" style="background-color: #9bbb59"></div> <span>tr(\'colorMenuBasicGreen\')</span></a></li> <li><a data-color="purple"><div class="{{baseClass}}-swatch" style="background-color: #8064a2"></div> <span>tr(\'colorMenuBasicPurple\')</span></a></li> <li><a data-color="orange"><div class="{{baseClass}}-swatch" style="background-color: #f79646"></div> <span>tr(\'colorMenuBasicOrange\')</span></a></li>',"embed.dialog":'<div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a>tr(\'embedDialogTabCode\')</a></li> <li class="ui-state-default ui-corner-top"><a>tr(\'embedDialogTabPreview\')</a></li> </ul> <div class="{{baseClass}}-code-tab"> <p>tr(\'embedDialogTabCodeContent\')</p> <textarea></textarea> </div> <div class="{{baseClass}}-preview-tab" style="display: none"> <p>tr(\'embedDialogTabPreviewContent\')</p> <div class="{{baseClass}}-preview"></div> </div> </div>',"image-resize.dialog":'<div class="raptor-resize-image"> <div> <label for="{{baseClass}}-width">tr(\'imageResizeDialogWidth\')</label> <input class="form-text" id="{{baseClass}}-width" name="width" type="text" placeholder="tr(\'imageResizeDialogWidthPlaceHolder\')"/> </div> <div> <label for="{{baseClass}}-height">tr(\'imageResizeDialogHeight\')</label> <input class="form-text" id="{{baseClass}}-height" name="height" type="text" placeholder="tr(\'imageResizeDialogHeightPlaceHolder\')"/> </div> <div class="{{baseClass}}-lock-proportions-container"> <span class="{{baseClass}}-lock-proportions"> <span class="ui-button-text">Constrain proportions</span> <span class="ui-icon ui-icon-locked"></span> </span> </div> </div>',"insert-file.dialog":'<div> <div> <label class="form-label">tr(\'insertFileURLLabel\')</label> <input type="text" name="location" class="form-text" placeholder="tr(\'insertFileURLPlaceHolder\')"/> </div> <div> <label class="form-label">tr(\'insertFileNameLabel\')</label> <input type="text" name="name" class="form-text" placeholder="tr(\'insertFileNamePlaceHolder\')"/> </div> </div>',"link.dialog":'<div style="display:none" class="{{baseClass}}-panel"> <div class="{{baseClass}}-menu"> <p>tr(\'linkCreateDialogMenuHeader\')</p> <fieldset data-menu=""></fieldset> </div> <div class="{{baseClass}}-wrap"> <div class="{{baseClass}}-content" data-content=""></div> </div> </div>',"link.document":'<h2>tr(\'linkTypeDocumentHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-href">tr(\'linkTypeDocumentLocationLabel\')</label> <input id="{{baseClass}}-document-href" value="http://" name="location" class="{{baseClass}}-document-href" type="text" placeholder="tr(\'linkTypeDocumentLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeDocumentNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-target"> <input id="{{baseClass}}-document-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeDocumentNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeDocumentInfo\')',"link.email":'<h2>tr(\'linkTypeEmailHeader\')</h2> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email">tr(\'linkTypeEmailToLabel\')</label> <input id="{{baseClass}}-email" name="email" type="text" placeholder="tr(\'linkTypeEmailToPlaceHolder\')"/> </fieldset> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email-subject">tr(\'linkTypeEmailSubjectLabel\')</label> <input id="{{baseClass}}-email-subject" name="subject" type="text" placeholder="tr(\'linkTypeEmailSubjectPlaceHolder\')"/> </fieldset>',"link.error":'<div style="display:none" class="ui-widget {{baseClass}}-error-message {{messageClass}}"> <div class="ui-state-error ui-corner-all"> <p> <span class="ui-icon ui-icon-alert"></span> {{message}} </p> </div> </div>',"link.external":'<h2>tr(\'linkTypeExternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'linkTypeExternalLocationLabel\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'linkTypeExternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeExternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeExternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeExternalInfo\')',"link.file-url":'<h2>tr(\'Link to a document or other file\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'Location\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'Enter your URL\')" /> </fieldset> <h2>tr(\'New window\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'Check this box to have the file open in a new browser window\')</span> </label> </fieldset> <h2>tr(\'Not sure what to put in the box above?\')</h2> <ol> <li>tr(\'Ensure the file has been uploaded to your website\')</li> <li>tr(\'Open the uploaded file in your browser\')</li> <li>tr("Copy the file\'s URL from your browser\'s address bar and paste it into the box above")</li> </ol>',"link.internal":'<h2>tr(\'linkTypeInternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-href">tr(\'linkTypeInternalLocationLabel\') {{domain}}</label> <input id="{{baseClass}}-internal-href" value="" name="location" class="{{baseClass}}-internal-href" type="text" placeholder="tr(\'linkTypeInternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeInternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-target"> <input id="{{baseClass}}-internal-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeInternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeInternalInfo\')',"link.label":'<label> <input type="radio" name="link-type" autocomplete="off"/> <span>{{label}}</span> </label>',"paste.dialog":'<div class="{{baseClass}}-panel ui-dialog-content ui-widget-content"> <div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="{{baseClass}}-tab-formatted-clean ui-state-default ui-corner-top ui-state-active ui-tabs-selected" style="display: none"><a>tr(\'pasteDialogFormattedCleaned\')</a></li> <li class="{{baseClass}}-tab-plain-text ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogPlain\')</a></li> <li class="{{baseClass}}-tab-formatted-unclean ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogFormattedUnclean\')</a></li> <li class="{{baseClass}}-tab-source ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogSource\')</a></li> </ul> <div class="{{baseClass}}-content-formatted-clean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-markup"></div> </div> <div class="{{baseClass}}-content-plain-text" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-plain"></textarea> </div> <div class="{{baseClass}}-content-formatted-unclean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-rich"></div> </div> <div class="{{baseClass}}-content-source" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-source"></textarea> </div> </div> </div>',"snippet-menu.item":'<li><a data-name="{{name}}">{{name}}</a></li>',"special-characters.dialog":"<div> tr('specialCharactersHelp') <br/> <ul></ul> </div>","special-characters.tab-button":'<button data-setKey="{{setKey}}" data-charactersIndex="{{charactersIndex}}" title="{{description}}">{{htmlEntity}}</button>',"special-characters.tab-content":'<div id="{{baseClass}}-{{key}}"></div>',"special-characters.tab-li":'<li><a href="#{{baseClass}}-{{key}}">{{name}}</a></li>',"table.create-menu":'<table class="{{baseClass}}-menu"> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table>',"tag-menu.menu":"<li><a data-value=\"na\">tr('tagMenuTagNA')</a></li> <li><a data-value=\"p\">tr('tagMenuTagP')</a></li> <li><a data-value=\"h1\">tr('tagMenuTagH1')</a></li> <li><a data-value=\"h2\">tr('tagMenuTagH2')</a></li> <li><a data-value=\"h3\">tr('tagMenuTagH3')</a></li> <li><a data-value=\"h4\">tr('tagMenuTagH4')</a></li> <li><a data-value=\"div\">tr('tagMenuTagDiv')</a></li> <li><a data-value=\"pre\">tr('tagMenuTagPre')</a></li> <li><a data-value=\"address\">tr('tagMenuTagAddress')</a></li>","unsaved-edit-warning.warning":'<div class="{{baseClass}} ui-corner-tl"> <span class="ui-icon ui-icon-alert"></span> <span>tr(\'unsavedEditWarningText\')</span> </div>',"view-source.dialog":'<div class="{{baseClass}}-inner-wrapper"> <textarea></textarea> </div>',"lorem-ipsum.lorem-ipsum":"<h1>Sed erat aequius Triarium aliquid de dissensione nostra iudicare.</h1> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Si mala non sunt, iacet omnis ratio Peripateticorum. Sic enim censent, oportunitatis esse beate vivere. Cum id fugiunt, re eadem defendunt, quae Peripatetici, verba. <i>Istam voluptatem, inquit, Epicurus ignorat?</i> Ita fit cum gravior, tum etiam splendidior oratio. Expectoque quid ad id, quod quaerebam, respondeas. Maximas vero virtutes iacere omnis necesse est voluptate dominante. Duo Reges: constructio interrete. <a href='http://loripsum.net/' target='_blank'>Erat enim res aperta.</a> </p> <p>Cum id fugiunt, re eadem defendunt, quae Peripatetici, verba. Hic ambiguo ludimur. Quae quidem sapientes sequuntur duce natura tamquam videntes; Dic in quovis conventu te omnia facere, ne doleas. ALIO MODO. Qui enim existimabit posse se miserum esse beatus non erit. Haec bene dicuntur, nec ego repugno, sed inter sese ipsa pugnant. Nec lapathi suavitatem acupenseri Galloni Laelius anteponebat, sed suavitatem ipsam neglegebat; Hoc est non dividere, sed frangere. Potius ergo illa dicantur: turpe esse, viri non esse debilitari dolore, frangi, succumbere. <a href='http://loripsum.net/' target='_blank'>Quod vestri non item.</a> Quid est enim aliud esse versutum? </p> <h2>Profectus in exilium Tubulus statim nec respondere ausus;</h2> <p>Atque hoc loco similitudines eas, quibus illi uti solent, dissimillimas proferebas. Quae contraria sunt his, malane? <code>Eam tum adesse, cum dolor omnis absit;</code> Efficiens dici potest. Erat enim res aperta. <a href='http://loripsum.net/' target='_blank'>Traditur, inquit, ab Epicuro ratio neglegendi doloris.</a> Nonne videmus quanta perturbatio rerum omnium consequatur, quanta confusio? </p> <ol> <li>Ergo, si semel tristior effectus est, hilara vita amissa est?</li> <li>An vero displicuit ea, quae tributa est animi virtutibus tanta praestantia?</li> <li>Illa tamen simplicia, vestra versuta.</li> </ol> <ul> <li>Vide, quantum, inquam, fallare, Torquate.</li> <li>Ratio quidem vestra sic cogit.</li> <li>Atque hoc loco similitudines eas, quibus illi uti solent, dissimillimas proferebas.</li> <li>Istam voluptatem, inquit, Epicurus ignorat?</li> </ul> <h3>Dici enim nihil potest verius.</h3> <p>Et non ex maxima parte de tota iudicabis? Non minor, inquit, voluptas percipitur ex vilissimis rebus quam ex pretiosissimis. Omnes enim iucundum motum, quo sensus hilaretur. Varietates autem iniurasque fortunae facile veteres philosophorum praeceptis instituta vita superabat. Est enim tanti philosophi tamque nobilis audacter sua decreta defendere. Et ille ridens: Video, inquit, quid agas; At enim hic etiam dolore. Deinde disputat, quod cuiusque generis animantium statui deceat extremum. Beatus autem esse in maximarum rerum timore nemo potest. Rationis enim perfectio est virtus; Nemo igitur esse beatus potest. Hoc enim constituto in philosophia constituta sunt omnia. </p> <dl> <dt><dfn>Immo videri fortasse.</dfn></dt> <dd>Graecis hoc modicum est: Leonidas, Epaminondas, tres aliqui aut quattuor;</dd> <dt><dfn>Tubulo putas dicere?</dfn></dt> <dd>Honesta oratio, Socratica, Platonis etiam.</dd> <dt><dfn>Praeteritis, inquit, gaudeo.</dfn></dt> <dd>Et quidem saepe quaerimus verbum Latinum par Graeco et quod idem valeat;</dd> <dt><dfn>Scaevolam M.</dfn></dt> <dd>Cum autem venissemus in Academiae non sine causa nobilitata spatia, solitudo erat ea, quam volueramus.</dd> </dl> <h4>In schola desinis.</h4> <p>Tuo vero id quidem, inquam, arbitratu. <b>At, si voluptas esset bonum, desideraret.</b> Duo enim genera quae erant, fecit tria. Obsecro, inquit, Torquate, haec dicit Epicurus? </p> <blockquote cite='http://loripsum.net'> Atque haec contra Aristippum, qui eam voluptatem non modo summam, sed solam etiam ducit, quam omnes unam appellamus voluptatem. </blockquote> <pre> Idem fecisset Epicurus, si sententiam hanc, quae nunc Hieronymi est, coniunxisset cum Aristippi vetere sententia. Aut haec tibi, Torquate, sunt vituperanda aut patrocinium voluptatis repudiandum. </pre>","revisions.apply-dialog":"<div class=\"{{baseClass}}-apply-dialog\">tr('revisionsApplyDialogContent')</div>","revisions.dialog":'<div class="{{baseClass}}-inner-wrapper"></div>',"revisions.diff-dialog":'<div class="{{baseClass}}-diff"></div>',"revisions.table":'<table class="{{baseClass}}-table"> <thead> <tr> <th class="ui-widget-header">tr(\'revisionsCreated\')</th> <th class="ui-widget-header"></th> </thead> <tbody></tbody> </table>',"revisions.tr":'<tr> <td class="{{baseClass}}-updated"></td> <td class="{{baseClass}}-controls"></td> </tr>'};r("en","English",{alignCenterTitle:"Align text center",alignJustifyTitle:"Align text justify",alignLeftTitle:"Align text left",alignRightTitle:"Align text right",cancelDialogCancelButton:"Continue Editing",cancelDialogContent:"Are you sure you want to cancel editing? All changes will be lost!",cancelDialogOKButton:"Cancel Editing",cancelDialogTitle:"Cancel Editing",cancelTitle:"Cancel editing",classMenuTitle:"Style picker",cleanBlockTitle:"Clean block",clearFormattingTitle:"Clear formatting",clickButtonToEditText:"Edit",clickButtonToEditTitle:null,closeTitle:"Close this toolbar",colorMenuBasicAutomatic:"Automatic",colorMenuBasicBlack:"Black",colorMenuBasicBlue:"Blue",colorMenuBasicGreen:"Green",colorMenuBasicGrey:"Grey",colorMenuBasicOrange:"Orange",colorMenuBasicPurple:"Purple",colorMenuBasicRed:"Red",colorMenuBasicTitle:"Change text color",colorMenuBasicWhite:"White",dockToElementTitle:"Dock/undock editor to element",dockToScreenTitle:"Dock/undock editor to screen",embedTitle:"Embed object",embedDialogTitle:"Embed Object",embedDialogTabCode:"Embed Code",embedDialogTabCodeContent:"Paste your embed code into the text area below:",embedDialogTabPreview:"Preview",embedDialogTabPreviewContent:"A preview of your embedded object is displayed below:",embedDialogOKButton:"Embed Object",embedDialogCancelButton:"Cancel",errorUINoName:'UI "{{ui}}" is invalid (must have a name property)',errorUINotObject:'UI "{{ui}}" is invalid (must be an object)',errorUIOverride:'UI "{{name}}" has already been registered, and will be overwritten',editPageDialogTitle:"Edit Page",editPageDialogOKButton:"Save",editPageDialogCancelButton:"Cancel",floatLeftTitle:"Align image to the left",floatNoneTitle:"Remove image align",floatRightTitle:"Align image to the right",fontFamilyMenuTitle:"Choose your font",fontFamilyMenuFontDefault:"Default Font",fontFamilyMenuFontArial:"Arial",fontFamilyMenuFontPalatino:"Palatino",fontFamilyMenuFontGeorgia:"Georgia",fontFamilyMenuFontTimes:"Times New Roman",fontFamilyMenuFontComicSans:"Comic Sans",fontFamilyMenuFontImpact:"Impact",fontFamilyMenuFontCourier:"Courier New",guidesTitle:"Show element guides",historyRedoTitle:"Redo",historyUndoTitle:"Undo",hrCreateTitle:"Insert Horizontal Rule",imageResizeDialogWidth:"Image width",imageResizeDialogHeight:"Image height",imageResizeDialogWidthPlaceHolder:"Width",imageResizeDialogHeightPlaceHolder:"Height",imageResizeDialogTitle:"Resize Image",imageResizeDialogOKButton:"Resize",imageResizeDialogCancelButton:"Cancel",imageResizeTitle:"Resize this image",insertFileTitle:"Insert file",insertFileDialogTitle:"Insert file",insertFileDialogOKButton:"Insert file",insertFileDialogCancelButton:"Cancel",insertFileURLLabel:"File URL",insertFileNameLabel:"File Name",insertFileURLPlaceHolder:"File URL...",insertFileNamePlaceHolder:"File Name...",languageMenuTitle:"Change Language",loremIpsumTitle:"Insert dummy text for testing",listOrderedTitle:"Ordered list",listUnorderedTitle:"Unordered list",linkCreateTitle:"Insert Link",linkRemoveTitle:"Remove Link",linkCreateDialogTitle:"Insert Link",linkCreateDialogOKButton:"Insert Link",linkCreateDialogCancelButton:"Cancel",linkCreateDialogMenuHeader:"Choose a link type",linkTypeEmailLabel:"Email address",linkTypeEmailHeader:"Link to an email address",linkTypeEmailToLabel:"Email:",linkTypeEmailToPlaceHolder:"Enter email address",linkTypeEmailSubjectLabel:"Subject (optional):",linkTypeEmailSubjectPlaceHolder:"Enter subject",linkTypeExternalLabel:"Page on another website",linkTypeExternalHeader:"Link to a page on another website",linkTypeExternalLocationLabel:"Location:",linkTypeExternalLocationPlaceHolder:"Enter a URL",linkTypeExternalNewWindowHeader:"New window",linkTypeExternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeExternalInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on the web you want to link to.</li>    <li>Copy the web address from your browser's address bar and paste it into the box above.</li></ol>",linkTypeDocumentLabel:"Document or other file",linkTypeDocumentHeader:"Link to a document or other file",linkTypeDocumentLocationLabel:"Location:",linkTypeDocumentLocationPlaceHolder:"Enter a URL",linkTypeDocumentNewWindowHeader:"New window",linkTypeDocumentNewWindowLabel:"Check this box to have the file open in a new browser window/tab.",linkTypeDocumentInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Ensure the file has been uploaded to your website.</li>    <li>Open the uploaded file in your browser.</li>    <li>Copy the file's URL from your browser's address bar and paste it into the box above.</li></ol>",linkTypeInternalLabel:"Page on this website",linkTypeInternalHeader:"Link to a page on this website",linkTypeInternalLocationLabel:"",linkTypeInternalLocationPlaceHolder:"Enter a URI",linkTypeInternalNewWindowHeader:"New window",linkTypeInternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeInternalInfo:'<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on this site link to.</li>    <li>Copy the web address from your browser\'s address bar, excluding "{{domain}}" and paste it into the box above.</li></ol>',logoTitle:"Learn More About the Raptor WYSIWYG Editor",navigateAway:"\nThere are unsaved changes on this page. \nIf you navigate away from this page you will lose your unsaved changes",pasteDialogTitle:"Paste",pasteDialogOKButton:"Insert",pasteDialogCancelButton:"Cancel",pasteDialogPlain:"Plain Text",pasteDialogFormattedCleaned:"Formatted &amp; Cleaned",pasteDialogFormattedUnclean:"Formatted Unclean",pasteDialogSource:"Source Code",placeholderPluginDefaultContent:"<br/>",saveTitle:"Save content",saveNotConfigured:"Save has not been configured, or is disabled.",saveJsonFail:"Failed to save {{failed}} content block(s)",saveJsonSaved:"Successfully saved {{saved}} content block(s).",saveRestFail:"Failed to save {{failed}} content block(s).",saveRestPartial:"Saved {{saved}} out of {{failed}} content blocks.",saveRestSaved:"Successfully saved {{saved}} content block(s).",snippetMenuTitle:"Snippets",specialCharactersArrows:"Arrows",specialCharactersDialogOKButton:"OK",specialCharactersDialogTitle:"Insert Special Characters",specialCharactersGreekAlphabet:"Greek Alphabet",specialCharactersHelp:'Click a special character to add it. Click "OK" when done to close this dialog',specialCharactersMathematics:"Mathematics",specialCharactersSymbols:"Symbols",specialCharactersTitle:"Insert a special character",statisticsButtonCharacterOverLimit:"{{charactersRemaining}} characters over limit",statisticsButtonCharacterRemaining:"{{charactersRemaining}} characters remaining",statisticsButtonCharacters:"{{characters}} characters",statisticsDialogCharactersOverLimit:"{{characters}} characters, {{charactersRemaining}} over the recommended limit",statisticsDialogCharactersRemaining:"{{characters}} characters, {{charactersRemaining}} remaining",statisticsDialogNotTruncated:"Content will not be truncated",statisticsDialogOKButton:"Ok",statisticsDialogSentence:"{{sentences}} sentence",statisticsDialogSentences:"{{sentences}} sentences",statisticsDialogTitle:"Content Statistics",statisticsDialogTruncated:"Content contains more than {{limit}} characters and may be truncated",statisticsDialogWord:"{{words}} word",statisticsDialogWords:"{{words}} words",statisticsTitle:"Click to view statistics",imageSwapTitle:"Swap this image",tableCreateTitle:"Create table",tableDeleteColumnTitle:"Delete table column",tableDeleteRowTitle:"Delete table row",tableInsertColumnTitle:"Insert table column",tableInsertRowTitle:"Insert table row",tableMergeCellsTitle:"Merge table cells",tableSplitCellsTitle:"Split table cells",tagMenuTagH1:"Heading&nbsp;1",tagMenuTagH2:"Heading&nbsp;2",tagMenuTagH3:"Heading&nbsp;3",tagMenuTagH4:"Heading&nbsp;4",tagMenuTagNA:"N/A",tagMenuTagP:"Paragraph",tagMenuTagDiv:"Div",tagMenuTagPre:"Pre-formatted",tagMenuTagAddress:"Address",tagMenuTitle:"Change element style",tagTreeElementLink:"Select {{element}} element",tagTreeElementTitle:'Click to select the contents of the "{{element}}" element',tagTreeRoot:"root",tagTreeRootLink:"Select all editable content",tagTreeRootTitle:"Click to select all editable content",textBlockQuoteTitle:"Block quote",textBoldTitle:"Bold",textItalicTitle:"Italic",textStrikeTitle:"Strike through",textSubTitle:"Sub-script",textSuperTitle:"Super-script",textUnderlineTitle:"Underline",textSizeDecreaseTitle:"Decrease text size",textSizeIncreaseTitle:"Increase text size",unsavedEditWarningText:"There are unsaved changes on this page",revisionsText:"Revisions",revisionsTextEmpty:"No Revisions",revisionsTitle:null,revisionsCreated:"Created",revisionsApplyButtonTitle:"Rollback",revisionsApplyButtonText:"Rollback",revisionsAJAXFailed:"Failed to retrieve revisions",revisionsApplyButtonDialogCancelButton:"Cancel",revisionsApplyButtonDialogOKButton:"Rollback",revisionsApplyButtonDialogTitle:"Rollback Confirmation",revisionsApplyDialogContent:"This will replace the current content with the selected revision.<br/>The current content will be added as a revision, and will be visible in the revisions list for this block.",revisionsDialogCancelButton:"Cancel",revisionsDialogTitle:"View content revisions",revisionsButtonCurrent:"Current",revisionsButtonViewDiffText:"Differences",revisionsButtonViewDiffTitle:null,revisionsDiffButtonDialogCancelButton:"Close",revisionsDiffButtonDialogTitle:"View differences",revisionsDiffButtonTitle:"View differences",revisionsDiffButtonText:"View differences",revisionsLoading:"Loading revisions...",revisionsNone:"No revisions for this element",revisionsPreviewButtonTitle:"Preview",revisionsPreviewButtonText:"Preview",fileManagerDialogTitle:"File Manager",fileManagerTitle:"File Manager",rfmClose:"Close",rfmContinue:"Continue",rfmDeleteTitle:"Delete",rfmDownloadTitle:"Download",rfmEditTitle:"Edit",rfmFileActions:"Actions",rfmFileModificationTime:"Modified",rfmFileName:"Name",rfmFileSize:"Size",rfmFileType:"Type",rfmFilteredTotal:"Showing {{start}} to {{end}} of {{filteredTotal}} files",rfmFirst:"First",rfmHeadingDirectories:"Directories",rfmHeadingSearch:"Search",rfmHeadingTags:"Tags",rfmHeadingUpload:"Upload",rfmInsertTitle:"Insert",rfmLast:"Last",rfmRenameTitle:"Rename",rfmSearch:"Go",rfmTagDocument:"Document",rfmTagImage:"Image",rfmTotal:", filtered from {{total}}",rfmUpload:"Upload",rfmUploadBrowse:"Browse",rfmUploadDrop:"Drop Files Here",rfmUploadFileRemove:"Remove",rfmUploadOr:"or",rfmViewTitle:"View",imageEditorDialogCancelButton:"Cancel",imageEditorDialogOKButton:"Save",imageEditorDialogTitle:"Image Editor",imageEditorTitle:"Edit Image",rieApply:"Apply",rieBlurTitle:"Blur",rieBrightnessTitle:"Brightness/Contrast",rieCancel:"Cancel",rieCancelTitle:"Cancel",rieColorAdjustTitle:"Adjsut Color",rieCropTitle:"Crop",rieDesaturateTitle:"Desaturate",rieFlipHTitle:"Flip Horizontally",rieFlipVTitle:"Flip Vertically",rieGlowTitle:"Glow",rieHslTitle:"Hue, Saturation, Lightness.",rieInvertTitle:"Invert",riePosterizeTitle:"Posterize",rieRedoTitle:"Redo",rieRemoveNoiseTitle:"Remove Noise",rieResizeTitle:"Resize",rieRevertTitle:"Revert",rieRotateLeftTitle:"Rotate Left",rieRotateRightTitle:"Rotate Right",rieSaveTitle:"Save",rieSaveTitle:"Save",rieSepiaTitle:"Sepia",rieSharpenTitle:"Sharpen",rieSolarizeTitle:"Solarize",rieUndoTitle:"Undo",rieUploadTitle:"Upload",rieActionColorAdjustRed:"Red",rieActionColorAdjustGreen:"Green",rieActionColorAdjustBlue:"Blue",rieActionBrightnessBrightness:"Brightness",rieActionBrightnessContrast:"Contrast",rieActionGlowAmount:"Glow Amount",rieActionGlowRadius:"Glow Radius",rieActionHsl:"Hue",rieActionHsl:"Saturation",rieActionHsl:"Lightness",rieActionPosterize:"Levels",viewSourceDialogCancelButton:"Close",viewSourceDialogOKButton:"Apply source code",viewSourceDialogTitle:"Content source code",viewSourceTitle:"View/edit source code"});
var Bo=["a","abbr","acronym","applet","b","basefont","bdo","big","br","button","cite","code","dfn","em","font","i","iframe","img","input","kbd","label","map","object","p","q","s","samp","select","small","span","strike","strong","sub","sup","textarea","tt","u","var","h1","h2","h3","h4","h5","h6"],Ro=["article","nav","section","footer","blockquote","body","button","center","dd","div","fieldset","form","iframe","li","noframes","noscript","object","td","th"],Ao=["body","center","dd","div","dt","fieldset","form","iframe","li","td","th"],Mo=["address","blockquote","body","button","center","dd","div","fieldset","form","iframe","li","noframes","noscript","object","td","th"],Ho=!1,Oo=jQuery;Oo(function(){rangy.initialized||rangy.init(),Oo.isFunction(rangy.rangePrototype.insertNodeAtEnd)||(rangy.rangePrototype.insertNodeAtEnd=function(e){var t=this.cloneRange();t.collapse(!1),t.insertNode(e),t.detach(),this.setEndAfter(e)})}),Oo("html").click(function(){Oo(".ui-editor-selectmenu-visible").removeClass("ui-editor-selectmenu-visible")});var Uo,Fo,jo,zo,qo;Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t}),"undefined"==typeof Node&&(Node={TEXT_NODE:3}),"".trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}),"undefined"==typeof jQuery?t("jQuery is required"):jQuery.ui?jQuery.ui.dialog?jQuery.ui.position||t("jQuery UI Position is required."):t("jQuery UI Dialog is required."):t("jQuery UI is required"),"undefined"==typeof rangy&&t('Rangy is required. This library should have been included with the file you downloaded. If not, acquire it here: http://code.google.com/p/rangy/"');var Wo=Mn("1.9.0",jQuery.fn.jquery);"1.9.0"===Wo&&t("jQuery version should be at least 1.9.0");var Qo=Mn("1.10.0",jQuery.ui.version);"1.10.0"===Qo&&t("jQuery UI version should be at least 1.9.0");var Go={globalDefaults:{},defaults:{},enableHotkeys:!0,hotkeys:{},plugins:{},ui:{},layouts:{},presets:{},hoverPanels:{},instances:[],getInstances:function(){return this.instances},eachInstance:function(e){for(var t=0;t<this.instances.length;t++)e.call(this.instances[t],this.instances[t])},urlPrefix:"/raptor/",getTemplate:function(e,t){var i;if(this.templates[e])i=this.templates[e];else{var n=t||this.urlPrefix,o=e.split(".");n+=1===o.length?"templates/"+o[0]+".html":"plugins/"+o[0]+"/templates/"+o.splice(1).join("/")+".html",Oo.ajax({url:n,type:"GET",async:!1,cache:!1,timeout:15e3,error:function(){i=null},success:function(e){i=e}}),this.templates[e]=i}return i},isDirty:function(){for(var e=this.getInstances(),t=0;t<e.length;t++)if(e[t].isDirty())return!0;return!1},unloadWarning:function(){for(var e=this.getInstances(),t=0;t<e.length;t++)if(e[t].isDirty()&&e[t].isEditing()&&e[t].options.unloadWarning)return c("navigateAway")},registerUi:function(e){return"object"!=typeof e?(t(c("errorUINotObject",{ui:e})),void 0):"string"!=typeof e.name?(t(c("errorUINoName",{ui:e})),void 0):(this.ui[e.name]&&t(c("errorUIOverride",{name:e.name})),this.ui[e.name]=e,void 0)},registerLayout:function(e){return"object"!=typeof e?(t('Layout "'+e+'" is invalid (must be an object)'),void 0):"string"!=typeof e.name?(t('Layout "'+e+'" is invalid (must have a name property)'),void 0):(this.layouts[e.name]&&t('Layout "'+e.name+'" has already been registered, and will be overwritten'),this.layouts[e.name]=e,void 0)},registerPlugin:function(e){return"object"!=typeof e?(t('Plugin "'+e+'" is invalid (must be an object)'),void 0):"string"!=typeof e.name?(t('Plugin "'+e+'" is invalid (must have a name property)'),void 0):(this.plugins[e.name]&&t('Plugin "'+e.name+'" has already been registered, and will be overwritten'),this.plugins[e.name]=e,void 0)},registerPreset:function(e,i){return"object"!=typeof e?(t('Preset "'+e+'" is invalid (must be an object)'),void 0):"string"!=typeof e.name?(t('Preset "'+e+'" is invalid (must have a name property)'),void 0):(this.presets[e.name]&&t('Preset "'+e.name+'" has already been registered, and will be overwritten'),this.presets[e.name]=e,i&&(this.defaults=e),void 0)},persist:function(e,t,i){e=i?i+"."+e:e;try{if(localStorage){var n;if(n=localStorage.uiWidgetEditor?JSON.parse(localStorage.uiWidgetEditor):{},void 0===t)return n[e];n[e]=t,localStorage.uiWidgetEditor=JSON.stringify(n)}}catch(o){}return t}},Vo=!1,_o={_init:function(){if(this.element.attr("data-raptor-initialised"))return xo>=Eo&&e("Raptor already initialised, attempted to reinitialise on: ",this.element),void 0;this.element.attr("data-raptor-initialised",!0),-1===Oo.inArray(this,Go.instances)&&Go.instances.push(this);var i=this;Go.eachInstance(function(e){i!=e&&i.element.closest(e.element).length&&t("Nesting editors is unsupported",i.element,e.element)});var n=this.persist("locale")||this.options.initialLocale;n&&(So=n);var o=this.options;this.options=this.options.preset?Oo.extend(!0,{},Go.globalDefaults,Go.presets[this.options.preset],this.options):Oo.extend(!0,{},Go.globalDefaults,Go.defaults,this.options),o.layouts&&o.layouts.toolbar&&o.layouts.toolbar.uiOrder&&(this.options.layouts.toolbar.uiOrder=o.layouts.toolbar.uiOrder),this.element.attr("id")||this.element.attr("id",Nt()),this.ready=!1,this.events={},this.plugins={},this.layouts={},this.templates=Oo.extend({},Go.templates),this.target=this.element,this.layout=null,this.previewState=null,this.pausedState=null,this.pausedScrollX=null,this.pausedScrollY=null,this.enabled=!1,this.initialised=!1,this.uiObjects={},this.hotkeys={},this.hotkeysSuspended=!1,this.options.enableHotkeys&&this.registerHotkey(this.hotkeys);for(var s in this.options.bind)this.bind(s,this.options.bind[s]);this.history=[],this.present=0,this.historyEnabled=!0,An()&&(this.setOriginalHtml(this.element.is(":input")?this.element.val():this.element.html()),this.historyPush(this.getOriginalHtml()),this.element.is(":input")&&this.replaceOriginal(),this.loadPlugins(),this.dirty=!1,this.previousContent=null,this.previousSelection=null,this.getElement().addClass("raptor-editable-block"),this.loadLayouts(),this.ready=!0,this.fire("ready"),this.options.autoEnable&&Oo(function(){i.enableEditing()}))},attach:function(){this.bind("change",this.historyPush),this.getElement().on("click.raptor","img",function(e){Bi(e.target),this.checkSelectionChange()}.bind(this)),this.getElement().on("focus.raptor",this.showLayout.bind(this)),this.target.on("mouseup.raptor",this.checkSelectionChange.bind(this)),this.target.on("input.raptor",this.checkChange.bind(this)),Oo(window).bind("beforeunload",Go.unloadWarning.bind(Go));var e=this;Oo(window).resize(function(){e.fire("resize")})},detach:function(){this.unbind("change"),this.getElement().off("click.raptor","img"),this.getElement().off("focus.raptor"),this.getElement().blur(),this.target.off("mouseup.raptor"),this.target.off("keyup.raptor")},localeChange:function(){if(!this.ready){var e;return e=function(){this.unbind("ready",e),this.localeChange()},this.bind("ready",e),void 0}this.actionPreviewRestore();var t=[];for(var i in this.layouts)this.layouts[i].isVisible()&&t.push(i);this.layoutsDestruct(),this.events={},this.plugins={},this.uiObjects={},this.hotkeys={},this.loadPlugins(),this.loadLayouts();for(var n=0;n<t.length;n++)this.layouts[t[n]].show();this.checkSelectionChange()},restoreFocus:function(){this.getElement().focus()},getElement:function(){return this.target},getNode:function(){return this.target[0]},getOriginalElement:function(){return this.element},replaceOriginal:function(){if(this.target.is(":input")){for(var e=Oo("<div/>").html(this.element.val()).insertBefore(this.element).attr("id",Nt()).addClass(this.element.attr("class")).addClass(this.options.classes),t=Et(this.element),i=0;i<this.options.replaceStyle.length;i++)e.css(this.options.replaceStyle[i],t[this.options.replaceStyle[i]]);this.element.hide(),this.bind("change",function(){this.getOriginalElement().is(":input")?this.getOriginalElement().val(this.getHtml()).trigger("input"):this.getOriginalElement().html(this.getHtml())}),this.target=e}},checkSelectionChange:function(){var e=rangy.serializeSelection(null,!1);this.previousSelection!==e&&this.fire("selectionChange"),this.previousSelection=e},checkChange:function(){var e=this.getHtml(),t=this.dirty;this.dirty=this.originalHtml!==e,this.previousHtml!==e&&(this.previousHtml=e,this.fire("change",[e]),t!==this.dirty&&(this.dirty?this.fire("dirty"):this.fire("cleaned")),this.checkSelectionChange())},change:function(){this.fire("change",[this.getHtml()])},destruct:function(){this.disableEditing(),this.fire("destroy"),this.events={},this.getElement().off(".raptor"),this.getOriginalElement().is(":input")&&(this.target.remove(),this.target=null,this.element.show()),this.layoutsDestruct()},actionPreview:function(e){this.actionPreviewRestore();try{var i=this.fire("selectionCustomise");i.length>0?this.previewState=K(this.previewState,this.target,function(){for(var t=0,n=i.length;n>t;t++)rangy.getSelection().setSingleRange(i[t]),this.selectionConstrain(),e()}.bind(this)):(this.selectionConstrain(),this.previewState=K(this.previewState,this.target,e)),this.checkSelectionChange()}catch(n){t(n)}},actionPreviewRestore:function(){this.previewState&&(this.target=J(this.previewState,this.target),this.previewState=null,this.checkSelectionChange())},actionApply:function(e){this.actionPreviewRestore();var i=this.stateSave();try{var n=this.fire("selectionCustomise");n.length>0?$(function(){for(var t=0,i=n.length;i>t;t++)rangy.getSelection().setSingleRange(n[t]),this.selectionConstrain(),$(e,this.history)}.bind(this),this.history):(this.selectionConstrain(),$(e,this.history)),this.checkChange()}catch(o){this.stateRestore(i),t(o)}},actionUndo:function(){},actionRedo:function(){},stateSave:function(){return this.selectionConstrain(),un(this.target)},stateRestore:function(e){var t=pn(this.target,e),i=rangy.getSelection();this.target=t.element,null!==t.ranges&&(i.setRanges(t.ranges),i.refresh())},selectionConstrain:function(){en(this.target[0])},pause:function(){this.pausedState||(this.pausedState=this.stateSave(),this.suspendHotkeys(),this.pausedScrollX=window.scrollX,this.pausedScrollY=window.scrollY)},resume:function(){this.pausedState&&(this.stateRestore(this.pausedState),this.pausedState=null,this.resumeHotkeys(),this.restoreFocus(),window.scrollTo(this.pausedScrollX,this.pausedScrollY))},persist:function(e,t){return this.options.persistence?Go.persist(e,t,this.options.namespace):null},enableEditing:function(){if(!this.enabled){if(this.fire("enabling"),this.attach(),this.enabled=!0,this.getElement().addClass(this.options.baseClass+"-editing").addClass(this.options.classes),this.options.partialEdit?this.getElement().find(this.options.partialEdit).prop("contenteditable",!0):this.getElement().prop("contenteditable",!0),!this.initialised){this.initialised=!0;for(var e in this.plugins)this.plugins[e].enable();this.bindHotkeys(),this.getElement().closest("form").on("submit.raptor",function(){rt(this.getElement()),this.fire("change",[this.getHtml()])}.bind(this))}rt(this.getElement()),this.fire("enabled"),this.showLayout();var t=this.options.partialEdit?this.getElement().find("[contenteditable]")[0]:this.getNode();switch(this.options.autoSelect){case"all":Ni(t);break;case"start":var i=Oo(t).find("*:first")[0];if(!i){Ni(t);break}var n=rangy.createRange();n.setStartBefore(i),n.setEndBefore(i),Di(n);break;case"end":var i=Oo(t).find("*:last")[0];if(!i){Ni(t);break}Ni(i);var n=rangy.createRange();n.setStartAfter(i),n.setEndAfter(i),Di(n)}}},disableEditing:function(){this.enabled&&(this.detach(),this.enabled=!1,this.getElement().prop("contenteditable",!1).removeClass(this.options.baseClass+"-editing").removeClass(this.options.classes),rangy.getSelection().removeAllRanges(),this.fire("disabled"),this.options.reloadOnDisable&&!Vo&&(Vo=!0,window.location.reload()))},cancelEditing:function(){this.unify(function(e){e.stopEditing()})},stopEditing:function(){this.fire("cancel"),this.options.reloadOnDisable||this.resetHtml(),this.disableEditing(),this.dirty=!1,Si()},isEditing:function(){return this.enabled},isRoot:function(e){return this.getElement()[0]===Oo(e)[0]},unify:function(e,t){if(t!==!1&&e(this),this.options.unify){var i=this;Go.eachInstance(function(t){t!==i&&t.options.unify&&e(t)})}},getLayout:function(e){return"undefined"==typeof e?(n("Parameter 1 to getLayout is expected to be a layout type",e),void 0):this.layouts[e]},loadLayouts:function(){for(var e in this.options.layouts)"undefined"!=typeof Go.layouts[e]?(this.layouts[e]=this.prepareComponent(Go.layouts[e],this.options.layouts[e],"layout").instance,this.layouts[e].hotkeys&&this.registerHotkey(this.layouts[e].hotkeys,null,this.layouts[e])):t("Unknown layout type: "+e)},layoutsDestruct:function(){for(var e in this.layouts)this.layouts[e].destruct()},prepareComponent:function(e,i,n){var o=Oo.extend({},e),s=Oo.extend({},this.options,{baseClass:this.options.baseClass+"-"+n+"-"+T(e.name)},o.options,i);o.raptor=this,o.options=s,o.init||t("Component missing init function: "+o.name);var a=o.init();return{init:a,instance:o}},showLayout:function(){xo>=Eo&&e("Displaying layout",this.getElement()),this.unify(function(e){e.fire("layoutHide")},!1),this.fire("layoutShow"),this.fire("resize"),"undefined"==typeof this.getElement().attr("tabindex")&&this.getElement().attr("tabindex",-1)},getTemplate:function(e,i){return this.templates[e]||(this.templates[e]=E(e,this.options.urlPrefix)),this.templates[e]?k(this.templates[e],i):(t("Missing template: "+e),"**MISSING TEMPLATE: "+e+"**")},historyPush:function(){if(this.historyEnabled){var e=this.getHtml();e!==this.historyPeek()&&(this.present!==this.history.length-1&&(this.history=this.history.splice(0,this.present+1)),this.history.push(this.getHtml()),this.present=this.history.length-1,this.fire("historyChange"))}},historyPeek:function(){return this.history.length?this.history[this.present]:null},historyBack:function(){this.present>0&&(this.present--,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},historyForward:function(){this.present<this.history.length-1&&(this.present++,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},registerHotkey:function(e,i){return I(e)?(this.hotkeys[e]&&t('Hotkey "'+e+'" has already been registered, and will be overwritten'),this.hotkeys[e]=i,void 0):(n("Expected argument 1 to raptor.registerHotkey to be a string"),void 0)},bindHotkeys:function(){for(var e in this.hotkeys)this.getElement().on("keydown.raptor",e,function(e){if(this.isEditing()&&!this.hotkeysSuspended){var t=this.hotkeys[e.data]();t!==!1&&e.preventDefault()}}.bind(this))},suspendHotkeys:function(){xo>=Eo&&e("Disabling hotkeys"),this.hotkeysSuspended=!0},resumeHotkeys:function(){xo>=Eo&&e("Enabling hotkeys"),this.hotkeysSuspended=!1},isUiEnabled:function(t){return this.options.enableUi===!1&&"undefined"==typeof this.options.plugins[t]||this.options.plugins[t]===!1?(xo>=Eo&&e("UI with name "+t+" has been disabled "+(this.options.enableUi===!1?"by default":"manually")+" "+Oo.inArray(t,this.options.ui)),!1):-1!==Oo.inArray(t,this.options.disabledUi)||-1!==Oo.inArray(t,this.options.disabledPlugins)?(e("Using disabledUi/disabledPlugins options is deprecated, use plugins: { nameOfPlugin: false } instead."),!1):!0},getUi:function(e){return t("raptor.getUi() is deprecated, use raptor.getPlugin() instead."),this.uiObjects[e]},getPlugin:function(e){return this.uiObjects[e]||this.plugins[e]},loadPlugins:function(){var t=this;this.options.plugins||(this.options.plugins={});for(var i in Go.plugins)this.options.enablePlugins===!1&&"undefined"==typeof this.options.plugins[i]||this.options.plugins[i]===!1?xo>=Eo&&e("Not loading plugin "+i):-1===Oo.inArray(i,this.options.disabledUi)&&-1===Oo.inArray(i,this.options.disabledPlugins)?t.plugins[i]=this.prepareComponent(Go.plugins[i],t.options.plugins[i],"plugin").instance:e("Using disabledUi/disabledPlugins options is deprecated, use plugins: { nameOfPlugin: false } instead.")},isDirty:function(){return this.dirty},getHtml:function(){return this.getElement().html()},clean:function(){this.actionApply(function(){rt(this.getElement())}.bind(this))},setHtml:function(e){this.getElement().html(e),this.fire("html"),this.checkChange()},resetHtml:function(){this.setHtml(this.getOriginalHtml()),this.fire("cleaned")},getOriginalHtml:function(){return this.originalHtml},saved:function(e){this.setOriginalHtml(this.getHtml()),this.dirty=!1,this.fire("saved",e),this.fire("cleaned")},setOriginalHtml:function(e){this.originalHtml=e},bind:function(e,i,n){if("undefined"==typeof i||!Oo.isFunction(i))return t("Must bind a valid callback, "+e+" was a "+typeof i),void 0;for(var o=e.split(/,\s*/),s=0,a=o.length;a>s;s++)this.events[o[s]]||(this.events[o[s]]=[]),this.events[o[s]].push({context:n,callback:i})},unbind:function(e,t,i){for(var n=0,o=this.events[e].length;o>n;n++)this.events[e][n]&&this.events[e][n].callback===t&&this.events[e][n].context===i&&this.events[e].splice(n,1)},fire:function(t,i){var n=[];if(xo===ko&&e("Firing event: "+t),this.events[t])for(var o=0,s=this.events[t].length;s>o;o++){var a=this.events[t][o];if("undefined"!=typeof a&&"undefined"!=typeof a.callback){var r=a.callback.apply(a.context||this,i);"undefined"!=typeof r&&(n=n.concat(r))}}return n}};Oo.widget("ui.raptor",_o),Oo.fn.raptor.Raptor=Go,Hn.prototype.init=function(){},Hn.prototype.destruct=function(){},Hn.prototype.isVisible=function(){return!1},Hn.prototype.show=function(){},Hn.prototype.hide=function(){},On.prototype.init=function(){},On.prototype.enable=function(){},Un.prototype.appendTo=function(e,i){for(var n=0,o=this.uiOrder.length;o>n;n++){for(var s=Oo("<div/>").addClass(this.raptor.options.baseClass+"-layout-toolbar-group"),a=this.uiOrder[n],r=0,l=a.length;l>r;r++)if(this.raptor.isUiEnabled(a[r]))if(Go.ui[a[r]]){var d=this.raptor.options.plugins[a[r]];if(d===!1)continue;var c=this.raptor.prepareComponent(Go.ui[a[r]],d,"ui");c.instance.layout=e,this.raptor.uiObjects[a[r]]=c.instance,B(c.init)&&(c.init.removeClass("ui-corner-all"),s.append(c.init))}else t('UI identified by key "'+a[r]+'" does not exist');s.children().length>0&&s.appendTo(i)}i.find(".ui-button:first-child").addClass("ui-corner-left"),i.find(".ui-button:last-child").addClass("ui-corner-right")},Fn.prototype=Object.create(Hn.prototype),Fn.prototype.init=function(){this.raptor.bind("enabled",this.show.bind(this)),this.raptor.bind("disabled",this.hide.bind(this)),this.raptor.bind("layoutShow",this.show.bind(this)),this.raptor.bind("layoutHide",this.hide.bind(this)),Oo(window).resize(this.constrainPosition.bind(this))},Fn.prototype.destruct=function(){this.wrapper&&(this.wrapper.remove(),this.wrapper=null),this.raptor.fire("toolbarDestroy")},Fn.prototype.show=function(){this.isVisible()||(this.getElement().css("display",""),this.constrainPosition(),this.raptor.fire("toolbarShow"))},Fn.prototype.hide=function(){this.isReady()&&(this.getElement().css("display","none"),this.raptor.fire("toolbarHide"))},Fn.prototype.initDragging=function(){if(Oo.fn.draggable&&this.options.draggable&&!this.getElement().data("ui-draggable")){xo>=Eo&&e("Initialising toolbar dragging",this.raptor.getElement()),this.getElement().draggable({cancel:"a, button",cursor:"move",stop:this.constrainPosition.bind(this)}),this.getElement().css("position","fixed");var t=this.raptor.persist("position")||this.options.dialogPosition;t||(t=[10,10]),xo>=Eo&&e("Restoring toolbar position",this.raptor.getElement(),t),parseInt(t[0],10)+this.getElement().outerHeight()>Oo(window).height()&&(t[0]=Oo(window).height()-this.getElement().outerHeight()),parseInt(t[1],10)+this.getElement().outerWidth()>Oo(window).width()&&(t[1]=Oo(window).width()-this.getElement().outerWidth()),this.getElement().css({top:Math.abs(parseInt(t[0],10)),left:Math.abs(parseInt(t[1],10))})}},Fn.prototype.enableDragging=function(){Oo.fn.draggable&&this.options.draggable&&this.getElement().data("ui-draggable")&&this.getElement().draggable("enable")},Fn.prototype.disableDragging=function(){Oo.fn.draggable&&this.options.draggable&&this.getElement().is(".ui-draggable")&&this.getElement().draggable("disable").removeClass("ui-state-disabled")},Fn.prototype.isReady=function(){return null!==this.wrapper},Fn.prototype.isVisible=function(){return this.isReady()&&this.getElement().is(":visible")},Fn.prototype.constrainPosition=function(){if(this.isVisible()){var e=parseInt(this.wrapper.css("left"))||-999,t=parseInt(this.wrapper.css("top"))||-999,i=this.wrapper.outerWidth(),n=this.wrapper.outerHeight(),o=Oo(window).width(),s=Oo(window).height(),a=Math.max(0,Math.min(e,o-i)),r=Math.max(0,Math.min(t,s-n));(a!==e||r!==t)&&this.wrapper.css({left:a,top:r}),this.raptor.persist("position",[this.wrapper.css("top"),this.wrapper.css("left")])}},Fn.prototype.getElement=function(){if(null===this.wrapper){if(!this.options.uiOrder){this.options.uiOrder=[[]];for(var t in Go.ui)this.options.uiOrder[0].push(t)}xo>=Eo&&e("Loading toolbar",this.raptor.getElement());var i=this.toolbar=Oo("<div/>").addClass(this.options.baseClass+"-toolbar"),n=this.toolbarWrapper=Oo("<div/>").addClass(this.options.baseClass+"-inner").addClass("ui-widget-content").mousedown(function(e){e.preventDefault()}).append(i),o=this.path=Oo("<div/>").addClass(this.options.baseClass+"-path").addClass("ui-widget-header"),s=this.wrapper=Oo("<div/>").addClass(this.options.baseClass+"-outer "+this.raptor.options.baseClass+"-layout").css("display","none").append(o).append(n),a=new Un(this.raptor,this.options.uiOrder);a.appendTo(this,this.toolbar),Oo("<div/>").css("clear","both").appendTo(this.toolbar),Oo(function(){s.appendTo("body"),this.initDragging(),this.constrainPosition(!0),this.raptor.fire("layoutReady",[this.wrapper]),this.raptor.fire("toolbarReady",[this])}.bind(this))}return this.wrapper},Go.registerLayout(new Fn),jn.prototype=Object.create(Hn.prototype),jn.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this)),this.raptor.bind("enabled",this.enabled.bind(this))},jn.prototype.ready=function(){this.raptor.getElement().mouseenter(this.show.bind(this)).mouseleave(this.hide.bind(this))},jn.prototype.enabled=function(){this.getElement().hide()},jn.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=Oo("<div/>").addClass(this.raptor.options.baseClass+"-layout "+this.options.baseClass).mouseleave(this.hide.bind(this));var e=new Un(this.raptor,this.options.uiOrder);e.appendTo(this,this.hoverPanel),Oo(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},jn.prototype.show=function(){this.raptor.isEditing()||(this.visible=!0,this.getElement().show(),this.position(),this.raptor.getElement().addClass(this.raptor.options.baseClass+"-editable-block-hover"))},jn.prototype.hide=function(e){this.visible&&e&&(Oo.contains(this.getElement().get(0),e.relatedTarget)||e.relatedTarget!==this.getElement().get(0)&&this.getElement().get(0)!==Oo(e.relatedTarget).parent().get(0)&&(Oo.contains(this.raptor.getElement().get(0),e.relatedTarget)||e.relatedTarget!==this.raptor.getElement().get(0)&&(this.visible=!1,this.getElement().hide(),this.raptor.getElement().removeClass(this.raptor.options.baseClass+"-editable-block-hover"))))},jn.prototype.position=function(){if(this.visible){var e=wt(this.raptor.getElement());this.getElement().css({top:e.top+(e.height/2-this.getElement().outerHeight()/2),left:e.left+(e.width/2-this.getElement().outerWidth()/2)})}},jn.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},Go.registerLayout(new jn),zn.prototype=Object.create(Hn.prototype),zn.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this))},zn.prototype.ready=function(){this.raptor.getElement().on("mouseenter",this.options.elements,this.show.bind(this)).on("mouseleave",this.options.elements,this.hide.bind(this))},zn.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=Oo("<div/>").addClass(this.raptor.options.baseClass+"-layout raptor-layout-hover-panel "+this.options.baseClass).mouseleave(this.hide.bind(this));var e=new Un(this.raptor,this.options.uiOrder);e.appendTo(this,this.hoverPanel),Oo(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},zn.prototype.show=function(e){this.enabled&&this.raptor.isEditing()&&(this.target=e.target,this.visible=!0,Rt(this.getElement().show(),Oo(this.target)))},zn.prototype.hide=function(e){if(this.visible){if(e){if(Oo.contains(this.getElement().get(0),e.relatedTarget))return;if(e.relatedTarget===this.getElement().get(0))return;if(this.getElement().get(0)===Oo(e.relatedTarget).parent().get(0))return;if(Oo.contains(this.raptor.getElement().get(0),e.relatedTarget))return;if(e.relatedTarget===this.raptor.getElement().get(0))return}this.visible=!1,this.getElement().hide()}},zn.prototype.close=function(){this.visible&&(this.enabled=!1,this.visible=!1,this.getElement().hide(),setTimeout(function(){this.enabled=!0}.bind(this),1e3))},zn.prototype.position=function(){this.visible&&Rt(this.getElement(),Oo(this.target))},zn.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},Go.registerLayout(new zn),qn.prototype.init=function(){if("string"==typeof this.hotkey)this.raptor.registerHotkey(this.hotkey,this.action.bind(this));else if(D(this.hotkey))for(var e=0,t=this.hotkey.length;t>e;e++)this.raptor.registerHotkey(this.hotkey[e],this.action.bind(this));return this.getButton()},qn.prototype.getButton=function(){if(!this.button){var e=this.text||this.translate("Text",!1);this.button=Oo("<div>").html(e).addClass(this.options.baseClass).attr("title",this.getTitle()).click(this.click.bind(this)),A(this.button,{icons:{primary:this.getIcon()},text:e,label:this.label})}return this.button},qn.prototype.getTitle=function(){return this.title||this.translate("Title")},qn.prototype.getIcon=function(){return null===this.icon?"ui-icon-"+gn(this.name):this.icon},qn.prototype.click=function(){U(this.button)&&this.raptor.actionApply(this.action.bind(this))},qn.prototype.translate=function(e,t){return c(this.name+e,t)},Wn.prototype=Object.create(qn.prototype),Wn.prototype.init=function(){return this.preview="undefined"==typeof this.options.preview?!0:!1,qn.prototype.init.apply(this,arguments)},Wn.prototype.getButton=function(){return this.button||(this.button=qn.prototype.getButton.call(this).mouseenter(this.mouseEnter.bind(this)).mouseleave(this.mouseLeave.bind(this))),this.button},Wn.prototype.mouseEnter=function(){this.canPreview()&&(this.previewing=!0,this.raptor.actionPreview(this.action.bind(this)))},Wn.prototype.mouseLeave=function(){this.previewing=!1,this.raptor.actionPreviewRestore()},Wn.prototype.click=function(){return this.previewing=!1,this.raptor.actionPreviewRestore(),qn.prototype.click.apply(this,arguments)},Wn.prototype.canPreview=function(){return this.preview},Wn.prototype.isPreviewing=function(){return this.previewing},Qn.prototype=Object.create(qn.prototype),Qn.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),qn.prototype.init.apply(this,arguments)},Qn.prototype.selectionChange=function(){this.selectionToggle()?(j(this.button),this.disable&&O(this.button)):(z(this.button),this.disable&&F(this.button))},Gn.prototype=Object.create(Wn.prototype),Gn.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),Wn.prototype.init.apply(this,arguments)},Gn.prototype.selectionChange=function(){this.selectionToggle()?this.isPreviewing()||j(this.button):z(this.button)},Vn.prototype=Object.create(Wn.prototype),Vn.prototype.init=function(){var e=Wn.prototype.init.apply(this,arguments);return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),e},Vn.prototype.selectionChange=function(){this.isEnabled()?O(this.button):F(this.button)},Vn.prototype.getElement=function(){throw new Error("Expected child class to override FilteredPreviewButton.getElement")},Vn.prototype.canPreview=function(){return Wn.prototype.canPreview.call(this)&&this.isEnabled()},Vn.prototype.isEnabled=function(){var e=Ei();return e?!!this.getElement(e):!!this.previewing},Vn.prototype.action=function(){Ii(function(e){var t=this.getElement(e);t&&this.applyToElement(t)}.bind(this))},_n.prototype=Object.create(Gn.prototype),_n.prototype.action=function(){on(),this.raptor.selectionConstrain();for(var e=0,t=this.classes.length;t>e;e++){var i=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[e],{elementTagName:this.tag||"span"});i.toggleSelection()}},_n.prototype.selectionToggle=function(){for(var e=0,t=this.classes.length;t>e;e++){var i=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[e],{elementTagName:this.tag||"span"});if(!i.isAppliedToSelection())return!1}return!0};var Xo={};Xn.prototype=Object.create(qn.prototype),Xn.prototype.action=function(){this.openDialog()},Xn.prototype.applyAction=function(){throw new Error("Expected child class to override DialogButton.applyAction")},Xn.prototype.getDialogTemplate=function(){throw new Error("Expected child class to override DialogButton.getDialogTemplate")},Xn.prototype.validateDialog=function(){return!0},Xn.prototype.openDialog=function(){this.raptor.pause(),Q(this.getDialog())},Xn.prototype.onDialogClose=function(){Xo[this.name].instance.raptor.resume()},Xn.prototype.okButtonClick=function(){var e=Xo[this.name].instance.validateDialog();e===!0&&(G(Xo[this.name].dialog),Xo[this.name].instance.applyAction.call(Xo[this.name].instance,Xo[this.name].dialog))},Xn.prototype.closeDialog=function(){G(Xo[this.name].dialog)},Xn.prototype.cancelButtonClick=Xn.prototype.closeDialog,Xn.prototype.getOkButton=function(e){return{text:c(e+"DialogOKButton"),click:this.okButtonClick.bind(this),icons:{primary:"ui-icon-circle-check"}}},Xn.prototype.getCancelButton=function(e){return{text:c(e+"DialogCancelButton"),click:this.cancelButtonClick.bind(this),icons:{primary:"ui-icon-circle-close"}}},Xn.prototype.getDefaultDialogOptions=function(e){var t={modal:!0,resizable:!0,autoOpen:!1,title:c(e+"DialogTitle"),dialogClass:this.options.baseClass+"-dialog "+this.options.dialogClass,close:this.onDialogClose.bind(this),buttons:[]},i=this.getOkButton(e),n=this.getCancelButton(e);return"undefined"!=typeof i&&i!==!1&&t.buttons.push(i),"undefined"!=typeof n&&n!==!1&&t.buttons.push(n),t},Xn.prototype.getDialog=function(){return"undefined"==typeof Xo[this.name]&&(Xo[this.name]={dialog:Oo(this.getDialogTemplate())},W(Xo[this.name].dialog,Oo.extend(this.getDefaultDialogOptions(this.name),this.dialogOptions))),Xo[this.name].instance=this,Xo[this.name].dialog},Kn.prototype=Object.create(Xn.prototype),Kn.prototype.init=Qn.prototype.init,Kn.prototype.selectionChange=Qn.prototype.selectionChange,Jn.prototype=Object.create(qn.prototype),Jn.prototype.click=function(e){this.menu.getMenu().is(":visible")?Oo(".raptor-menu").hide():this.menu.show(),e.preventDefault()},$n.prototype.init=function(){this.setOptions();var e=this.getButton().init();return e.addClass("raptor-menu-button"),e},$n.prototype.getButton=function(){return this.button||(this.button=new Jn(this)),this.button},$n.prototype.setOptions=function(){this.options.title=c(this.name+"Title"),this.options.icon="ui-icon-"+this.name},$n.prototype.getMenu=function(){return this.menu||(this.menu=Oo("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().mousedown(function(e){e.preventDefault()}).children().appendTo("body")),this.menu},$n.prototype.show=function(){Oo(".raptor-menu").hide(),It(this.getMenu().toggle(),this.getButton().getButton())
},Oo("html").click(function(e){Oo(e.target).hasClass("raptor-menu-button")||0!==Oo(e.target).closest(".raptor-menu-button").length||Oo(".raptor-menu").hide()}),$n.prototype.getMenu=function(){return this.menu||(this.menu=Oo("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().appendTo("body").mousedown(function(e){e.preventDefault()})),this.menu},Yn.prototype=Object.create($n.prototype),Yn.prototype.menuItemMouseDown=function(e){e.preventDefault()},Yn.prototype.menuItemClick=function(e){return M(this.button.button,Oo(e.target).html()),Oo(this.menu).closest("ul").hide(),!1},Yn.prototype.menuItemMouseEnter=function(){},Yn.prototype.menuItemMouseLeave=function(){},Yn.prototype.getMenu=function(){return this.menu||(this.menu=Oo("<ul>").addClass(this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.getMenuItems()).css("position","fixed").hide().find("a").mousedown(this.menuItemMouseDown.bind(this)).mouseenter(this.menuItemMouseEnter.bind(this)).mouseleave(this.menuItemMouseLeave.bind(this)).click(this.menuItemClick.bind(this)).end().appendTo("body"),q(this.menu)),this.menu},Oo.extend(Go,{Button:qn,CSSClassApplierButton:_n,DialogButton:Xn,DialogToggleButton:Kn,FilteredPreviewButton:Vn,HoverPanelLayout:jn,Menu:$n,MenuButton:Jn,PreviewButton:Wn,PreviewToggleButton:Gn,RaptorLayout:Hn,RaptorPlugin:On,SelectMenu:Yn,TextAlignButton:fo,ToggleButton:Qn,ToolbarLayout:Fn,UiGroup:Un,aButton:A,aButtonActive:j,aButtonDisable:F,aButtonEnable:O,aButtonInactive:z,aButtonIsEnabled:U,aButtonSetIcon:H,aButtonSetLabel:M,aDialog:W,aDialogClose:G,aDialogOpen:Q,aMenu:q,aTabs:_,actionApply:$,actionPreview:K,actionPreviewRestore:J,actionRedo:Z,actionUndo:Y,clean:rt,cleanEmptyAttributes:it,cleanEmptyElements:ot,cleanRemoveComments:nt,cleanReplaceElements:et,cleanUnnestElement:at,cleanUnwrapElements:tt,cleanWrapTextNodes:st,dockToElement:ct,dockToScreen:lt,elementBringToTop:ht,elementChangeTag:Bt,elementClosestBlock:Lt,elementContainsBlockElement:vt,elementDefaultDisplay:yt,elementDetachedManip:Dt,elementFirstInvalidElementOfValidParent:Ct,elementGetAttributes:Tt,elementGetStyles:Et,elementIsBlock:ft,elementIsEmpty:Pt,elementIsValid:bt,elementOuterHtml:gt,elementOuterText:mt,elementPositionUnder:It,elementRemoveAttributes:pt,elementSwapStyles:St,elementToggleStyle:xt,elementUniqueId:Nt,elementVisibleRect:wt,elementWrapInner:kt,extendLocale:r,fragmentInsertBefore:Mt,fragmentToHtml:At,getLocalizedString:d,listBreakAtSelection:Yt,listBreakByReplacingSelection:$t,listConvertItemsForList:qt,listConvertListItem:Wt,listConvertListType:Jt,listEnforceValidChildren:jt,listRemoveEmpty:_t,listRemoveEmptyItems:Vt,listShouldConvertType:Ut,listShouldUnwrap:Ot,listShouldWrap:Ft,listTidyModified:Gt,listToggle:Ht,listUnwrap:Qt,listUnwrapSelectedListItems:Xt,listUnwrapSelection:Kt,listWrapSelection:zt,nodeFindParent:Zt,nodeFindTextNodes:ei,nodeIsChildOf:ti,persistGet:ni,persistSet:ii,rangeContainsNode:mi,rangeContainsNodeText:fi,rangeDeserialize:bi,rangeEmptyTag:di,rangeExpandTo:ri,rangeExpandToParent:oi,rangeGet:Ei,rangeGetCommonAncestor:pi,rangeGetEndElement:ui,rangeGetStartElement:ci,rangeIsContainedBy:gi,rangeIsEmpty:hi,rangeReplace:li,rangeReplaceSplitInvalidTags:Ci,rangeReplaceWithinValidTags:wi,rangeSelectElement:si,rangeSelectElementContent:ai,rangeSerialize:yi,rangeToHtml:Ti,rangeTrim:vi,registerLocale:a,selectionAtEndOfElement:qi,selectionAtStartOfElement:Wi,selectionChangeTags:ln,selectionClearFormatting:tn,selectionConstrain:en,selectionContains:dn,selectionDelete:cn,selectionDestroy:Si,selectionEachBlock:Yi,selectionEachRange:Ii,selectionExists:_i,selectionExpandTo:sn,selectionExpandToWord:on,selectionFindWrappingAndInnerElements:rn,selectionGetElement:Ui,selectionGetElements:Fi,selectionGetEndElement:zi,selectionGetHtml:Oi,selectionGetStartElement:ji,selectionInverseWrapWithTagClass:nn,selectionIsEmpty:Qi,selectionRange:Xi,selectionReplace:Li,selectionReplaceSplittingSelectedElement:Ki,selectionReplaceWithinValidTags:Ji,selectionRestore:xi,selectionSave:ki,selectionSaved:Pi,selectionSelectEdge:Ri,selectionSelectEnd:Ai,selectionSelectInner:Ni,selectionSelectOuter:Bi,selectionSelectStart:Mi,selectionSelectToEndOfElement:Hi,selectionSet:Di,selectionToggleBlockClasses:Zi,selectionToggleBlockStyle:$i,selectionToggleWrapper:Gi,selectionTrim:an,selectionWrapTagWithAttribute:Vi,setLocale:l,stateRestore:pn,stateSave:un,stringCamelCaseConvert:gn,stringHtmlStringIsEmpty:mn,stringStripTags:hn,styleRestoreState:yn,styleSwapState:fn,styleSwapWithWrapper:vn,tableCanMergeCells:Pn,tableCanSplitCells:Dn,tableCellsInRange:Sn,tableCreate:bn,tableDeleteColumn:wn,tableDeleteRow:En,tableGetCellByIndex:xn,tableGetCellIndex:kn,tableInsertColumn:Cn,tableInsertRow:Tn,tableMergeCells:In,tableSplitCells:Ln,templateConvertTokens:k,templateGet:E,templateGetVariables:x,typeIsArray:D,typeIsElement:B,typeIsNode:L,typeIsNumber:P,typeIsRange:Bn,typeIsSelection:Rn,typeIsString:I,typeIsTextNode:N,undockFromElement:ut,undockFromScreen:dt}),window.Raptor=Go,Go.globalDefaults={layouts:{},plugins:{},ui:{},bind:{},namespace:null,unify:!0,persistence:!0,persistenceName:"uiEditor",unloadWarning:!0,autoEnable:!1,partialEdit:!1,autoSelect:"end",enablePlugins:!0,disabledPlugins:[],enableUi:!0,disabledUi:[],replace:!1,replaceStyle:["display","position","float","width","padding-left","padding-right","padding-top","padding-bottom","margin-left","margin-right","margin-top","margin-bottom"],baseClass:"raptor",cssPrefix:"cms-",draggable:!0},Go.registerPreset({name:"full",plugins:{imageSwap:{chooser:"insertFile"}},layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement","guides"],["viewSource"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease","fontFamilyMenu"],["clearFormatting","cleanBlock"],["linkCreate","linkRemove"],["embed","insertFile"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit"]]},elementHoverPanel:{elements:"img",uiOrder:[["imageResize","imageSwap","close"]]}}},!0),Go.registerPreset({name:"micro",layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement"],["historyUndo","historyRedo"],["specialCharacters"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit","revisions"]]}},plugins:{placeholder:!1,paste:{panels:["plain-text"]},noBreak:{enabled:!0}}}),Go.registerPreset({name:"inline",classes:"raptor-editing-inline",autoEnable:!0,draggable:!1,unify:!1,unloadWarning:!1,reloadOnDisable:!0,plugins:{unsavedEditWarning:!1,dock:{dockToElement:!0,docked:!0,persist:!1}},layouts:{toolbar:{uiOrder:[["textBold","textItalic","textUnderline","textStrike"],["colorMenuBasic"],["textBlockQuote"],["listOrdered","listUnordered"],["textSizeDecrease","textSizeIncrease"],["linkCreate","linkRemove"]]}}}),Go.registerPreset({name:"mammoth",plugins:{imageSwap:{chooser:"fileManager"}},layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","guides"],["viewSource"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease"],["clearFormatting","cleanBlock"],["linkCreate","linkRemove"],["embed","fileManager"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters","loremIpsum"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"]]},hoverPanel:{uiOrder:[["clickButtonToEdit","revisions"]]},elementHoverPanel:{elements:"img",uiOrder:[["imageResize","imageSwap","imageEditor","close"]]},imageEditor:{uiOrder:[["save","cancel"],["revert","upload"],["undo","redo"],["flipV","flipH","rotateLeft","rotateRight","resize","crop"]]},fileManager:{uiOrder:[["insert","rename","edit","delete","download","view"]]}}},!0),Go.registerPreset({name:"mammoth-inline",classes:"raptor-editing-inline",autoEnable:!0,draggable:!1,unify:!1,unloadWarning:!1,reloadOnDisable:!0,plugins:{unsavedEditWarning:!1,dock:{dockToElement:!0,docked:!0,persist:!1}},layouts:{toolbar:{uiOrder:[["viewSource","guides"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease"],["clearFormatting","cleanBlock"],["linkCreate","linkRemove"],["embed","fileManager"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"]]}}}),Go.registerUi(new Xn({name:"cancel",hotkey:"esc",dialogOptions:{width:500},action:function(){this.raptor.isDirty()?Xn.prototype.action.call(this):this.applyAction()},applyAction:function(){this.raptor.cancelEditing()},getDialogTemplate:function(){return Oo("<div>").html(c("cancelDialogContent"))}})),Zn.prototype=Object.create(Yn.prototype),Zn.prototype.init=function(){var e=Yn.prototype.init.call(this);return"object"==typeof this.options.classes&&Object.keys(this.options.classes).length>0?(this.raptor.bind("selectionChange",this.updateButton.bind(this)),e):void 0},Zn.prototype.changeClass=function(e){Zi(e,[],this.raptor.getElement())},Zn.prototype.menuItemClick=function(e){Yn.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeClass([Oo(e.currentTarget).data("value")])}.bind(this))},Zn.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.changeClass([Oo(e.currentTarget).data("value")])}.bind(this))},Zn.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Zn.prototype.updateButton=function(){},Zn.prototype.getMenuItems=function(){var e="";for(var t in this.options.classes)e+=this.raptor.getTemplate("class-menu.item",{label:t,value:this.options.classes[t]});return e},Go.registerUi(new Zn),Go.registerUi(new Wn({name:"cleanBlock",action:function(){this.raptor.getElement().find("[style]").removeAttr("style"),this.raptor.getElement().find("span:empty").remove()}})),Go.registerUi(new Wn({name:"clearFormatting",action:function(){tn(this.raptor.getElement().get(0)),ot(this.raptor.getElement(),["a","b","i","sub","sup","strong","em","big","small","p"]),st(this.raptor.getElement()[0],"p")}})),Go.registerUi(new qn({name:"clickButtonToEdit",action:function(){this.raptor.enableEditing()}})),Go.registerUi(new qn({name:"close",click:function(){this.layout.close()}})),eo.prototype=Object.create(Yn.prototype),eo.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),this.updateButton(),Yn.prototype.init.apply(this,arguments)},eo.prototype.updateButton=function(){var e=Fi()[0],t=this.getButton().getButton(),i=null,n=null;if(M(t,c("colorMenuBasicAutomatic")),H(t,!1),e){e=Oo(e);for(var o=0;o<this.colors.length;o++)if(n=Oo(e).closest("."+this.options.cssPrefix+this.colors[o]),n.length){i=this.colors[o];break}return i?(M(t,c("colorMenuBasic"+(i.charAt(0).toUpperCase()+i.slice(1)))),H(t,"ui-icon-swatch"),t.find(".ui-icon").css("background-color",n.css("color")),void 0):void 0}},eo.prototype.changeColor=function(e,t){t&&(this.currentColor=e),this.raptor.actionApply(function(){if(on(),"automatic"===e)Fi().parents("."+this.options.cssPrefix+"color").addBack().each(function(){var e=Oo(this).attr("class");if(null!==e&&"undefined"!=typeof e&&(e=e.match(/(cms-(.*?))( |$)/gi),null!==e&&"undefined"!=typeof e))for(var t=0,i=e.length;i>t;t++)Oo(this).removeClass(Oo.trim(e[t]))});else{var t=Nt();Gi("span",{classes:this.options.cssPrefix+"color "+this.options.cssPrefix+e,attributes:{id:t}});var i=Oo("#"+t);if(i.length){Ni(i.removeAttr("id").get(0));var n;do n=Oo("#"+t),n.removeAttr("id");while(n.length)}}}.bind(this))},eo.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.changeColor(Oo(e.currentTarget).data("color"))}.bind(this))},eo.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},eo.prototype.menuItemClick=function(e){Yn.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeColor(Oo(e.currentTarget).data("color"),!0)}.bind(this))},eo.prototype.getMenuItems=function(){return this.raptor.getTemplate("color-menu-basic.menu",this.options)},Go.registerUi(new eo),to.prototype=Object.create(On.prototype),to.prototype.init=function(){var e;this.options.persist&&(e=this.raptor.persist("docked")),"undefined"==typeof e&&(e=this.options.docked),"undefined"==typeof e&&(e=!1),e&&(this.raptor.bind("toolbarReady",function(){e&&this.toggleState()}.bind(this)),this.raptor.bind("toolbarHide",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.addClass(this.options.baseClass+"-hidden"),this.dockState.spacer.removeClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarShow",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.removeClass(this.options.baseClass+"-hidden"),this.dockState.spacer.addClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarDestroy",function(){this.dockState&&this.dockState.spacer&&this.dockState.spacer.remove()}.bind(this)))},to.prototype.toggleState=function(){return this.options.dockToElement?this.toggleDockToElement():this.toggleDockToScreen()},to.prototype.toggleDockToElement=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?this.undockFromElement():(this.undockFromScreen(),this.dockToElement()):this.dockToElement()},to.prototype.dockToElement=function(){var e=this.raptor.getElement(),t=this.raptor.getLayout("toolbar").getElement();this.marker=Oo("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(t),this.raptor.getLayout("toolbar").getElement().addClass(this.options.baseClass+"-docked-to-element"),this.dockState=ct(this.raptor.getLayout("toolbar").getElement(),e,{position:this.options.position,spacer:!1,wrapperClass:this.options.baseClass+"-inline-wrapper"}),this.activateButton(this.raptor.getPlugin("dockToElement"))},to.prototype.undockFromElement=function(){this.marker.replaceWith(ut(this.dockState)),this.dockState=null,this.raptor.getLayout("toolbar").getElement().removeClass(this.options.baseClass+"-docked-to-element"),this.deactivateButton(this.raptor.getPlugin("dockToElement"))},to.prototype.toggleDockToScreen=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?(this.undockFromElement(),this.dockToScreen()):this.undockFromScreen():this.dockToScreen()},to.prototype.dockToScreen=function(){if(!this.dockState){var e=this.raptor.getLayout("toolbar");if(e.isReady()){this.raptor.persist("docked",!0);var t=e.getElement();this.marker=Oo("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(t),t.addClass(this.options.baseClass+"-docked"),e.disableDragging(),this.dockState=lt(t,{position:this.options.position,spacer:this.options.spacer,under:this.options.under}),e.isVisible()||(this.dockState.spacer.removeClass(this.options.baseClass+"-visible"),this.dockState.spacer.addClass(this.options.baseClass+"-hidden")),this.activateButton(this.raptor.getPlugin("dockToScreen"))}}},to.prototype.undockFromScreen=function(){if(this.dockState){this.raptor.persist("docked",!1);var e=this.raptor.getLayout("toolbar"),t=dt(this.dockState);this.marker.replaceWith(t),e.enableDragging(),e.constrainPosition(),this.dockState=null,t.removeClass(this.options.baseClass+"-docked"),this.deactivateButton(this.raptor.getPlugin("dockToScreen"))}},to.prototype.deactivateButton=function(e){"undefined"!=typeof e&&"undefined"!=typeof e.button&&z(e.button)},to.prototype.activateButton=function(e){"undefined"!=typeof e&&"undefined"!=typeof e.button&&j(e.button)},Go.registerPlugin(new to),Go.registerUi(new qn({name:"dockToScreen",action:function(){this.raptor.unify(function(e){e.plugins.dock.toggleDockToScreen()})}})),Go.registerUi(new qn({name:"dockToElement",action:function(){this.raptor.unify(function(e){e.plugins.dock.toggleDockToElement()})}})),Go.registerUi(new Xn({name:"embed",state:null,dialogOptions:{width:600,height:400},applyAction:function(e){this.raptor.actionApply(function(){Li(e.find("textarea").val())})},getDialogTemplate:function(){var e=Oo("<div>").html(this.raptor.getTemplate("embed.dialog",this.options));e.find("textarea").change(function(t){e.find("."+this.options.baseClass+"-preview").html(Oo(t.target).val())}.bind(this));var t=e.find("."+this.options.baseClass+"-panel-tabs");return t.find("li").click(function(){t.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),Oo(this).addClass("ui-state-active").addClass("ui-tabs-selected"),t.children("div").hide().eq(Oo(this).index()).show()}),e}})),Go.registerUi(new Vn({name:"floatLeft",applyToElement:function(e){e.removeClass(this.options.cssPrefix+"float-right"),e.toggleClass(this.options.cssPrefix+"float-left"),it(e,["class"])},getElement:function(e){var t=Oo(e.commonAncestorContainer).find("img");return t.length?t:null}})),Go.registerUi(new Vn({name:"floatNone",applyToElement:function(e){e.removeClass(this.options.cssPrefix+"float-right"),e.removeClass(this.options.cssPrefix+"float-left"),it(e,["class"])},getElement:function(e){var t=Oo(e.commonAncestorContainer).find("img");return t.length?t:null}})),Go.registerUi(new Vn({name:"floatRight",applyToElement:function(e){e.removeClass(this.options.cssPrefix+"float-left"),e.toggleClass(this.options.cssPrefix+"float-right"),it(e,["class"])},getElement:function(e){var t=Oo(e.commonAncestorContainer).find("img");return t.length?t:null}})),Go.registerUi(new Wn({name:"guides",action:function(){this.raptor.getElement().toggleClass(this.getClassName()),this.updateButtonState()},updateButtonState:function(){this.raptor.getElement().hasClass(this.getClassName())?j(this.button):z(this.button)},init:function(){return this.raptor.bind("cancel",this.removeClass.bind(this)),this.raptor.bind("saved",this.removeClass.bind(this)),Wn.prototype.init.call(this)},removeClass:function(){this.raptor.getElement().removeClass(this.getClassName())},getClassName:function(){return this.options.baseClass+"-visible"},mouseEnter:function(){Wn.prototype.mouseEnter.call(this),this.updateButtonState()},mouseLeave:function(){Wn.prototype.mouseLeave.call(this),this.updateButtonState()}})),Go.registerUi(new qn({name:"historyRedo",hotkey:["ctrl+y","ctrl+shift+z"],action:function(){this.raptor.historyForward()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),qn.prototype.init.apply(this,arguments),F(this.button),this.button},historyChange:function(){this.raptor.present<this.raptor.history.length-1?O(this.button):F(this.button)}})),Go.registerUi(new qn({name:"historyUndo",hotkey:"ctrl+z",action:function(){this.raptor.historyBack()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),qn.prototype.init.apply(this,arguments),F(this.button),this.button},historyChange:function(){0===this.raptor.present?F(this.button):O(this.button)}})),Go.registerUi(new Wn({name:"hrCreate",action:function(){Li("<hr/>")}})),Go.registerUi(new Xn({name:"imageResize",proportional:!0,image:null,dialogOptions:{width:450},action:function(){var e=this.getDialog();this.image=u(this.layout.target),this.originalWidth=this.layout.target.width,this.originalHeight=this.layout.target.height,e.find("[name=width]").val(this.layout.target.width),e.find("[name=height]").val(this.layout.target.height),this.openDialog()},applyAction:function(){var e=this.getDialog(),t=e.find("[name=width]").val(),i=e.find("[name=height]").val();this.raptor.actionApply(function(){Oo("#"+this.image).css({width:t,height:i}).attr("width",t).attr("height",i),Bi(Oo("#"+this.image)[0])}.bind(this))},getDialogTemplate:function(){var e=Oo("<div>").html(this.raptor.getTemplate("image-resize.dialog",this.options)),t=this;e.find("."+this.options.baseClass+"-lock-proportions").hover(function(){Oo(this).addClass("ui-state-hover")},function(){Oo(this).removeClass("ui-state-hover")}).click(function(){Xo[t.name].instance.proportional=!Xo[t.name].instance.proportional,Oo(this).find(".ui-icon").toggleClass("ui-icon-locked",t.proportional).toggleClass("ui-icon-unlocked",!t.proportional)});var i=e.find("[name=width]"),n=e.find("[name=height]");return i.on("input.raptor",function(){var e=parseInt(Oo(this).val());isNaN(e)||Xo[t.name].instance.proportional&&n.val(Math.round(Math.abs(Xo[t.name].instance.originalHeight/Xo[t.name].instance.originalWidth*e)))}),n.on("input.raptor",function(){var e=parseInt(Oo(this).val());isNaN(e)||Xo[t.name].instance.proportional&&i.val(Math.round(Math.abs(Xo[t.name].instance.originalWidth/Xo[t.name].instance.originalHeight*e)))}),e}})),Go.registerUi(new qn({name:"imageSwap",chooser:null,click:function(){Bi(this.layout.target),this.raptor.getPlugin(this.options.chooser).action(this.layout.target)}})),Go.registerUi(new Xn({name:"insertFile",state:!1,imageTypes:["jpeg","jpg","png","gif"],options:{customAction:!1},action:function(e){return this.options.customAction&&this.options.customAction.call(this,e)!==!1?void 0:("undefined"!=typeof e?(this.getDialog().find("[name=location]").val(e.getAttribute("src")||e.getAttribute("href")),this.getDialog().find("[name=name]").val(e.innerHTML)):(this.getDialog().find("[name=location]").val(""),this.getDialog().find("[name=name]").val("")),this.openDialog())},applyAction:function(){var e=this.getDialog(),t=e.find("[name=location]").val(),i=e.find("[name=name]").val();this.raptor.actionApply(function(){this.insertFiles([{location:t,name:i}])}.bind(this))},getDialogTemplate:function(){return Oo(this.raptor.getTemplate("insert-file.dialog"))},getFileType:function(e){if("undefined"!=typeof e.extension)return e.extension.toLowerCase();var t=e.location.split(".");return t.length>0?t.pop().toLowerCase():"unknown"},isImage:function(e){return-1!==Oo.inArray(this.getFileType(e),this.imageTypes)},insertFiles:function(e){this.raptor.resume(),e.length&&this.raptor.actionApply(function(){1===e.length?this.isImage(e[0])&&Oo(Oi()).is("img")||Qi()?this.replaceFiles(e):this.linkFiles(e):this.linkFiles(e)}.bind(this))},linkFiles:function(e){sn("a",this.raptor.getElement()),an();var t=rangy.createApplier({tag:"a",attributes:{href:e[0].location.replace(/([^:])\/\//g,"$1/"),title:e[0].name,"class":this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(e[0])}});t.applyToSelection()},replaceFiles:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.prepareElement(e[i]));Li(t.join(", "))},prepareElement:function(e,t){return this.isImage(e)?this.prepareImage(e,this.options.cssPrefix+this.getFileType(e),t):this.prepareAnchor(e,this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(e),t)},prepareImage:function(e,t,i){return Oo("<div/>").html(Oo("<img/>").attr({src:e.location.replace(/([^:])\/\//g,"$1/"),title:i||e.name,"class":t})).html()},prepareAnchor:function(e,t,i){return Oo("<div/>").html(Oo("<a/>").attr({href:e.location.replace(/([^:])\/\//g,"$1/"),title:e.name,"class":t}).html(i||e.name)).html()}}));var Ko,Jo,$o,Yo;Go.registerUi(new Kn({name:"linkCreate",dialogOptions:{width:850},applyAction:function(){this.raptor.actionApply(function(){on(),sn("a",this.raptor.getElement()),an();var e=rangy.createApplier({tag:"a",attributes:Yo});Yo!==!1&&""!==Oo.trim(Yo.href)&&(e.applyToSelection(),ot(this.raptor.getElement(),["a"]))}.bind(this))},openDialog:function(){var e=Ui();if(e.is("a"))for(var t=0,i=Jo.length;i>t;t++){var n=Jo[t].updateInputs(e,$o.children("div:eq("+t+")"));n&&Ko.find(":radio:eq("+t+")").trigger("click")}Kn.prototype.openDialog.call(this)},validateDialog:function(){var e=Ko.find(":radio:checked").val();return Yo=Jo[e].getAttributes($o.children("div:eq("+e+")")),Yo!==!1},selectionToggle:function(){var e=Ui();return e?e.closest("a").length?!0:!1:!1},getDialogTemplate:function(){var e=Oo(this.raptor.getTemplate("link.dialog",this.options));Ko=e.find("[data-menu]"),$o=e.find("[data-content]"),Jo=[new so(this.raptor),new oo(this.raptor),new io(this.raptor),new no(this.raptor)];for(var t=0,i=Jo.length;i>t;t++)Oo(this.raptor.getTemplate("link.label",Jo[t])).click(function(){$o.children("div").hide(),$o.children("div:eq("+Oo(this).index()+")").show()}).find(":radio").val(t).end().appendTo(Ko),Oo("<div>").append(Jo[t].getContent()).hide().appendTo($o);return Ko.find(":radio:first").prop("checked",!0),$o.children("div:first").show(),e}})),Go.registerUi(new Gn({name:"linkRemove",disable:!0,action:function(){this.raptor.actionApply(function(){var e=rangy.createApplier({tag:"a"});on(),this.raptor.selectionConstrain(),e.undoToSelection(),ot(this.raptor.getElement(),["a"])}.bind(this))},selectionToggle:function(){var e=Ui();return e?e.closest("a").length?!0:!1:!1}})),io.prototype=Object.create(oo.prototype),io.prototype.getContent=function(){return this.raptor.getTemplate("link.document",this.raptor.options)},no.prototype.getContent=function(){return this.raptor.getTemplate("link.email",this.raptor.options)},no.prototype.getAttributes=function(e){var t=e.find("[name=email]").val(),i=e.find("[name=subject]").val();return Oo.trim(i)&&(i="?Subject="+encodeURIComponent(i)),""===Oo.trim(t)?!1:{href:"mailto:"+t+i}},no.prototype.updateInputs=function(e,t){var i=!1;if(email="",subject="",href=e.attr("href"),0===href.indexOf("mailto:")){var n=href.indexOf("?Subject=");n>0?(email=href.substring(7,n),subject=href.substring(n+9)):(email=href.substring(7),subject=""),i=!0}return t.find("[name=email]").val(email),t.find("[name=subject]").val(subject),i},oo.prototype.getContent=function(){return this.raptor.getTemplate("link.external",this.raptor.options)},oo.prototype.getAttributes=function(e){var t=e.find("[name=location]").val(),i=e.find("[name=blank]").is(":checked"),n={href:t};return i&&(n.target="_blank"),"http://"===Oo.trim(n.href)?!1:n},oo.prototype.updateInputs=function(e,t){var i=!1,n=e.attr("href");return 0===n.indexOf("http://")?(t.find("[name=location]").val(n),i=!0):t.find("[name=location]").val("http://"),"_blank"===e.attr("target")?t.find("[name=blank]").prop("checked",!0):t.find("[name=blank]").prop("checked",!1),i},so.prototype.getContent=function(){return this.raptor.getTemplate("link.internal",{baseClass:this.raptor.options.baseClass,domain:window.location.protocol+"//"+window.location.host})},so.prototype.getAttributes=function(e){var t=e.find("[name=location]").val(),i=e.find("[name=blank]").is(":checked"),n={href:t};return i&&(n.target="_blank"),n},so.prototype.updateInputs=function(e,t){var i=e.attr("href");return-1===i.indexOf("http://")&&-1===i.indexOf("mailto:")?t.find("[name=location]").val(i):t.find("[name=location]").val(""),"_blank"===e.attr("target")?t.find("[name=blank]").prop("checked",!0):t.find("[name=blank]").prop("checked",!1),!1},Go.registerUi(new qn({name:"listOrdered",action:function(){document.execCommand("insertorderedlist")}})),Go.registerUi(new qn({name:"listUnordered",action:function(){document.execCommand("insertunorderedlist")}})),Go.registerUi(new qn({name:"logo",init:function(){var e=qn.prototype.init.apply(this,arguments);return e.find(".ui-button-icon-primary").css({"background-image":"url(//www.raptor-editor.com/logo/VERSION?json="+encodeURIComponent(JSON.stringify(this.raptor.options))+")"}),e},action:function(){window.open("http://www.raptor-editor.com/about/VERSION","_blank")}})),ao.prototype=Object.create(On.prototype),ao.prototype.init=function(){this.raptor.getElement().on("keypress.raptor",this.preventReturn.bind(this)),this.raptor.getElement().on("drop.raptor",this.preventDrop.bind(this))},ao.prototype.preventReturn=function(e){return this.options.enabled&&13===e.which?!1:void 0},ao.prototype.preventDrop=function(){return this.options.enabled},Go.registerPlugin(new ao),ro.prototype=Object.create(On.prototype),ro.prototype.init=function(){this.raptor.registerHotkey("return",this.returnPressed.bind(this)),this.raptor.registerHotkey("shift+return",this.shiftReturnPressed.bind(this))},ro.prototype.returnPressedList=function(e){var t=e.closest("li");if(!t.length)return!1;var i=t.closest("ul, ol"),n=i.get(0).tagName.toLowerCase(),o=!1;if(Pt(t)){var s=t.next();s.length&&s.is("li")?(o=$t(n,"li",this.raptor.getElement(),"<p>&nbsp;</p>"),o&&Ni(o.get(0))):(t.remove(),Ni(Oo("<p>&nbsp;</p>").insertAfter(i).get(0)))}else o=Yt(n,"li",this.raptor.getElement()),o&&Mi(o.get(0));return!0},ro.prototype.returnPressed=function(){var e=Ui();return this.returnPressedList(e)?!0:!1},ro.prototype.shiftReturnPressedList=function(e){if(e.closest("li").length){var t=e.closest("ul, ol").get(0).tagName.toLowerCase(),i=$t(t,"li",this.raptor.getElement(),"<p>&nbsp;</p>");return i&&Ni(i.get(0)),!0}return!1},ro.prototype.shiftReturnPressed=function(){var e=Ui();return this.shiftReturnPressedList(e)?!0:!1},Go.registerPlugin(new ro);var Zo=!1,es=null,ts=null,is=null;lo.prototype=Object.create(On.prototype),lo.prototype.enable=function(){this.raptor.getElement().on("paste.raptor",this.capturePaste.bind(this))},lo.prototype.capturePaste=function(){return is?void 0:Zo?!1:(ki(),Zo=!0,Oo(".raptorPasteBin").remove(),Oo('<div class="raptorPasteBin" contenteditable="true" style="width: 1px; height: 1px; overflow: hidden; position: fixed; top: -1px;" />').appendTo("body"),Oo(".raptorPasteBin").focus(),window.setTimeout(this.showPasteDialog.bind(this),0),!0)},lo.prototype.showPasteDialog=function(){Q(this.getDialog(this))},lo.prototype.pasteContent=function(e){this.raptor.actionApply(function(){var t=Nt();xi(),e=this.filterAttributes(e),e=this.filterChars(e),Li(Oo('<placeholder id="'+t+'">'+e+"</placeholder>")),Oo(".raptorPasteBin").remove();var i=Oo("#"+t);Ni(i.get(0)),ki(),i.contents().unwrap(),xi()}.bind(this))},lo.prototype.getDialog=function(e){if(ts=e,!es){es=Oo("<div>").html(this.raptor.getTemplate("paste.dialog",this.options));for(var t=0,i=this.options.panels.length;i>t;t++)es.find("."+this.options.baseClass+"-tab-"+this.options.panels[t]).css("display",""),0===t&&es.find("."+this.options.baseClass+"-content-"+this.options.panels[t]).css("display","");es.find("."+this.options.baseClass+"-panel-tabs > div:visible:not(:first)").hide(),W(es,{modal:!0,resizable:!0,autoOpen:!1,width:800,height:500,title:c("pasteDialogTitle"),dialogClass:this.options.baseClass+"-dialog",close:function(){Zo=!1},buttons:[{text:c("pasteDialogOKButton"),click:function(){var e=null,t=es.find("."+this.options.baseClass+"-area:visible");e=t.hasClass(this.options.baseClass+"-plain")||t.hasClass(this.options.baseClass+"-source")?t.val():t.html(),G(es),ts.pasteContent(e)}.bind(this),icons:{primary:"ui-icon-circle-check"}},{text:c("pasteDialogCancelButton"),click:function(){Si(),Oo(".raptorPasteBin").remove(),G(es)},icons:{primary:"ui-icon-circle-close"}}]});var n=es.find("."+this.options.baseClass+"-panel-tabs");n.find("li").click(function(){n.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),Oo(this).addClass("ui-state-active").addClass("ui-tabs-selected"),n.children("div").hide().eq(Oo(this).index()).show()})}return this.updateAreas(),es},lo.prototype.filterAttributes=function(e){var t=[{regexp:/(<meta\s*[^>]*\s*>)|(<\s*link\s* href="file:[^>]*\s*>)|(<\/?\s*\w+:[^>]*\s*>)/gi,handler:""},{regexp:/(class="Mso[^"]*")|(<!--(.|\s){1,}?-->)/gi,handler:""},{regexp:/(class="Apple-(style|converted)-[a-z]+\s?[^"]+")/,handle:""},{regexp:/id="internal-source-marker_[^"]+"|dir="[rtl]{3}"/,handle:""},{regexp:/(<p[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/p[^>]*>)|(<p[^>]*>\s*<font[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/\s*font\s*>\s<\/p[^>]*>)/gi,handler:""},{regexp:/(style="[^"]*mso-[^;][^"]*")|(style="margin:\s*[^;"]*;")/gi,handler:""},{regexp:/(?:<style([^>]*)>([\s\S]*?)<\/style>|<link\s+(?=[^>]*rel=['"]?stylesheet)([^>]*?href=(['"])([^>]*?)\4[^>\/]*)\/?>)/gi,handler:""},{regexp:/(<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>)|(<\s*script\b([^<>]|\s)*>?)|(<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>)/gi,handler:""}];
return Oo.each(t,function(t,i){e=e.replace(i.regexp,i.handler)}),e},lo.prototype.filterChars=function(e){var t=e;return t=t.replace(/[\u2018|\u2019|\u201A]/g,"'"),t=t.replace(/[\u201C|\u201D|\u201E]/g,'"'),t=t.replace(/\u2026/g,"..."),t=t.replace(/[\u2013|\u2014]/g,"-"),t=t.replace(/\u02C6/g,"^"),t=t.replace(/\u2039/g,"<"),t=t.replace(/\u203A/g,">"),t=t.replace(/[\u02DC|\u00A0]/g," ")},lo.prototype.stripAttributes=function(e){e=Oo("<div/>").html(e);var t=this.options.allowedAttributes;return Oo(e.find("*")).each(function(){var e=[];Oo.each(this.attributes,function(i,n){-1===Oo.inArray(n.nodeName,t)&&e.push(n.nodeName)});for(var i=0;i<e.length;i++)Oo(this).attr(e[i],null)}),e.html()},lo.prototype.stripEmpty=function(e){var t=Oo("<div/>").html(e),i=this.options.allowedEmptyTags;return t.find("*").filter(function(){return-1!==Oo.inArray(this.tagName.toLowerCase(),i)?!1:Oo(this).find(i.join(",")).length?!1:""===Oo.trim(Oo(this).text())}).remove(),t.html()},lo.prototype.stripSpans=function(e){var t=Oo("<div/>").html(e);return t.find("span").each(function(){this.attributes.length||Oo(this).replaceWith(Oo(this).html())}),t.html()},lo.prototype.updateAreas=function(){var e=Oo(".raptorPasteBin").html();e=this.filterAttributes(e),e=this.filterChars(e),e=this.stripEmpty(e),e=this.stripAttributes(e),e=this.stripSpans(e),e=hn(e,this.options.allowedTags);var t=Oo("<div/>").html(Oo(".raptorPasteBin").html()).text(),i=Oo(".raptorPasteBin").html();es.find("."+this.options.baseClass+"-plain").val(Oo("<div/>").html(t).text()),es.find("."+this.options.baseClass+"-rich").html(e),es.find("."+this.options.baseClass+"-source").html(i),es.find("."+this.options.baseClass+"-markup").html(e)},Oo(document).on("keyup.raptor keydown.raptor",function(e){is=e.shiftKey}),Go.registerPlugin(new lo),co.prototype=Object.create(On.prototype),co.prototype.init=function(){this.raptor.bind("enabled",this.enabled.bind(this)),this.raptor.bind("change",this.check.bind(this))},co.prototype.enabled=function(){this.check(this.raptor.getHtml())},co.prototype.check=function(e){if(e=e.trim(),!e||"<br>"===e||"<div><br></div>"===e){var t=this.raptor.getNode(),i=document.createElement(this.options.tag);i.innerHTML=this.options.content,t.innerHTML="",t.appendChild(i),this.options.select&&Ni(t.childNodes[0]),this.raptor.checkChange()}},Go.registerPlugin(new co),Go.registerUi(new qn({name:"save",action:function(){this.getPlugin()?this.getPlugin().save():X({text:c("saveNotConfigured"),type:"error"})},init:function(){if(null!==this.options.plugin){var e=qn.prototype.init.apply(this,arguments);return this.getPlugin()||t("Cannot find save plugin for UI."),this.raptor.bind("dirty",this.dirty.bind(this)),this.raptor.bind("cleaned",this.clean.bind(this)),this.clean(),e}},getPlugin:function(){return this.raptor.getPlugin(this.options.plugin)},dirty:function(){O(this.button)},clean:function(){F(this.button)}})),uo.prototype=Object.create(Yn.prototype),uo.prototype.init=function(){var e=Yn.prototype.init.call(this);return"undefined"!=typeof this.options.snippets&&Object.keys(this.options.snippets).length>0?e:void 0},uo.prototype.insertSnippet=function(e){Li(this.options.snippets[e])},uo.prototype.menuItemMouseDown=function(e){this.raptor.actionApply(function(){this.insertSnippet(Oo(e.currentTarget).data("name"))}.bind(this))},uo.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.insertSnippet(Oo(e.currentTarget).data("name"))}.bind(this))},uo.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},uo.prototype.getMenuItems=function(){var e="";for(var t in this.options.snippets)e+=this.raptor.getTemplate("snippet-menu.item",{name:t});return e},Go.registerUi(new uo);var ns=!1;Go.registerUi(new Xn({name:"specialCharacters",dialogOptions:{width:645},options:{setOrder:["symbols","mathematics","arrows","greekAlphabet"],characterSets:{symbols:{name:c("specialCharactersSymbols"),characters:[["<","&lt;","less than"],[">","&gt;","greater than"],["&","&amp;","ampersand"],['"',"&quot;","quotation mark"],["&nbsp;","non-breaking space: ' '"],["&emsp;","em space: '  '"],["&ensp;","en space: ' '"],["&thinsp;","thin space: ''"],["&mdash;","em dash"],["&ndash;","en dash"],["&minus;","minus"],["-","hyphen"],["&oline;","overbar space"],["&cent;","cent"],["&pound;","pound"],["&euro;","euro"],["&sect;","section"],["&dagger;","dagger"],["&Dagger;","double dagger"],["&lsquo;","left single quotes"],["&rsquo;","right single quotes"],["'","single quotes"],["&#x263a;","smiley face"],["&#x2605;","black star"],["&#x2606;","white star"],["&#x2610;","check box"],["&middot;","middle dot"],["&bull;","bullet"],["&copy;","copyright"],["&reg;","registered"],["&trade;","trade"],["&iquest;","inverted question mark"],["&iexcl;","inverted exclamation mark"],["&Aring;","Angström"],["&hellip;","ellipsis"],["&#x2295;","earth"],["&#x2299;","sun"],["&#x2640;","female"],["&#x2642;","male"],["&clubs;","clubs or shamrock"],["&spades;","spades"],["&hearts;","hearts or valentine"],["&diams;","diamonds"],["&loz;","diamond"]]},mathematics:{name:c("specialCharactersMathematics"),characters:[["&lt;","less than"],["&le;","less than or equal to"],["&gt;","greater than"],["&ge;","greater than or equal to"],["&ne;","not equal"],["&asymp;","approximately equal to"],["&equiv;","identically equal to"],["&cong;","congruent to"],["&prop;","proportional"],["&there4;","therefore"],["&sum;","summation"],["&prod;","product"],["&prime;","prime or minutes"],["&Prime;","double prime or seconds"],["&Delta;","delta"],["&nabla;","del"],["&part;","partial"],["&int;","integral"],["&middot;","middle dot"],["&sdot;","dot operator"],["&bull;","bullet"],["&minus;","minus sign"],["&times;","multipllcation sign"],["&divide;","division sign"],["&frasl;","fraction slash, (ordinary / \\)"],["&plusmn;","plus or minus"],["&deg;","degree sign"],["&lfloor;","floor function"],["&rfloor;","floor function"],["&lceil;","ceiling function"],["&rceil;","ceiling function"],["&lowast;","asterisk operator, (ordinary *)"],["&oplus;","circled plus"],["&otimes;","circled times"],["&ordm;","masculine ordinal"],["&lang;","bra"],["&rang;","ket"],["&infin;","infinity"],["&pi;","pi"],["&frac12;","half"],["&alefsym;","aleph"],["&radic;","radical"],["&ang;","angle"],["&perp;","perpendicular"],["&real;","real"],["&isin;","is an element of"],["&notin;","not an element of"],["&empty;","null set"],["&sub;","subset of"],["&sube;","subset or or equal to"],["&nsub;","not a subset"],["&cap;","intersection"],["&cup;","union"],["&sim;","tilde operator (ordinary ~)"],["&Oslash;","slash O"],["&and;","logical and"],["&Lambda;","lambda (and)"],["&or;","logical or"],["&not;","not sign"],["&sim;","tilde operator (ordinary ~)"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},arrows:{name:c("specialCharactersArrows"),characters:[["&darr;","down arrow"],["&dArr;","down double arrow"],["&uarr;","up arrow"],["&uArr;","up double arrow"],["&crarr;","arriage return arrow"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},greekAlphabet:{name:c("specialCharactersGreekAlphabet"),characters:[["&alpha;","alpha"],["&beta;","beta"],["&gamma;","gamma"],["&delta;","delta"],["&epsilon;","epsilon"],["&zeta;","zeta"],["&eta;","eta"],["&theta;","theta"],["&iota;","iota"],["&kappa;","kappa"],["&lambda;","lambda"],["&mu;","mu"],["&nu;","nu"],["&xi;","xi"],["&omicron;","omicron"],["&pi;","pi"],["&rho;","rho"],["&sigma;","sigma"],["&tau;","tau"],["&upsilon;","upsilon"],["&phi;","phi"],["&chi;","chi"],["&psi;","psi"],["&omega;","omega"],["&Alpha;","alpha"],["&Beta;","beta"],["&Gamma;","gamma"],["&Delta;","delta"],["&Epsilon;","epsilon"],["&Zeta;","zeta"],["&Eta;","eta"],["&Theta;","theta"],["&Iota;","iota"],["&Kappa;","kappa"],["&Lambda;","lambda"],["&Mu;","mu"],["&Nu;","nu"],["&Xi;","xi"],["&Omicron;","omicron"],["&Pi;","pi"],["&Rho;","rho"],["&Sigma;","sigma"],["&Tau;","tau"],["&Upsilon;","upsilon"],["&Phi;","phi"],["&Chi;","chi"],["&Psi;","psi"],["&Omega;","omega"]]}}},applyAction:function(){this.raptor.actionApply(function(){ns&&Li(ns),ns=!1})},getDialogTemplate:function(){for(var e,t,i,n,o=Oo(this.raptor.getTemplate("special-characters.dialog")).appendTo("body").hide(),s=0;s<this.options.setOrder.length;s++){e=this.options.setOrder[s],o.find("ul").append(this.raptor.getTemplate("special-characters.tab-li",{baseClass:this.options.baseClass,name:this.options.characterSets[e].name,key:e})),t=Oo(this.raptor.getTemplate("special-characters.tab-content",{baseClass:this.options.baseClass,key:e}));for(var a=[],r=0;r<this.options.characterSets[e].characters.length;r++)i=this.options.characterSets[e].characters[r],n=this.raptor.getTemplate("special-characters.tab-button",{htmlEntity:i[0],description:i[1],setKey:e,charactersIndex:r}),a.push(n);t.append(a.join("")),o.find("ul").after(t)}o.show();var l=this;return o.find("button").each(function(){A(Oo(this))}).click(function(){var e=Oo(this).attr("data-setKey"),t=Oo(this).attr("data-charactersIndex");ns=l.options.characterSets[e].characters[t][0],l.getOkButton(l.name).click.call(this)}),_(o),o},getCancelButton:function(){}})),po.prototype=Object.create(Vn.prototype),po.prototype.getElement=function(e){var t=Oo(e.commonAncestorContainer.parentNode).closest("td, th");return t.length?t[0]:null},ho.prototype=Object.create($n.prototype),ho.prototype.createTable=function(e){this.raptor.actionApply(function(){Li(gt(Oo(bn(e.target.cellIndex+1,e.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},ho.prototype.highlight=function(e){var t=Sn(this.menuTable.get(0),{x:0,y:0},{x:e.target.cellIndex,y:e.target.parentNode.rowIndex});this.highlightRemove(e),Oo(t).addClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreview(function(){Li(gt(Oo(bn(e.target.cellIndex+1,e.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},ho.prototype.highlightRemove=function(){this.menuTable.find("."+this.options.baseClass+"-menu-hover").removeClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreviewRestore()},ho.prototype.getMenu=function(){return this.menu||(this.menuContent=this.raptor.getTemplate("table.create-menu",this.options),$n.prototype.getMenu.call(this).on("click","td",this.createTable.bind(this)).on("mouseenter","td",this.highlight.bind(this)).mouseleave(this.highlightRemove.bind(this)),this.menuTable=this.menu.find("table:eq(0)")),this.menu},Go.registerUi(new ho),Go.registerUi(new po({name:"tableDeleteColumn",applyToElement:function(e){var t,i=kn(e),n=e.parentNode.parentNode.parentNode;return wn(e.parentNode.parentNode.parentNode,i.x),Nn(n)?(n.parentNode.removeChild(n),void 0):(t=xn(n,i),!t&&i.x>0&&(t=xn(n,{x:i.x-1,y:i.y})),Ni(t),void 0)}})),Go.registerUi(new po({name:"tableDeleteRow",applyToElement:function(e){var t,i=kn(e),n=e.parentNode.parentNode.parentNode;return En(e.parentNode.parentNode.parentNode,i.y),Nn(n)?(n.parentNode.removeChild(n),void 0):(t=xn(n,i),!t&&i.y>0&&(t=xn(n,{x:i.x,y:i.y-1})),Ni(t),void 0)}})),Go.registerUi(new po({name:"tableInsertColumn",applyToElement:function(e){Cn(e.parentNode.parentNode.parentNode,kn(e).x+1,{placeHolder:"&nbsp;"})}})),Go.registerUi(new po({name:"tableInsertRow",applyToElement:function(e){Tn(e.parentNode.parentNode.parentNode,kn(e).y+1,{placeHolder:"&nbsp;"})}})),Go.registerUi(new qn({name:"tableMergeCells",action:function(){}})),Go.registerUi(new qn({name:"tableSplitCells",action:function(){}}));var os=!1,ss=null;go.prototype=Object.create(On.prototype),go.prototype.init=function(){this.raptor.bind("selectionCustomise",this.selectionCustomise.bind(this)),this.raptor.registerHotkey("tab",this.tabToNextCell.bind(this)),this.raptor.registerHotkey("shift+tab",this.tabToPrevCell.bind(this)),this.raptor.getElement().on("mousedown","tbody td",this.cellMouseDown.bind(this)).on("mouseover","tbody td",this.cellMouseOver.bind(this)).mouseup(this.cellMouseUp.bind(this))},go.prototype.selectionCustomise=function(){var e,t=[];return Oo("."+this.options.baseClass+"-cell-selected").each(function(){e=rangy.createRange(),e.selectNodeContents(this),t.push(e)}),t},go.prototype.cellMouseDown=function(e){this.raptor.isEditing()&&(ss=kn(e.target),null!==ss&&(os=!0,Oo(e.target).closest("table").addClass(this.options.baseClass+"-selected")))},go.prototype.cellMouseUp=function(e){os=!1;var t=Oo(e.target).closest("td"),i=!1;if(t.length>0&&null!==ss){var n=kn(t.get(0));(null===n||n.x==ss.x&&n.y==ss.y)&&(i=!0)}else i=!0;i&&(Oo("."+this.options.baseClass+"-selected").removeClass(this.options.baseClass+"-selected"),Oo("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"))},go.prototype.cellMouseOver=function(e){if(os){var t=Sn(Oo(e.target).closest("table").get(0),ss,kn(e.target));Oo("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"),Oo(t).addClass(this.options.baseClass+"-cell-selected"),rangy.getSelection().removeAllRanges()}},go.prototype.tabToNextCell=function(){var e=rangy.getSelection().getRangeAt(0),t=pi(e),i=Oo(t).closest("td");if(0===i.length)return!1;var n=i.next("td");0===n.length&&(n=i.closest("tr").next("tr").find("td:first"),0===n.length&&(n=i.closest("tbody").find("td:first"))),ai(e,n),rangy.getSelection().setSingleRange(e)},go.prototype.tabToPrevCell=function(){var e=rangy.getSelection().getRangeAt(0),t=pi(e),i=Oo(t).closest("td");if(0===i.length)return!1;var n=i.prev("td");0===n.length&&(n=i.closest("tr").prev("tr").find("td:last"),0===n.length&&(n=i.closest("tbody").find("td:last"))),ai(e,n),rangy.getSelection().setSingleRange(e)},Go.registerPlugin(new go),mo.prototype=Object.create(Yn.prototype),mo.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),Yn.prototype.init.apply(this,arguments)},mo.prototype.changeTag=function(e){if("undefined"!=typeof e&&"na"!==e){var t=Ui(),i=this.raptor.getElement();if(t&&!t.is(i)){var n=t.closest("td, li, #"+i.attr("id"));0!==n.length&&(i=n)}ln(e,["h1","h2","h3","h4","h5","h6","p","div","pre","address"],i)}},mo.prototype.menuItemClick=function(e){Yn.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeTag(Oo(e.currentTarget).data("value"))}.bind(this))},mo.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.changeTag(Oo(e.currentTarget).data("value"))}.bind(this))},mo.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},mo.prototype.updateButton=function(){var e=Fi()[0],t=this.getButton().getButton();if(e){var i=e.tagName.toLowerCase(),n=this.getMenu().find("[data-value="+i+"]");n.length?M(t,n.html()):M(t,c("tagMenuTagNA"))}},mo.prototype.getMenuItems=function(){return this.raptor.getTemplate("tag-menu.menu",this.options)},Go.registerUi(new mo),fo.prototype=Object.create(Gn.prototype),fo.prototype.action=function(){Zi([this.getClass()],[this.options.cssPrefix+"center",this.options.cssPrefix+"left",this.options.cssPrefix+"right",this.options.cssPrefix+"justify"],this.raptor.getElement(),"span"),this.selectionChange()},fo.prototype.selectionToggle=function(){return rangy.getSelection().getAllRanges().length>0&&dn("."+this.getClass(),this.raptor.getElement())},Go.registerUi(new fo({name:"alignCenter",getClass:function(){return this.options.cssPrefix+"center"}})),Go.registerUi(new fo({name:"alignJustify",getClass:function(){return this.options.cssPrefix+"justify"}})),Go.registerUi(new fo({name:"alignLeft",getClass:function(){return this.options.cssPrefix+"left"}})),Go.registerUi(new fo({name:"alignRight",getClass:function(){return this.options.cssPrefix+"right"}})),Go.registerUi(new _n({name:"textBold",hotkey:"ctrl+b",tag:"strong",classes:["bold"]})),Go.registerUi(new _n({name:"textItalic",hotkey:"ctrl+i",tag:"em",classes:["italic"]})),Go.registerUi(new _n({name:"textStrike",tag:"del",classes:["strike"]})),Go.registerUi(new Wn({name:"textSizeDecrease",action:function(){on(),this.raptor.selectionConstrain(),nn("small",this.options.cssPrefix+"small","big",this.options.cssPrefix+"big"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),Go.registerUi(new Wn({name:"textSizeIncrease",action:function(){on(),this.raptor.selectionConstrain(),nn("big",this.options.cssPrefix+"big","small",this.options.cssPrefix+"small"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),Go.registerUi(new _n({name:"textUnderline",hotkey:"ctrl+u",tag:"u",classes:["underline"]})),Go.registerUi(new _n({name:"textSub",tag:"sub",classes:["sub"]})),Go.registerUi(new _n({name:"textSuper",tag:"sup",classes:["sup"]})),vo.prototype=Object.create(On.prototype),vo.prototype.init=function(){this.raptor.bind("layoutReady",function(e){Oo(e).on("mouseover","[title]",function(){Oo(this).attr("data-title",Oo(this).attr("title")).removeAttr("title")})})},Go.registerPlugin(new vo);var as=0,rs=null;yo.prototype=Object.create(On.prototype),yo.prototype.enable=function(){this.raptor.bind("dirty",this.show.bind(this)),this.raptor.bind("cleaned",this.hide.bind(this))},yo.prototype.show=function(){as++,ht(this.getElement()),this.getElement().addClass(this.options.baseClass+"-visible")},yo.prototype.hide=function(){0===--as&&this.getElement().removeClass(this.options.baseClass+"-visible")},yo.prototype.getElement=function(){if(!rs){var e="raptor-plugin-unsaved-edit-warning-dirty";rs=Oo(this.raptor.getTemplate("unsaved-edit-warning.warning",this.options)).mouseenter(function(){Go.eachInstance(function(t){t.isDirty()&&t.getElement().addClass(e)})}).mouseleave(function(){Oo("."+e).removeClass(e)}).appendTo("body")}return rs},Go.registerPlugin(new yo),Go.registerUi(new Xn({name:"viewSource",dialogOptions:{width:600,height:400},applyAction:function(e){var t=e.find("textarea").val();this.raptor.actionApply(function(){this.raptor.setHtml(t),Mi(this.raptor.getElement().first()),this.raptor.checkSelectionChange()}.bind(this))},openDialog:function(){var e=this.getDialog().find("textarea");e.val(this.raptor.getHtml()),Xn.prototype.openDialog.call(this),e.select()},getDialogTemplate:function(){return Oo("<div>").html(this.raptor.getTemplate("view-source.dialog",this.options))}}));var ls=function(e){this.path="/",this.start=0,this.limit=10,this.sort="mtime",this.direction="desc",this.tags=[],this.delay=400,this.search="",this.searchPrevious=null,this.searchTimeout=null,this.uiOrder=e.uiOrder||[Object.keys(this.plugins)],this.options=e;for(var t in e)this[t]=e[t];L(this.node)||n("options.node for RFM is expected to be a node",this.node),I(this.options.uriAction)||n("options.uriAction for RFM is expected to be a string",this.options.uriAction),I(this.options.uriIcon)||n("options.uriIcon for RFM is expected to be a string",this.options.uriIcon),this.options.staticPaths&&(this.options.uriPublic||this.options.uriIcon)&&n("options.staticPaths should not be used with options.uriPublic or options.uriIcon",this.options.uriIcon),this.node.innerHTML=k(ls.templates.dialog),this.nodeError=this.node.getElementsByClassName("rfm-error-wrapper")[0],this.nodeFiles=this.node.getElementsByClassName("rfm-files")[0],this.nodeFileHeader=this.node.getElementsByClassName("rfm-files-head")[0],this.nodeDirectories=this.node.getElementsByClassName("rfm-directories")[0],this.nodeTags=this.node.getElementsByClassName("rfm-tags")[0],this.nodeUploadDrop=this.node.getElementsByClassName("rfm-upload-drop")[0],this.nodeUploadContainer=this.node.getElementsByClassName("rfm-upload-container")[0],this.nodeUploadBrowse=this.node.getElementsByClassName("rfm-upload-browse")[0],this.nodeSearchInput=this.node.getElementsByClassName("rfm-search-input")[0],this.nodePages=this.node.getElementsByClassName("rfm-pages")[0],this.nodeTotal=this.node.getElementsByClassName("rfm-total")[0],this.nodePreview=this.node.getElementsByClassName("rfm-preview")[0],this.nodePreviewClose=this.node.getElementsByClassName("rfm-preview-close")[0],this.nodeFileHeader.addEventListener("click",this.clickedFilesHeader.bind(this)),this.nodeDirectories.addEventListener("click",this.clickedDirectory.bind(this)),this.nodeTags.addEventListener("click",this.clickedTag.bind(this)),this.nodeSearchInput.addEventListener("keyup",this.searchChanged.bind(this)),this.nodePages.addEventListener("click",this.clickedPage.bind(this)),this.nodePreviewClose.addEventListener("click",this.clickedClosePreview.bind(this)),A(this.node.getElementsByTagName("button")),this.initPlupload(),this.refresh()};v(ls),ls.prototype.refresh=function(){null!==this.refreshTimeout&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=null),wo.get(this.options.uriAction,{action:"list",path:this.path,start:this.start,limit:this.limit,sort:this.sort,direction:this.direction,tags:this.tags.join(","),search:this.search},function(e,t){if(200!==t.status)return this.nodeError.innerHTML=k(ls.templates.wrap,{tagName:"div",className:"rfm-error ui-state-error",content:"Could not load data from the server.<br/>"+e.replace(/(<([^>]+)>)/g," ").replace(/\s+/g," ")})+this.nodeError.innerHTML,void 0;try{e=JSON.parse(e)}catch(i){return this.nodeError.innerHTML=k(ls.templates.wrap,{tagName:"div",className:"rfm-error ui-state-error",content:"Could not parse the server's response.<br/>"+i.message})+this.nodeError.innerHTML,void 0}this.refreshFiles(e.files),this.refreshDirectories(e.directories),this.refreshTags(e.tags),this.refreshPages(e.start,e.limit,e.filteredTotal,e.total),A(this.node.getElementsByTagName("button"))}.bind(this),!1)},ls.prototype.refreshDelayed=function(){null!==this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(this.refresh.bind(this),this.delay)},ls.prototype.refreshFiles=function(e){var t,i;this.nodeFiles.innerHTML="";for(var n=0;n<e.length;n++)t=Co(e[n].name)?k(ls.templates.img,{alt:e[n].name,src:(e[n].iconSrc||this.options.uriIcon+"file"+this.path+e[n].name)+"?"+e[n].mtime}):k(ls.templates.wrap,{tagName:"i",className:"rfm-file-icon-bg rfm-file-icon-"+e[n].type,content:""}),e[n].path=this.path+e[n].name,i=p(k(ls.templates.file,{icon:t,image:Co(e[n].name)?"":"disabled",name:e[n].name,type:e[n].type,size:s(e[n].size),mtime:new Date(1e3*e[n].mtime).toISOString().replace("T"," ").replace(/.{5}$/,""),state:0==n%2?"ui-state-default":"ui-state-default-alternative ui-state-default",file:e[n]?JSON.stringify(e[n]):"",insertClass:this.insertCallback?"":"rfm-hidden"}),"tbody"),i.getElementsByClassName("rfm-file-actions")[0].appendChild(S(this,this.uiOrder,null,{rfm:this,file:e[n]})),this.nodeFiles.appendChild(i)},ls.prototype.refreshDirectories=function(e){var t="";"/"!=this.path&&(t+=k(ls.templates.directory,{name:".."}));for(var i=0;i<e.length;i++)t+=k(ls.templates.directory,{name:e[i]});this.nodeDirectories.innerHTML=t},ls.prototype.refreshTags=function(e){for(var t="",i=0;i<e.length;i++){var n=["rfm-tag ui-state-default"];0==i?n.push("ui-corner-top"):i==e.length-1&&n.push("ui-corner-bottom"),-1!==this.tags.indexOf(e[i])&&n.push("ui-state-active ui-widget-header ui-state-contrast"),t+=k(ls.templates.wrap,{tagName:"div",className:n.join(" "),content:c("rfmTag"+e[i])})}this.nodeTags.innerHTML=t},ls.prototype.refreshPages=function(e,t,i,n){this.nodePages.innerHTML="";var o=5,s=Math.floor(e/t)+1,a=Math.ceil(n/t),r=Math.max(1,s-5),l=r+2*o;if(l>a){var d=l-a;l=a,r=Math.max(1,r-d)}for(var u,h=r;l>=h;h++)u=p(k(ls.templates.wrap,{className:"rfm-page "+(s===h?"ui-state-contrast":""),tagName:"button",content:h})),u.dataset.start=(h-1)*t,this.nodePages.appendChild(u);var g=n===i?c("rfmFilteredTotal"):c("rfmFilteredTotal")+c("rfmTotal");this.nodeTotal.innerHTML=k(g,{start:parseInt(e)?parseInt(e)+1:0,end:Math.min(parseInt(e)+parseInt(t),i),total:n,filteredTotal:i})},ls.prototype.clickedDirectory=function(e){".."===e.target.innerText?this.path=this.path.replace(/\/[^\/]+\/$/,"/"):this.path+=e.target.innerText+"/",this.refresh()},ls.prototype.clickedTag=function(e){e.target.className+=" rfm-tag-active";var t=this.tags.indexOf(e.target.innerText);-1===t?this.tags.push(e.target.innerText):this.tags.splice(t,1),this.refresh()},ls.prototype.clickedFilesHeader=function(e){if(e.target.dataset.sort){for(var t=this.nodeFileHeader.getElementsByTagName("th"),i=0;i<t.length;i++)t[i].classList.remove("rfm-sort-asc"),t[i].classList.remove("rfm-sort-desc");this.sort===e.target.dataset.sort?this.direction="asc"===this.direction?"desc":"asc":(this.sort=e.target.dataset.sort,this.direction="asc"),e.target.classList.add("rfm-sort-"+this.direction),this.refresh()}},ls.prototype.searchChanged=function(){var e=this.nodeSearchInput.value.trim();this.searchPrevious!==e&&(this.searchPrevious=e,this.search=e,this.refreshDelayed())},ls.prototype.clickedPage=function(e){this.start=e.target.dataset.start||e.target.parentNode.dataset.start,this.refresh()},ls.prototype.clickedClosePreview=function(){this.nodePreview.parentNode.classList.remove("rfm-preview-visible")},ls.templates={dialog:'<div class="rfm-dialog"> <div class="rfm-wrapper"> <div class="rfm-preview-wrapper"> <div class="rfm-preview"></div> <div class="rfm-preview rfm-image-editor"> <img id="rfm-image-editor" /> </div> <div style="clear:both"></div> <button type="button" class="rfm-preview-close">tr(\'rfmClose\')</button> </div> <div class="rfm-upload-files-wrapper"> <div class="rfm-upload-files"></div> <button type="button" class="rfm-upload-continue">tr(\'rfmContinue\')</button> </div> <div class="rfm-sidebar"> <div class="rfm-directories-wrapper"> <div class="rfm-heading ui-dialog-title">tr(\'rfmHeadingDirectories\')</div> <div class="rfm-directories"></div> </div> <div class="rfm-tag-wrapper"> <div class="rfm-heading ui-dialog-title">tr(\'rfmHeadingTags\')</div> <div class="rfm-tags"></div> </div> </div> <div class="rfm-main"> <div class="rfm-upload"> <div class="rfm-heading ui-dialog-title">tr(\'rfmHeadingUpload\')</div> <div class="rfm-upload-drop ui-state-contrast ui-dialog-title ui-state-default ui-corner-all"> tr(\'rfmUploadDrop\') <span class="rfm-upload-or"> tr(\'rfmUploadOr\') </span> <button class="rfm-upload-browse" type="button">tr(\'rfmUploadBrowse\')</button> </div> <div class="rfm-upload-container"></div> </div> <div class="rfm-actions ui-state-contrast ui-widget-header ui-corner-top"> <div class="rfm-search"> <span class="rfm-heading">tr(\'rfmHeadingSearch\')</span> <input class="rfm-search-input form-text" type="text" name="search" /> <button type="button">tr(\'rfmSearch\')</button> </div> <div class="rfm-clear"></div> </div> <div class="rfm-error-wrapper"></div> <div class="rfm-files-wrapper"> <div class="rfm-table-wrapper ui-state-contrast ui-widget-header"> <table class="rfm-table"> <thead class="rfm-files-head"> <tr> <th class="rfm-file-check"><input type=\'checkbox\' /></th> <th class="rfm-file-icon">Icon</th> <th class="rfm-file-name" data-sort="name">tr(\'rfmFileName\')</th> <th class="rfm-file-type" data-sort="type">tr(\'rfmFileType\')</th> <th class="rfm-file-size" data-sort="size">tr(\'rfmFileSize\')</th> <th class="rfm-file-mtime rfm-sort-desc" data-sort="mtime">tr(\'rfmFileModificationTime\')</th> <th class="rfm-file-actions">tr(\'rfmFileActions\')</th> </tr> </thead> <tbody class="rfm-files"> </tbody> </table> </div> <div class="rfm-pagination ui-state-contrast ui-widget-header ui-corner-bottom"> <div class="rfm-total"></div> <div class="rfm-pages-wrapper"> <!--<span class="rfm-page">tr(\'rfmFirst\')</span>--> <span class="rfm-pages"></span> <!--<span class="rfm-page">tr(\'rfmLast\')</span>--> </div> <div class="rfm-clear"></div> </div> </div> </div> <div class="rfm-clear"></div> </div> <div>',directory:'<div class="rfm-directory">{{name}}</div>',error:'<div class="rfm-error ui-state-error">{{message}}</div>',file:'<tr class="rfm-file"> <td class="rfm-file-check {{state}}"><input type=\'checkbox\' /></td> <td class="rfm-file-icon {{state}}">{{icon}}</td> <td class="rfm-file-name {{state}}">{{name}}</td> <td class="rfm-file-type {{state}}">{{type}}</td> <td class="rfm-file-size {{state}}">{{size}}</td> <td class="rfm-file-mtime {{state}}">{{mtime}}</td> <td class="rfm-file-actions {{state}}"></td> </tr>',img:'<img src="{{src}}" alt="{{alt}}" />',uploadFile:'<div class="rfm-upload-file"> <div class="rfm-upload-file-error-message ui-state-error"></div> <div class="rfm-upload-file-progress-wrapper"> <div class="ui-state-default"> <div class="rfm-upload-file-name ui-state-default">{{name}} - <div class="rfm-upload-file-size">{{size}}</div></div> <div class="rfm-upload-file-actions"> <button class="rfm-upload-file-remove" type="button">tr(\'rfmUploadFileRemove\')</button> </div> <div class="rfm-upload-file-progress ui-widget-header ui-state-confirmation"></div> </div> </div> </div>',wrap:'<{{tagName}} class="{{className}}">{{content}}</{{tagName}}>'},ls.prototype.initPlupload=function(){this.nodeUploadFiles=this.node.getElementsByClassName("rfm-upload-files")[0],this.nodeUploadContainer=this.node.getElementsByClassName("rfm-upload-container")[0],this.nodeUploadBrowse=this.node.getElementsByClassName("rfm-upload-browse")[0],this.nodeUploadContinue=this.node.getElementsByClassName("rfm-upload-continue")[0],this.nodeUploadContinue.addEventListener("click",this.clickedUploadContinue.bind(this)),this.plupload=new plupload.Uploader({runtimes:"html5,html4",max_file_size:"20mb",chunk_size:"1mb",unique_names:!1,autostart:!0,button_browse_hover:!0,multipart:!0,container:u(this.nodeUploadContainer),drop_element:u(this.node),browse_button:u(this.nodeUploadBrowse),url:this.options.uriAction+"?action=upload",init:{UploadProgress:this.pluploadUploadProgress.bind(this),UploadComplete:this.pluploadRefresh.bind(this),FilesAdded:this.pluploadFilesAdded.bind(this),FilesRemoved:this.pluploadFilesRemoved.bind(this),QueueChanged:this.pluploadRefresh.bind(this),FileUploaded:this.pluploadFileUploaded.bind(this),Error:this.pluploadError.bind(this)}}),this.plupload.init(),this.plupload.refresh()},ls.prototype.pluploadRefresh=function(){for(var e=!1,t=0;t<this.plupload.files.length;t++)if(this.plupload.files[t].status===plupload.QUEUED||this.plupload.files[t].status===plupload.UPLOADING){e=!0;break}this.nodeUploadContinue.disabled=e,A(this.nodeUploadContinue,{disabled:e}),this.refreshDelayed()},ls.prototype.pluploadFilesAdded=function(e,t){for(var i=0;i<t.length;i++){var n=document.createElement("div");n.id=t[i].id,n.className="rfm-upload-file-wrapper",n.innerHTML=k(ls.templates.uploadFile,{name:t[i].name,size:s(t[i].size)});var o=n.getElementsByClassName("rfm-upload-file-remove")[0];o.addEventListener("click",this.clickedUploadRemoveFile.bind(this)),o.dataset.id=t[i].id,this.nodeUploadFiles.insertBefore(n,this.nodeUploadFiles.firstChild),A(o,{icons:{primary:"ui-icon-closethick"},text:!1}),this.nodeUploadFiles.parentNode.classList.add("rfm-uploading"),this.nodeUploadFiles.parentNode.parentNode.classList.add("rfm-wrapper-uploading"),this.plupload.start(),this.pluploadRefresh()}},ls.prototype.pluploadFilesRemoved=function(e,t){for(var i=0;i<t.length;i++){var n=document.getElementById(t[i].id);if(n){var o=n.getElementsByClassName("rfm-upload-file-progress")[0];"100%"!=o.style.width&&(o.style.width="100%",o.classList.remove("ui-state-confirmation"),o.classList.add("ui-state-error"))}}},ls.prototype.pluploadUploadProgress=function(e,t){var i=document.getElementById(t.id);i&&(i.getElementsByClassName("rfm-upload-file-progress")[0].style.width=t.percent+"%")},ls.prototype.pluploadFileUploaded=function(e,t,i){i=JSON.parse(i.response),i.error&&i.error.code&&this.plupload.trigger("Error",{code:i.error.code,message:i.error.message,details:i.details,file:t})},ls.prototype.pluploadError=function(e,t){if(t.file&&t.file.id){var i=document.getElementById(t.file.id);i.className+=" rfm-file-upload-error",i.getElementsByClassName("rfm-upload-file-error-message")[0].innerText=t.message
}else t.code<0&&(this.nodeError.innerHTML=k(ls.templates.error,t)+this.nodeError.innerHTML)},ls.prototype.clickedUploadContinue=function(){this.nodeUploadFiles.parentNode.classList.remove("rfm-uploading"),this.nodeUploadFiles.parentNode.parentNode.classList.remove("rfm-wrapper-uploading")},ls.prototype.clickedUploadRemoveFile=function(e){var t=this.plupload.getFile(e.target.dataset.id||e.target.parentNode.dataset.id);if("undefined"!=typeof t&&t.status!==plupload.DONE){var i=t.status;this.plupload.removeFile(t),this.plupload.state===plupload.STARTED&&i===plupload.UPLOADING&&(this.plupload.stop(),this.plupload.start())}else{var n=document.getElementById(e.target.dataset.id||e.target.parentNode.dataset.id);n&&n.parentNode.removeChild(n)}},Go.registerUi(new Xn({name:"fileManager",imageTypes:["jpeg","jpg","png","gif"],dialogOptions:{width:Math.min(1024,Oo(window).width()),height:Math.min(760,Oo(window).height()),resize:"auto"},insertFile:function(e,t){this.closeDialog(),t.uriPublic=(this.options.uriPublic?this.options.uriPublic:"")+e,this.insertFiles([t])},getDialogTemplate:function(){return this.node=document.createElement("div"),document.body.appendChild(this.node),this.rfm=new ls({node:this.node,uriAction:this.options.uriAction,uriIcon:this.options.uriIcon,staticPaths:this.options.staticPaths,limit:8,insertCallback:this.insertFile.bind(this),raptor:this.raptor}),this.node},getOkButton:function(){return!1},getCancelButton:function(){return!1},insertFiles:function(e){e.length&&this.raptor.actionApply(function(){1===e.length?this.isImage(e[0])&&Oo(Oi()).is("img")||Qi()?this.replaceFiles(e):this.linkFiles(e):this.linkFiles(e)}.bind(this))},linkFiles:function(e){sn("a",this.raptor.getElement()),an();var t=rangy.createApplier({tag:"a",attributes:{href:e[0].location.replace(/([^:])\/\//g,"$1/"),title:e[0].name,"class":this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(e[0])}});t.applyToSelection()},replaceFiles:function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.prepareElement(e[i]));Li(t.join(", "))},prepareElement:function(e,t){return this.isImage(e)?this.prepareImage(e,this.options.cssPrefix+this.getFileType(e),t):this.prepareAnchor(e,this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(e),t)},getFileType:function(e){if("undefined"!=typeof e.extension)return e.extension;var t=e.uriPublic.split(".");return t.length>0?t.pop():"unknown"},isImage:function(e){return-1!==Oo.inArray(this.getFileType(e),this.imageTypes)},prepareImage:function(e,t,i){return Oo("<div/>").html(Oo("<img/>").attr(Oo.extend({src:e.src||e.uriPublic.replace(/([^:])\/\//g,"$1/"),title:i||e.name,"class":t},e.attributes))).html()},prepareAnchor:function(e,t,i){return Oo("<div/>").html(Oo("<a/>").attr(Oo.extend({href:e.uriPublic.replace(/([^:])\/\//g,"$1/"),title:e.name,"class":t},e.attributes)).html(i||e.name)).html()}})),window.RFM=ls,ls.dialog=function(e,t){e=e||{},"undefined"==typeof e.node&&(e.node=document.createElement("div"),document.body.appendChild(e.node));var i=new ls(e);return W(e.node,Oo.extend({modal:!0,title:"File Manager",dialogClass:"rfm-dialog-wrapper"},t)),i},RFMPlugin=function(e){qn.call(this,e)},RFMPlugin.prototype=Object.create(qn.prototype),RFMPlugin.prototype.click=function(){this.action()},RFMPlugin.prototype.translate=function(e,t){return c("rfm"+w(this.name)+e,t)},ls.registerPlugin(new RFMPlugin({name:"insert",init:function(){return this.options.insertCallback?RFMPlugin.prototype.init.apply(this,arguments):void 0},click:function(){var e="";this.options.staticPaths||(this.options.uriPublic&&(e+=this.options.uriPublic),this.path&&(e+=this.rfm.path)),this.file.name&&(e+=this.file.name),"undefined"!=typeof this.options.insertCallback&&this.options.insertCallback(e.replace(/([^:])\/+/g,"$1/"),this.file)}})),ls.registerPlugin(new RFMPlugin({name:"rename",click:function(){var e=window.prompt("New file name:",this.file.name);e&&e!=this.file.name&&wo.post(this.options.uriAction,{action:"rename",path:this.file.path,name:e},function(e,t){t.status>=400&&(this.rfm.nodeError.innerHTML=k(ls.templates.error,{message:e})+this.rfm.nodeError.innerHTML),this.rfm.refresh()}.bind(this),!1)}}));var ds;ls.registerPlugin(new RFMPlugin({name:"edit",init:function(){return cs?RFMPlugin.prototype.init.apply(this,arguments):void 0},click:function(){if(!ds){var e;this.options.raptor?e=this.options.raptor.options.layouts.imageEditor.uiOrder:Go.defaults.layouts.imageEditor.uiOrder&&(e=Go.defaults.layouts.imageEditor.uiOrder),ds=new cs({node:document.getElementById("rfm-image-editor"),uiOrder:e,bind:{save:function(){ds.saveTo(ds.rfmEditPlugin.options.uriAction+"?"+wo.prepare({action:"save",path:ds.rfmEditPlugin.file.path}),null,function(){ds.rfmEditPlugin.rfm.clickedClosePreview(),ds.rfmEditPlugin.rfm.refresh()})},cancel:function(){ds.rfmEditPlugin.rfm.clickedClosePreview()}}})}ds.rfmEditPlugin=this,ds.node.src=this.options.uriAction+"?"+wo.prepare({action:"view",path:this.file.path}),this.rfm.nodePreview.innerHTML="",this.rfm.nodePreview.appendChild(ds.nodeEditor),this.rfm.nodePreview.parentNode.classList.add("rfm-preview-visible")}})),ls.registerPlugin(new RFMPlugin({name:"delete",click:function(){wo.post(this.options.uriAction,{action:"delete",path:this.file.path},function(e,t){t.status>=400&&(this.rfm.nodeError.innerHTML=k(ls.templates.error,{message:e})+this.rfm.nodeError.innerHTML),this.rfm.refresh()}.bind(this),!1)}})),ls.registerPlugin(new RFMPlugin({name:"download",click:function(){window.location=this.options.uriAction+"?"+wo.prepare({action:"download",path:this.file.path})}})),ls.registerPlugin(new RFMPlugin({name:"view",click:function(){Co(this.file.path)&&(this.rfm.nodePreview.innerHTML=k(ls.templates.img,{src:this.options.uriAction+"?"+wo.prepare({action:"view",path:this.file.path}),alt:this.file.name}),this.rfm.nodePreview.parentNode.classList.add("rfm-preview-visible"))}}));var cs=function(e){this.options=e,this.node=e.node,this.uiOrder=e.uiOrder||[Object.keys(this.plugins)],e.bind&&this.bindOptions(e.bind),L(this.node)||n("options.node for RIE is expected to be a node",this.node),this.nodeEditor=document.createElement("div"),this.nodeEditor.innerHTML=k(cs.templates.editor),this.nodeCanvasWrapper=this.nodeEditor.getElementsByClassName("rie-canvas-wrapper")[0],this.nodeCanvasWrapper.addEventListener("dragover",this.preventDefault),this.nodeCanvasWrapper.addEventListener("drop",this.uploadImage.bind(this)),this.nodeCanvas=this.nodeEditor.getElementsByClassName("rie-canvas")[0],this.node.classList.add("rie-hidden"),this.node.addEventListener("load",this.imageLoad.bind(this)),this.nodeFileInput=this.nodeEditor.getElementsByClassName("rie-file")[0],this.nodeFileInput.addEventListener("change",this.uploadImage.bind(this)),this.nodeActions=this.nodeEditor.getElementsByClassName("rie-actions")[0],S(this,this.uiOrder,this.nodeActions,{rie:this}),this.node.parentNode.insertBefore(this.nodeEditor,this.node),this.nodeCropHandle=this.nodeEditor.getElementsByClassName("rie-crop-handle")[0],jQuery(".rie-crop-handle").draggable({containment:".rie-canvas-wrapper"}).resizable({containment:".rie-canvas-wrapper",handles:{nw:"#nwgrip",ne:"#negrip",sw:"#swgrip",se:"#segrip",n:"#ngrip",e:"#egrip",s:"#sgrip",w:"#wgrip"}}),this.reset()};v(cs),o(cs),cs.prototype.reset=function(){this.history=[this.node],this.historyPosition=0,this.resetHandles(),this.nodeCanvas=this.draw(this.node,0,1,1)},cs.prototype.draw=function(e,t,i,n){var o=document.createElement("canvas");90==t||-90==t?(o.width=e.height,o.height=e.width):(o.width=e.width,o.height=e.height);var s=o.getContext("2d");return s.setTransform(1,0,0,1,0,0),s.translate(o.width/2,o.height/2),s.scale(i,n),s.rotate(t*Math.PI/180),s.drawImage(e,-e.width/2,-e.height/2),this.nodeCanvas.parentNode.replaceChild(o,this.nodeCanvas),o},cs.prototype.save=function(){this.nodeInput.value=this.nodeCanvas.toDataURL()},cs.prototype.toDataURL=function(){return this.nodeCanvas.toDataURL()},cs.prototype.imageLoad=function(){this.nodeCanvas=this.draw(this.node,0,1,1),this.nodeCropHandle.style.top="0px",this.nodeCropHandle.style.left="0px",this.nodeCropHandle.style.width=this.nodeCanvas.width+"px",this.nodeCropHandle.style.height=this.nodeCanvas.height+"px"},cs.prototype.uploadImage=function(e){var t;if(t=e.dataTransfer?e.dataTransfer.files:e.target.files,t.length>0){var i=t[0];if("undefined"!=typeof FileReader&&-1!=i.type.indexOf("image")){var n=new FileReader;n.onload=function(e){this.node.src=e.target.result}.bind(this),n.readAsDataURL(i)}}e.preventDefault()},cs.prototype.resetHandles=function(){this.nodeCropHandle.style.top="0px",this.nodeCropHandle.style.left="0px",this.nodeCropHandle.style.width=this.nodeCanvas.width+"px",this.nodeCropHandle.style.height=this.nodeCanvas.height+"px"},cs.prototype.historyPush=function(e){this.historyPosition!==this.history.length-1&&(console.log("slice",this.historyPosition+1),this.history=this.history.slice(0,this.historyPosition+1)),this.history.push(e),this.historyPosition=this.history.length-1,this.nodeCanvas=e},cs.prototype.revert=function(){this.node=this.nodeOriginal.cloneNode(),this.draw()},cs.prototype.preventDefault=function(e){e.preventDefault()},cs.prototype.saveTo=function(e,t,i,n){Oo("#rie-loading-progress").progressbar({value:0});var o=document.getElementById("rie-error"),s=document.getElementById("rie-error-text"),a=document.getElementById("rie-loading"),r=document.getElementById("rie-loading-text");o.classList.add("rie-hidden"),r.innerText="Saving...",a.classList.remove("rie-hidden"),Oo.ajax({xhr:function(){var e=new XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;Oo("#rie-loading-progress").progressbar({value:100*t})}},!1),e},type:"POST",url:e,data:{id:t||this.node.getAttribute("src"),action:"save",image:this.toDataURL()}}).done(function(e){a.classList.add("rie-hidden"),"true"===e?i&&i():(s.innerText=e,o.classList.remove("rie-hidden"))}.bind(this)).error(function(e){s.innerText=e.responseText,o.classList.remove("rie-hidden"),a.classList.add("rie-hidden"),n&&n()})};var us;Go.registerUi(new Xn({name:"imageEditor",node:null,rie:null,dialogOptions:{width:Math.min(850,Oo(window).width()),height:Math.min(700,Oo(window).height())},action:function(){if(this.layout.target)this.target=this.layout.target;else{if(this.target=Ui().find("img:first"),!this.target.length)return;this.target=this.target[0]}Bi(this.target),this.id=u(this.target),this.getDialog(),document.getElementById("rie-image").src=this.target.src,us.reset(),this.openDialog()},applyAction:function(){var e=(new Date).getTime();this.raptor.actionApply(function(){Oo('img[src="'+this.target.getAttribute("src")+'"]').each(function(t,i){i.setAttribute("src",this.insertParameter(i.getAttribute("src"),"updated",e))}.bind(this))}.bind(this))},getDialogTemplate:function(){return this.node=p(k(cs.templates.raptor)),document.body.appendChild(this.node),us=new cs({node:document.getElementById("rie-image"),uiOrder:this.raptor.options.layouts.imageEditor.uiOrder,bind:{save:function(){this.rie.saveTo(this.options.uriSave,this.target.dataset.id,function(){this.closeDialog(),this.applyAction()}.bind(this))}.bind(this),cancel:function(){this.closeDialog()}.bind(this)}}),this.raptor.fire("layoutReady",[us.nodeActions]),this.node},onDialogClose:function(){us.fire("close"),Xn.prototype.onDialogClose.apply(this,arguments)},getOkButton:function(){return!1},getCancelButton:function(){return!1},insertParameter:function(e,t,i){-1===e.indexOf("?")&&(e+="?");var n=t+"="+i,o=new RegExp("(&|\\?)"+t+"=[^&]*");return e=e.replace(o,"$1"+n),RegExp.$1||(e+=(e.length>0?"&":"?")+n),e=e.replace(/\?&/,"?")}})),cs.templates={action:'<button type="button" class="rie-action-{{action}}">{{label}}</button>',editor:'<div class="rie raptor-layout"> <div id="rie-error" class="ui-widget ui-notification rie-hidden"> <div class="ui-state-error ui-corner-all"> <span class="ui-icon ui-icon-error"></span> <ul> <li id="rie-error-text"></li> </ul> </div> </div> <div id="rie-loading" class="rie-hidden"> <div class="ui-widget ui-notification"> <div class="ui-state-information ui-corner-all"> <span class="ui-icon ui-icon-information"></span> <ul> <li id="rie-loading-text"></li> </ul> </div> </div> <div id="rie-loading-progress" style="overflow:hidden"></div> </div> <div> <div class="rie-actions"> <input type="file" class="rie-file" /> </div> </div> <div> <div class="rie-canvas-wrapper"> <canvas class="rie-canvas"></canvas> <div class="rie-crop-handle"> <div class="ui-resizable-handle ui-resizable-nw" id="nwgrip"></div> <div class="ui-resizable-handle ui-resizable-ne" id="negrip"></div> <div class="ui-resizable-handle ui-resizable-sw" id="swgrip"></div> <div class="ui-resizable-handle ui-resizable-se" id="segrip"></div> <div class="ui-resizable-handle ui-resizable-n" id="ngrip"></div> <div class="ui-resizable-handle ui-resizable-s" id="sgrip"></div> <div class="ui-resizable-handle ui-resizable-e" id="egrip"></div> <div class="ui-resizable-handle ui-resizable-w" id="wgrip"></div> </div> </div> </div> </div>',fieldRange:'<div class="form-field"> <label for="{{uid}}-number" class="form-label">{{label}}</label> <div class="rie-range"> <span class="rie-range-min">{{min}}</span> <input id="{{uid}}-range" name="{{name}}" type="range" class="rie-range" min="{{min}}" max="{{max}}" step="{{step}}" oninput="document.getElementById(\'{{uid}}-number\').value = this.value" value="{{value}}" /> <span class="rie-range-max">{{max}}</span> <input id="{{uid}}-number" type="number" class="form-text rie-number" min="{{min}}" max="{{max}}" step="{{step}}" oninput="document.getElementById(\'{{uid}}-range\').value = this.value" value="{{value}}" /> </div> </div>',raptor:'<div> <img id="rie-image" /> </div>',toolDialog:'<div class="rie-tools"> <div class="rie-tools-fields"></div> <div class="rie-tools-image"></div> </div>'},RIEPlugin=function(e){qn.call(this,e)},RIEPlugin.prototype=Object.create(qn.prototype),RIEPlugin.prototype.click=function(){this.action()},RIEPlugin.prototype.translate=function(e,t){return c("rie"+w(this.name)+e,t)},cs.registerPlugin(new RIEPlugin({name:"crop",action:function(){var e=document.createElement("canvas");e.width=this.rie.nodeCropHandle.clientWidth,e.height=this.rie.nodeCropHandle.clientHeight,e.getContext("2d").drawImage(this.rie.nodeCanvas,this.rie.nodeCropHandle.offsetLeft,this.rie.nodeCropHandle.offsetTop,this.rie.nodeCropHandle.clientWidth,this.rie.nodeCropHandle.clientHeight,0,0,this.rie.nodeCropHandle.clientWidth,this.rie.nodeCropHandle.clientHeight),this.rie.nodeCanvas.parentNode.replaceChild(e,this.rie.nodeCanvas),this.rie.historyPush(e),this.rie.resetHandles()}})),cs.registerPlugin(new RIEPlugin({name:"resize",action:function(){var e=document.createElement("canvas");e.width=this.rie.nodeCropHandle.clientWidth,e.height=this.rie.nodeCropHandle.clientHeight,e.getContext("2d").drawImage(this.rie.nodeCanvas,0,0,e.width,e.height),this.rie.nodeCanvas.parentNode.replaceChild(e,this.rie.nodeCanvas),this.rie.historyPush(e),this.rie.resetHandles()}})),cs.registerPlugin(new RIEPlugin({name:"upload",action:function(){this.rie.nodeFileInput.click()}})),cs.registerPlugin(new RIEPlugin({name:"revert",action:function(){this.rie.historyPush(this.rie.draw(this.rie.history[0],0,1,1)),this.rie.resetHandles()}})),cs.registerPlugin(new RIEPlugin({name:"save",action:function(){this.rie.fire("save")}})),cs.registerPlugin(new RIEPlugin({name:"cancel",action:function(){this.rie.fire("cancel")}})),cs.registerPlugin(new RIEPlugin({name:"undo",action:function(){this.rie.historyPosition>0&&(this.rie.historyPosition--,this.rie.nodeCanvas=this.rie.draw(this.rie.history[this.rie.historyPosition],0,1,1),this.rie.resetHandles())}})),cs.registerPlugin(new RIEPlugin({name:"redo",action:function(){this.rie.historyPosition<this.rie.history.length-1&&(this.rie.historyPosition++,this.rie.nodeCanvas=this.rie.draw(this.rie.history[this.rie.historyPosition],0,1,1),this.rie.resetHandles())}})),cs.registerPlugin(new RIEPlugin({name:"rotateLeft",action:function(){this.rie.historyPush(this.rie.draw(this.rie.nodeCanvas,-90,1,1)),this.rie.resetHandles()}})),cs.registerPlugin(new RIEPlugin({name:"rotateRight",action:function(){this.rie.historyPush(this.rie.draw(this.rie.nodeCanvas,90,1,1)),this.rie.resetHandles()}})),cs.registerPlugin(new RIEPlugin({name:"flipV",action:function(){this.rie.historyPush(this.rie.draw(this.rie.nodeCanvas,0,1,-1))}})),cs.registerPlugin(new RIEPlugin({name:"flipH",action:function(){this.rie.historyPush(this.rie.draw(this.rie.nodeCanvas,0,-1,1))}})),window.RIE=cs,Go.registerUi(new Wn({name:"loremIpsum",action:function(){Li(this.raptor.getTemplate("lorem-ipsum.lorem-ipsum"))}}));var ps=new Xn({name:"revisionsApplyButton",action:function(){var e=this.getDialog(this);this.openDialog(e),Q(e)},applyAction:function(){this.raptor.setHtml(this.options.revision.content),this.getSavePlugin().save()},getSavePlugin:function(){var e=this.raptor.getPlugin(this.options.plugins.save.plugin);return e||handlerError("Revision plugin requires a save plugin to be defined and present"),e},getDialogTemplate:function(){return Oo("<div>").html(this.raptor.getTemplate("revisions.apply-dialog",this.options))}});Go.registerUi(new Xn({name:"revisions",dialogOptions:{width:650,height:400,modal:!1},init:function(){var e=Xn.prototype.init.call(this);return"undefined"==typeof this.getUrl()&&(M(this.button,c("revisionsTextEmpty")),F(this.button)),e},openDialog:function(){var e=Oo("<p/>").html(c("revisionsLoading")).addClass(this.options.baseClass+"-loading-revisions");this.getDialogContentArea().html(e),this.state=this.raptor.stateSave(),this.raptor.getElement().removeClass(this.raptor.options.baseClass+"-editable-hover"),this.raptor.getElement().addClass(this.options.baseClass+"-reviewing"),this.getRevisions(this.renderRevisions.bind(this),this.displayAjaxError.bind(this)),Xn.prototype.openDialog.call(this)},closeDialog:function(){this.state=null,this.raptor.getElement().removeClass(this.options.baseClass+"-reviewing"),Xn.prototype.closeDialog.call(this)},getDialogContentArea:function(){return this.getDialog().find("> div")},renderRevisions:function(e){if("undefined"==typeof e.revisions||!e.revisions||!e.revisions.length)return this.displayNoRevisions(),void 0;var t=e.revisions,i=this.getDialogContentArea().html(this.raptor.getTemplate("revisions.table",this.options)).find("tbody"),n=this.raptor.getTemplate("revisions.tr",this.options),o=[],s=null,a=null,r=null,l=Oo(n).find("."+this.options.baseClass+"-updated").html(new Date(parseInt(e.current.updated)).toLocaleString()).next().html(c("revisionsButtonCurrent")).parent().addClass(this.options.baseClass+"-current ui-state-highlight");o.push(l);for(var d=0;d<t.length;d++)s=Oo(n),r=t[d],s.data("revision",r).find("."+this.options.baseClass+"-updated").html(new Date(parseInt(r.updated)).toLocaleString()),a=s.find("."+this.options.baseClass+"-controls"),a.append(this.prepareRowButton("preview",r,e.current,ms)),a.append(this.prepareRowButton("apply",r,e.current,ps)),a.append(this.prepareRowButton("diff",r,e.current,gs)),o.push(s);i.append(o)},prepareRowButton:function(e,t,i,n){var o=Oo.extend({},n);return o.raptor=this.raptor,o.options=Oo.extend({},this.options,{baseClass:this.options.baseClass+"-"+e+"-button",revision:t,current:i}),o.init()},displayAjaxError:function(){this.getDialogContentArea().text(c("revisionsAJAXFailed"))},displayNoRevisions:function(){this.getDialogContentArea().text(c("revisionsNone"))},getDialogTemplate:function(){return Oo("<div>").html(this.raptor.getTemplate("revisions.dialog",this.options))},getOkButton:function(){return!1},getHeaders:function(){return this.options.headers?this.options.headers.call(this):{}},getUrl:function(){return"string"==typeof this.options.url?this.options.url:Oo.isFunction(this.options.url)?this.options.url.call(this):void 0},getRevisions:function(e,t){Oo.ajax({dataType:"json",url:this.getUrl(),headers:this.getHeaders()}).done(function(t){e(t)}).fail(function(){t()})}}));var hs={},gs=new Xn({name:"revisionsDiffButton",diffTool:!1,dialogOptions:{width:450,height:400,modal:!1},init:function(){return Xn.prototype.init.apply(this,arguments)},action:function(){var e=this.getDialog(this);this.openDialog(e),Q(e)},applyAction:function(){},getOkButton:function(){return!1},getDiffTool:function(){return this.diffTool||(this.diffTool=new diff_match_patch),this.diffTool},getDiff:function(){var e=this.options.revision.identifier+"-"+this.options.revision.updated;if("undefined"==typeof hs[e]){var t=this.getDiffTool().diff_main(this.options.revision.content,this.options.current.content);this.getDiffTool().diff_cleanupSemantic(t),hs[e]=this.getDiffTool().diff_prettyHtml(t)}return hs[e]},openDialog:function(e){e.find("."+this.options.baseClass+"-diff").html(this.getDiff())},getDialogTemplate:function(){return Oo("<div>").html(this.raptor.getTemplate("revisions.diff-dialog",this.options))}}),ms=new qn({name:"revisionsPreviewButton",init:function(){return this.raptor.bind("revisionsPreview",function(){z(this.button)}.bind(this)),qn.prototype.init.apply(this,arguments)},action:function(){this.raptor.getElement().html(this.options.revision.content),this.raptor.fire("revisionsPreview"),j(this.button)}}),fs=function(e){fs.initialise(this),this.menuVisible=null;for(var t in e)this[t]=e[t];L(this.node)||n("options.node for RaptorSection is expected to be a node",this.node),D(this.sections)||n("options.sections for RaptorSection is expected to be an array of section definitions",this.node),this.saveUrl&&(fs.saveUrl=this.saveUrl),this.node.classList.add("raptor-section"),this.node.raptorSection=this,this.nodeItem=null,this.nodeLayoutPane=null,this.nodeUI=p(k(fs.templates.ui)),this.nodeAddMenu=this.nodeUI.getElementsByClassName("raptor-section-add-menu")[0],this.nodeLayoutMenu=this.nodeUI.getElementsByClassName("raptor-section-layout-menu")[0],this.nodePlaceholder=p(k(fs.templates.placeholder)),this.nodeAddSection=this.nodeUI.getElementsByClassName("raptor-section-add-item")[0],this.nodeRemoveSection=this.nodeUI.getElementsByClassName("raptor-section-remove")[0],this.nodeLayout=this.nodeUI.getElementsByClassName("raptor-section-add-layout")[0],this.nodeGuides=this.nodeUI.getElementsByClassName("raptor-section-guides")[0],this.nodeSave=this.nodeUI.getElementsByClassName("raptor-section-save")[0];var i=0;this.sortableOptions={connectWith:".raptor-section, .raptor-section-layout-pane",tolerance:"pointer",placeholder:"raptor-section-sortable-placeholder",cancel:"[contenteditable=true], :input",cursorAt:{left:-10,top:0},sort:function(e,t){t.helper.css("top",e.pageY-t.helper.parent().offset().top-i)},start:function(e,t){i=t.helper.position().top,fs.sorting=!0,fs.hideAllUI()}.bind(this),stop:function(e,t){fs.sorting=!1;for(var i=t.item[0].parentNode;!i.raptorSection;)i=i.parentNode;i.raptorSection.nodeItem=t.item[0]===document.elementFromPoint(e.clientX,e.clientY)?t.item[0]:null,i.raptorSection.showUI()}.bind(this)},this.sections.sort(function(e,t){return e.label.localeCompare(t.label)});for(var o=0,s=this.sections.length;s>o;o++){var a=p(k(fs.templates.menuItem,this.sections[o]));a.addEventListener("click",this.hideMenu.bind(this)),a.raptorSectionItem=this.sections[o],this.nodeAddMenu.appendChild(a)}this.layouts.sort(function(e,t){return e.label.localeCompare(t.label)});for(var o=0,s=this.layouts.length;s>o;o++){var a=p(k(fs.templates.menuItem,this.layouts[o]));a.addEventListener("click",this.hideMenu.bind(this)),a.raptorSectionLayout=this.layouts[o],this.nodeLayoutMenu.appendChild(a)}document.body.appendChild(this.nodeUI),document.body.appendChild(this.nodePlaceholder);for(var r=this.getItems(),o=0;o<r.length;o++)u(r[o]),this.itemBind(r[o],this.getItemDefinition(r[o].dataset.raptorSection)),r[o].raptorSectionItem=JSON.parse(r[o].dataset.raptorSection);for(var l=this.getLayouts(),o=0;o<l.length;o++)this.layoutBind(l[o],this.getLayoutDefinition(l[o].dataset.layout));q(Oo(this.nodeAddMenu),{select:this.menuAddItemSelect.bind(this)}),q(Oo(this.nodeLayoutMenu),{select:this.menuAddLayoutSelect.bind(this)}),A(this.nodeAddSection,{icons:{primary:"ui-icon-add"},text:!1}).removeClass("ui-corner-all"),A(this.nodeRemoveSection,{icons:{primary:"ui-icon-remove"},text:!1}).removeClass("ui-corner-all"),A(this.nodeLayout,{icons:{primary:"ui-icon-layout"},text:!1}).removeClass("ui-corner-all"),A(this.nodeGuides,{icons:{primary:"ui-icon-guides"},text:!1}).removeClass("ui-corner-all"),A(this.nodeSave,{icons:{primary:"ui-icon-save"},text:!1}).removeClass("ui-corner-all"),this.nodeAddSection.addEventListener("click",function(){this.toggleMenu(this.nodeAddMenu)}.bind(this)),this.nodeLayout.addEventListener("click",function(){this.toggleMenu(this.nodeLayoutMenu)}.bind(this)),this.nodeGuides.addEventListener("click",fs.toggleGuides),this.nodeSave.addEventListener("click",fs.save),this.mouseBind(),this.nodeRemoveSection.addEventListener("click",function(){if(this.nodeItem)this.nodeItem.remove(),this.nodeItem=null,this.showUI();else if(this.nodeLayoutPane){var e=fs.findParentLayout(this.nodeLayoutPane,this.node);e.remove(),this.nodeLayoutPane=null,this.showUI()}}.bind(this)),Oo(this.node).sortable(this.sortableOptions),this.stateInitialise()};fs.prototype=Object.create(fs),fs.prototype.itemBind=function(e,t){e.raptorSectionDefinition=t,this.mouseBindItem(e)},fs.prototype.layoutBind=function(e,t){e.classList.add("raptor-section-layout"),e.raptorSectionLayout={name:t.name};for(var i=e.querySelectorAll("[data-pane]"),n=0;n<i.length;n++)i[n].classList.add("raptor-section-layout-pane"),i[n].raptorSectionLayoutPane={},this.mouseBindLayoutPane(i[n]),Oo(i[n]).sortable(this.sortableOptions)},fs.prototype.menuAddItemSelect=function(e,t){var i=e.currentTarget.raptorSectionItem,n=p(k(fs.templates.sectionItem,{content:t.item.text()}));this.itemBind(n,i),n.raptorSectionItem={name:i.name},i.choices?this.choiceOpenDialog(i,n):i.ajax?(Oo.ajax(Oo.extend({async:!1},i.ajax)).done(function(e){"object"==typeof e?(e.html&&(n.innerHTML=e.html),e.choice&&(n.raptorSectionItem.choice=e.choice)):n.innerHTML=e}),this.itemInsert(n)):"function"==typeof i.insert?(i.insert(n),this.itemInsert(n),i.choice&&(n.raptorSectionItem.choice=i.choice)):i.insert&&(n.innerHTML=i.insert,this.itemInsert(n))},fs.prototype.menuAddLayoutSelect=function(e){var t=e.currentTarget.raptorSectionLayout,i=p(t.layout);this.layoutBind(i,t),this.insertNode(i)},fs.prototype.itemInsert=function(e){this.insertNode(e);for(var t=e.getElementsByTagName("script"),i=0;i<t.length;i++)if(t[i].src){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",t[i].src),document.getElementsByTagName("head")[0].appendChild(n)}else!function(e){eval.call(this,e)}(t[i].innerText)},fs.prototype.insertNode=function(e){this.nodeItem?this.nodeItem.parentNode.insertBefore(e,this.nodeItem):this.nodeLayoutPane?this.nodeLayoutPane.appendChild(e):this.node.appendChild(e)},fs.prototype.getItemDefinition=function(e){for(var t=0;t<this.sections.length;t++)if(this.sections[t].name===e)return this.sections[t];return null},fs.prototype.getLayoutDefinition=function(e){for(var t=0;t<this.layouts.length;t++)if(this.layouts[t].name===e)return this.layouts[t];return null},fs.prototype.hideUI=function(){this.hideNode(this.nodeUI),this.hideMenu()},fs.prototype.showUI=function(){fs.sorting||(fs.hideAllUI(this),this.showNode(this.nodeUI))},fs.prototype.repositionUI=function(e){var t,i;i=this.nodeItem?Oo(this.nodeItem).offset().left+this.nodeItem.offsetWidth-parseInt(getComputedStyle(this.nodeItem).borderRightWidth):this.nodeLayoutPane?Oo(this.nodeLayoutPane).offset().left+this.nodeLayoutPane.offsetWidth-parseInt(getComputedStyle(this.nodeLayoutPane).borderRightWidth):Oo(this.node).offset().left+this.node.offsetWidth-parseInt(getComputedStyle(this.node).borderRightWidth),this.nodeUI.style.left="0px",i>document.body.offsetWidth-this.nodeUI.offsetWidth&&(i=document.body.offsetWidth-this.nodeUI.offsetWidth),t=e.pageY-this.nodeUI.offsetHeight/2,this.nodeUI.style.top=t+"px",this.nodeUI.style.left=i+"px",this.fadeUI(e)},fs.prototype.fadeUI=function(e){var t=this.nodeUI.offsetWidth,i=this.nodeUI.offsetHeight;if(0!==t&&0!==i){var n=this.nodeUI.offsetLeft+t/2,o=this.nodeUI.offsetTop+i/2,s=Math.sqrt(Math.pow(n-e.pageX,2)+Math.pow(o-e.pageY,2));this.nodeUI.style.opacity=2*(1-Math.min(s/1e3,1))}},fs.prototype.getNode=function(){return this.node},fs.prototype.getItems=function(){return this.node.getElementsByClassName("raptor-section-item")},fs.prototype.getLayouts=function(){return this.node.querySelectorAll("[data-layout]")},fs.prototype.getLayoutPanes=function(){return this.node.querySelectorAll("[data-pane]")},fs.prototype.serialize=function(){return this.node.querySelectorAll("[data-layout], .raptor-section-item")},fs.prototype.hideMenu=function(){null!==this.menuVisible&&(this.hideNode(this.menuVisible),this.menuVisible=null)},fs.prototype.showMenu=function(e){null===this.menuVisible&&(this.hideMenu(),this.menuVisible=e,this.showNode(e),this.repositionMenu(e))},fs.prototype.toggleMenu=function(e){this.menuVisible===e?this.hideMenu():null!==this.menuVisible?(this.hideMenu(),this.showMenu(e)):this.showMenu(e)},fs.prototype.repositionMenu=function(e){var t=e.parentNode.getElementsByClassName(e.dataset["for"])[0];e.style.top=t.offsetBottom+"px",e.style.left=t.offsetLeft+"px"},fs.templates={choice:'<div><a href="#">{{label}}</a></div>',layoutDialog:'<div> <h1>Layouts</h1> <ul> <li><a href="#">Full Width</a></li> <li><a href="#">Right Sidebar</a></li> <li><a href="#">Left Sidebar</a></li> <li><a href="#">2 Column</a></li> <li><a href="#">3 Column</a></li> </ul> </div>',layoutItem:'<div class="raptor-section-layout" data-layout="">{{content}}</div>',menuItem:'<li><a class="raptor-section-menu-item">{{label}}</a></li>',pane:'<div class="raptor-section-pane"></div>',placeholder:'<div class="raptor-section-placeholder raptor-section-hidden ui-state-information ui-corner-all">Insert new item...</div>',sectionItem:'<div class="raptor-section-item">{{content}}</div>',sortablePlaceholder:'<div class="raptor-section-placeholder ui-state-information ui-corner-all">Move here...</div>',ui:'<div class="raptor-section-ui raptor-section-hidden ui-front ui-state-default ui-corner-all ui-front"> <button type="button" class="raptor-section-add-item ui-corner-left">Add Block</button> <button type="button" class="raptor-section-remove">Remove</button> <button type="button" class="raptor-section-add-layout">Layout</button> <button type="button" class="raptor-section-guides">Guides</button> <button type="button" class="raptor-section-save ui-corner-right">Save</button> <ul class="raptor-section-menu raptor-section-add-menu raptor-section-hidden" data-for="raptor-section-add-item"></ul> <ul class="raptor-section-menu raptor-section-layout-menu raptor-section-hidden" data-for="raptor-section-add-layout"></ul> </div>'},fs.initialised=!1,fs.instances=[],fs.sorting=!1,fs.saveUrl=null,fs.initialise=function(e){fs.instances.push(e),fs.initialised||(fs.initialised=!0,document.addEventListener("click",function(e){var t=e.target;do if(t.classList.contains("raptor-section-ui"))return;while((t=t.parentNode)&&t.classList);fs.hideAllUI()}))},fs.hideAllUI=function(e){for(var t=0,i=fs.instances.length;i>t;t++)e!==fs.instances[t]&&fs.instances[t].hideUI()},fs.showNode=function(e){g(e,"raptor-section-visible","raptor-section-hidden")},fs.hideNode=function(e){g(e,"raptor-section-hidden","raptor-section-visible")},fs.toggleGuides=function(){document.body.classList.toggle("raptor-section-guide")},fs.getSaveData=function(){for(var e={},t=0;t<fs.instances.length;t++){var i=fs.instances[t].node,n=fs.instances[t].id;"function"==typeof n&&(n=n(fs.instances[t])),e[n]=[];for(var o=fs.instances[t].serialize(),s=0;s<o.length;s++){var a=fs.findParentLayoutPane(o[s],i),r=null;a&&(r=fs.findParentLayout(a,i)),o[s].raptorSectionLayoutIndex=s,o[s].raptorSectionItem?e[n].push({layoutIndex:r?r.raptorSectionLayoutIndex:null,layoutPane:a?a.dataset.pane:null,type:"item",name:o[s].raptorSectionItem.name,data:o[s].raptorSectionItem}):o[s].raptorSectionLayout&&e[n].push({layoutIndex:r?r.raptorSectionLayoutIndex:null,layoutPane:a?a.dataset.pane:null,type:"layout",name:o[s].raptorSectionLayout.name})
}}return e},fs.findParentLayoutPane=function(e,t){var i=e;do{if(i.raptorSectionLayoutPane)return i;i=i.parentNode}while(i&&i!=t)},fs.findParentLayout=function(e,t){var i=e;do{if(i.raptorSectionLayout)return i;i=i.parentNode}while(i&&i!=t)},fs.save=function(e){fs.saveUrl&&Oo.ajax({url:fs.saveUrl,method:"post",dataType:"json",data:{sections:JSON.stringify(fs.getSaveData())}}).done(function(e){if(e){for(var t=0,i=fs.instances.length;i>t;t++){var n=fs.instances[t].getItems(),o=fs.instances[t].id;"function"==typeof o&&(o=o(fs.instances[t]));for(var s=0;s<n.length;s++)"undefined"!=typeof e[o]&&"undefined"!=typeof e[o][s]&&(n[s].raptorSectionItem=e[o][s])}for(var t=0,i=fs.instances.length;i>t;t++)fs.instances[t].stateInitialise();X({title:"Saved Sections",text:"Sucessfully saved all CMS sections on this page.",type:"success"})}else X({title:"Save Failed",text:"Failed to save all CMS sections on this page.",type:"error"})}).error(function(){X({title:"Save Failed",text:"Failed to save all CMS sections on this page.",type:"error"})}).always(function(){if(e!==!1){var t=!1;Go.eachInstance(function(e){!t&&e.isDirty()&&e.unify&&(e.getUi("save").getPlugin().save(!1),t=!0)})}})},jQuery.fn.raptorSection=function(e){return this.each(function(){new fs(Oo.extend({node:this},e))})},fs.prototype.stateInitialise=function(){this.state=this.stateGet()},fs.prototype.stateGet=function(){for(var e="",t=this.getItems(),i=0,n=t.length;n>i;i++)e+=t[i].id+",";return e},b("raptor-section",function(){for(var e=0,t=fs.instances.length;t>e;e++)if(fs.instances[e].state!==fs.instances[e].stateGet())return!0}),fs.prototype.choiceOpenDialog=function(e,t){var i=document.createElement("div");if("array"==typeof e.choices)for(var n=0,o=e.choices.length;o>n;n++){var s=p(k(fs.templates.choice,e.choices[n]));s.raptorSectionDefinition=e,s.raptorSectionItem=t,s.raptorSectionChoice=e.choices[n],s.raptorSection=this,s.addEventListener("click",this.choiceSelect),i.appendChild(s)}else"object"==typeof e.choices&&(e.choices.url?wo.get(e.choices.url,null,function(e){i.innerHTML=e}.bind(this),!1):e.choices.content&&(i.innerHTML=e.choices.content));W(i,{modal:!0,title:e.title,width:"auto",height:"auto",close:function(){V(i)}}),this.choiceDialog=i,this.choiceSectionItem=t,e.bind&&e.bind(this,i)},fs.prototype.choiceInsert=function(e,t){this.choiceSectionItem.innerHTML=e,this.choiceSectionItem.raptorSectionItem.choice=t,this.itemInsert(this.choiceSectionItem),G(this.choiceDialog)},fs.prototype.choiceSelect=function(){return this.raptorSection.choiceSectionItem.raptorSectionItem.choice=this.raptorSectionChoice.saveData,this.raptorSectionChoice.ajax?wo.get(this.raptorSectionChoice.ajax.url,null,function(e){this.raptorSection.choiceSectionItem.innerHTML=e,this.raptorSection.itemInsert(this.raptorSection.choiceSectionItem),G(this.raptorSection.choiceDialog)}.bind(this),!1):this.raptorSectionChoice.insert?(this.raptorSectionDefinition.insert(this.raptorSection.choiceSectionItem),this.raptorSection.itemInsert(this.raptorSection.choiceSectionItem),G(this.raptorSection.choiceDialog)):(this.raptorSection.choiceSectionItem.innerHTML=this.raptorSectionChoice.label,this.raptorSection.itemInsert(this.raptorSection.choiceSectionItem),G(this.raptorSection.choiceDialog)),!1},fs.prototype.mouseBind=function(){this.node.addEventListener("mouseover",function(e){this.mouseBlur(),this.showUI(),e.stopPropagation()}.bind(this)),this.node.addEventListener("mousemove",this.repositionUI.bind(this)),document.addEventListener("mousemove",this.fadeUI.bind(this));var e=function(){this.insertNode(this.nodePlaceholder),this.showNode(this.nodePlaceholder)}.bind(this),t=function(){this.hideNode(this.nodePlaceholder),this.nodePlaceholder.parentNode.removeChild(this.nodePlaceholder)}.bind(this);this.nodeAddSection.addEventListener("mouseover",e),this.nodeLayout.addEventListener("mouseover",e),this.nodeAddSection.addEventListener("mouseout",t),this.nodeLayout.addEventListener("mouseout",t),this.nodeRemoveSection.addEventListener("mouseover",function(){if(this.nodeItem)this.hideNode(this.nodeItem);else if(this.nodeLayoutPane){var e=fs.findParentLayout(this.nodeLayoutPane,this.node);this.hideNode(e)}}.bind(this)),this.nodeRemoveSection.addEventListener("mouseout",function(){if(this.nodeItem)this.showNode(this.nodeItem);else if(this.nodeLayoutPane){var e=fs.findParentLayout(this.nodeLayoutPane,this.node);this.showNode(e)}}.bind(this))},fs.prototype.mouseBindItem=function(e){e.addEventListener("mousemove",function(t){if(!t.raptorSectionHandled){var i;i=t.pageY-m(e)<e.offsetHeight/2?e:e.nextElementSibling,null===i?(this.mouseBlur(),this.showUI()):(t.raptorSectionHandled=!0,this.nodeItem!==i&&this.mouseFocusItem(i))}}.bind(this)),e.addEventListener("mouseover",function(e){e.stopPropagation()}.bind(this)),e.addEventListener("mouseout",function(e){var t=e.toElement||e.relatedTarget;t&&t.raptorSection&&this.mouseBlur()}.bind(this))},fs.prototype.mouseBindLayoutPane=function(e){e.addEventListener("mousemove",function(t){t.raptorSectionHandled||(t.raptorSectionHandled=!0,t.target.querySelector(".raptor-section-layout-pane")||this.nodeLayoutPane!==e&&this.mouseFocusLayoutPane(e))}.bind(this)),e.addEventListener("mouseover",function(e){e.stopPropagation()}.bind(this)),e.addEventListener("mouseout",function(e){var t=e.toElement||e.relatedTarget;if(t)do{if(t.raptorSection){this.mouseBlur();break}t=t.parentNode}while(t)}.bind(this))},fs.prototype.mouseFocusItem=function(e){this.mouseBlur(),this.nodeItem=e,this.nodeItem.classList.add("raptor-section-item-active"),this.showUI(),O(this.nodeRemoveSection)},fs.prototype.mouseFocusLayoutPane=function(e){this.mouseBlur(),this.nodeLayoutPane=e,this.nodeLayoutPane.classList.add("raptor-section-layout-pane-active"),this.showUI(),O(this.nodeRemoveSection)},fs.prototype.mouseBlur=function(){this.nodeItem?(this.nodeItem.classList.remove("raptor-section-item-active"),this.nodeItem=null):this.nodeLayoutPane&&(this.nodeLayoutPane.classList.remove("raptor-section-layout-pane-active"),this.nodeLayoutPane=null),F(this.nodeRemoveSection)},window.RaptorSection=fs}();