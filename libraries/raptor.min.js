!function(){function t(t,e,i){so[t]=i,ro[t]=e}function e(e,i,n){if("undefined"==typeof so[e])t(e,i,n);else{n=n||i;for(var o in n)so[e][o]=n[o]}}function n(t){oo!==t&&(oo=t,To.eachInstance(function(){this.localeChange()}))}function o(t,e){if("undefined"!=typeof so[oo]&&"undefined"!=typeof so[oo][t])return so[oo][t];if("undefined"!=typeof so[ao]&&"undefined"!=typeof so[ao][t])return so[ao][t];for(var i in ro)if("undefined"!=typeof so[i][t])return so[i][t];return e?!1:t}function a(t,e){if(!oo){var i=To.persist("locale");i&&(oo=i)}if(oo||(oo="en"),t=o(t,e===!1),t===!1)return!1;if(e){for(var n in e)t=t.replace("{{"+n+"}}",e[n]);return t}return t}function s(t){if(!t||!t.id){var e;do e="ruid-"+Math.random().toString().replace(".","");while(document.getElementById(e));if(!t)return e;t.id=e}return t.id}function r(t,e){return l(t,e)[0]}function l(t,e){var i=document.createElement(e||"div");return i.innerHTML=t,i.children}function c(t){for(var e in t)this[e]=t[e]}function p(t){var e=!1;for(var i in lo)"function"==typeof lo[i]?lo[i]()&&(e=!0):lo[i]&&(e=!0);if(e){var n="There are unsaved changes on this page. Are you sure you wish to navigate away?";return(t||window.event).returnValue=n,n}}function h(t,e){return t.replace(/([A-Z])/g,function(t){return(e||"-")+t.toLowerCase()})}function u(t){return co[t]}function d(t,e){return t=t.replace(/tr\(['"]{1}(.*?)['"]{1}\)/g,function(t,e){return e=e.replace(/\\(.?)/g,function(t,e){switch(e){case"\\":return"\\";case"0":return"\0";case"":return"";default:return e}}),a(e)}),e=mo.extend({},this.options,e||{}),e=g(e),t=t.replace(/\{\{(.*?)\}\}/g,function(t,i){return e[i]})}function g(t,e,i){e=e?e+".":"";var n=5;i||(i=1);var o={};for(var a in t)if("object"==typeof t[a]&&n>i){var s=g(t[a],e+a,++i);for(var r in s)o[r]=s[r]}else o[e+a]=t[a];return o}function f(t){return!isNaN(t-0)&&null!==t}function m(t){return"string"==typeof t}function b(t){return t instanceof Array}function v(t){return t instanceof Node}function y(t){return v(t)?t.nodeType===Node.TEXT_NODE:C(t)?v(t[0]):!1}function C(t){return t instanceof jQuery}function w(t,e){return mo(t).button(e)}function T(t,e){return mo(t).button("option","text",!0),mo(t).button("option","label",e)}function k(t,e){return mo(t).button("option","icons",{primary:e})}function E(t){return mo(t).button("option","disabled",!1)}function S(t){return!mo(t).is(".ui-state-disabled")}function x(t){return mo(t).button("option","disabled",!0)}function D(t){return mo(t).addClass("ui-state-highlight")}function R(t){return mo(t).removeClass("ui-state-highlight")}function P(t,e){return mo(t).menu(e)}function A(t,e){e.dialogClass="undefined"!=typeof e.dialogClass?e.dialogClass+" ui-dialog-fixed":"ui-dialog-fixed";var i=mo(t).dialog(e);return i.parent().css({top:(parseInt(i.parent().css("top"))||0)-mo(window).scrollTop()}),i.dialog("option","position","center"),i}function N(t){return mo(t).dialog("open")}function B(t){return mo(t).dialog("close")}function I(t,e){return mo(t).tabs(e)}function O(t){"success"==t.type&&(t.state="confirmation"),mo.pnotify(mo.extend({type:"success",styling:"jqueryui",history:!1},t))}function M(t,e,i){return H(t,e),t=Ji(e),i(),rangy.getSelection().removeAllRanges(),t}function H(t,e){if(t){var i=$i(e,t);return i.ranges&&rangy.getSelection().setRanges(i.ranges),i.element}return e}function L(t){t()}function U(){}function F(){}function j(t,e){for(var i in e){var n=e[i],o=!1;do if(o=mo(t).find(i),o.length){o=mo(o.get(0));var a=mo(n).clone();a.html(o.html()),a.attr(le(o)),o.replaceWith(a)}while(o.length)}}function z(t){mo(t).unwrap()}function W(t,e){for(i=0;i<e.length;i++)mo.trim(t.attr(e[i]))||t.removeAttr(e[i]),t.find("["+e[i]+"]").filter(function(){return""===mo.trim(mo(this).attr(e[i]))}).removeAttr(e[i])}function G(t){return t.contents().each(function(){this.nodeType==Node.COMMENT_NODE&&mo(this).remove()}),t.children().each(function(){G(mo(this))}),t}function q(t,e){var i;do i=!1,t.find(e.join(",")).each(function(){""===mo.trim(mo(this).html())&&(mo(this).remove(),i=!0)});while(i);return t}function V(t,e){for(var i=je(t),n=0,o=i.length;o>n;n++){var a=i[n].cloneNode(),s=document.createElement(e);s.appendChild(a),t.insertBefore(s,i[n]),t.removeChild(i[n])}}function X(t,e){var i;do i=!1,mo(t).find(e).each(function(){mo(this).parent().is(e)&&(mo(this).unwrap(),i=!0)});while(i)}function K(t){mo(t).find(".rangySelectionBoundary").remove()}function _(t,e){var i,n=mo("<div>").addClass("spacer");"top"===e.position?(i={position:"fixed",top:e.under?mo(e.under).outerHeight():0,left:0,right:0},e.spacer&&(e.under?n.insertAfter(e.under):n.prependTo("body"))):"topLeft"===e.position?(i={position:"fixed",top:e.under?mo(e.under).outerHeight():0,left:0},e.spacer&&(e.under?n.insertAfter(e.under):n.prependTo("body"))):"topRight"===e.position?(i={position:"fixed",top:e.under?mo(e.under).outerHeight():0,right:0},e.spacer&&(e.under?n.insertAfter(e.under):n.prependTo("body"))):"bottom"===e.position?(i={position:"fixed",bottom:0,left:0,right:0},e.spacer&&n.appendTo("body")):"bottomLeft"===e.position?(i={position:"fixed",bottom:0,left:0},e.spacer&&n.appendTo("body")):"bottomRight"===e.position&&(i={position:"fixed",bottom:0,right:0},e.spacer&&n.appendTo("body"));var o=en(t,i);return n.css("height",t.outerHeight()),setTimeout(function(){n.css("height",t.outerHeight())},300),{dockedElement:t,spacer:n,styleState:o}}function Q(t){return on(t.dockedElement,t.styleState),t.spacer.remove(),t.dockedElement.detach()}function J(t,e,i){var n=e.wrap("<div>").parent(),o=nn(n,e,{"float":"none",display:"block",clear:"none",position:"static",margin:0,marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,padding:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,outline:0,width:"auto",border:"none"}),a=en(t,{position:"static"});return n.prepend(t).addClass(i.wrapperClass?i.wrapperClass:""),{dockedElement:t,dockedTo:e,innerStyleState:o,dockedElementStyleState:a}}function $(t){on(t.dockedTo,t.innerStyleState),on(t.dockedElement,t.dockedElementStyleState);var e=t.dockedElement.detach();return t.dockedTo.unwrap(),e}function Y(t,e){return t.children().each(function(){var t=mo.map(this.attributes,function(t){return-1===mo.inArray(t.name,e)?t.name:void 0}),i=mo(this);mo.each(t,function(t,e){i.removeAttr(e)}),element.removeAttributes(mo(this),e)}),t}function Z(t){var e=1;t.siblings().each(function(){var t=mo(this).css("z-index");!isNaN(t)&&t>e&&(e=t+1)}),t.css("z-index",e)}function te(t){return t.clone().wrap("<div/>").parent().html()}function ee(t){return t.clone().wrap("<div/>").parent().text()}function ie(t){return"block"===oe(t.tagName)}function ne(t){var e=!1;return t.contents().each(function(){return!y(this)&&ie(this)?(e=!0,void 0):void 0}),e}function oe(t){var e,i=document.createElement(t),n="getComputedStyle"in window;return document.body.appendChild(i),e=(n?window.getComputedStyle(i,""):i.currentStyle).display,document.body.removeChild(i),e}function ae(t,e){return-1!==mo.inArray(mo(t)[0].tagName.toLowerCase(),e)}function se(t,e,i){var n=t.parentNode;return n[0]===i[0]?t:ae(n,e)?t:se(n,e,i)}function re(t){t=mo(t);var e={top:Math.round(t.offset().top),left:Math.round(t.offset().left),width:Math.round(t.outerWidth()),height:Math.round(t.outerHeight())},i=mo(window).scrollTop(),n=mo(window).height(),o=i+n,a=Math.round(e.height+e.top);return i<e.top&&o>a?e:(i>e.top&&(e.top=i),e.height=a>o?o-e.top:n-(o-a),e)}function le(t){for(var e=mo(t).get(0).attributes,i={},n=0,o=e.length;o>n;n++)i[e[n].name]=e[n].value;return i}function ce(t){for(var e={},i=window.getComputedStyle(t[0],null),n=0;n<i.length;n++)e[i.item(n)]=i.getPropertyValue(i.item(n));return e}function pe(t,e){var i=new jQuery;pi();for(var n=0,o=t.length;o>n;n++){var a=mo("<"+e+"/>").html(mo(t[n]).html());t.html(a),i.push(a[0])}return hi(),i}function he(t,e){mo.each(e,function(e,i){mo(t).css(e)===i?mo(t).css(e,""):mo(t).css(e,i)})}function ue(t,e,i){for(var n in i)t.css(n,e.css(n)),e.css(n,i[n])}function de(t){return t.is("img")||t.find("img").length?!1:/&nbsp;/.test(t.html())?!1:""===t.text()}function ge(t,e){var i=mo(e).offset(),n=mo(e).outerHeight();mo(t).css({top:i.top+n-mo(window).scrollTop()+"px",left:i.left+"px"})}function fe(t,e){var i=mo(t).parent();mo(t).detach(),e(t),i.append(t)}function me(t,e){for(;t.length>0&&t[0]!==e[0]&&(t[0].nodeType===Node.TEXT_NODE||"inline"===t.css("display"));)t=t.parent();return t[0]===e[0]?null:t}function be(){for(var t="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());mo("#"+t).length;)t="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());return t}function ve(t,e){for(var i=[],n=t.length-1;n>=0;n--){var o=document.createElement(e);o.innerHTML=t[n].innerHTML,mo.each(t[n].attributes,function(){mo(o).attr(this.name,this.value)}),mo(t[n]).after(o).remove(),i[n]=o}return mo(i)}function ye(t,e){if(t.outerHeight()>e.outerHeight()-20){var i=re(e),n=e.offset();t.css({position:"absolute",top:n.top-t.outerHeight(),left:i.left+(i.width/2-t.outerWidth()/2)})}else{var i=re(e);t.css({position:"absolute",top:i.top+(i.height/2-t.outerHeight()/2),left:i.left+(i.width/2-t.outerWidth()/2)})}}function Ce(t,e){for(var i="",n=0,o=t.childNodes.length;o>n;n++){var a=t.childNodes.item(n),s=a.nodeType===Node.TEXT_NODE?a.nodeValue:te(mo(a));s&&(i+=s)}return e&&(i=mo("<"+e+">"+i+"</"+e+">"),i.find("p").wrapInner("<"+e+"/>"),i.find("p > *").unwrap(),i=mo("<div/>").html(i).html()),i}function we(t,e,i){for(var n=0,o=t.childNodes.length;o>n;n++){var a=t.childNodes.item(n),s=a.nodeType===Node.TEXT_NODE?a.nodeValue:mo(a).html();s&&mo("<"+i+"/>").html(mo.trim(s)).insertBefore(e)}}function Te(t,e,i){return""!==i.html().trim()&&Ii()?Ee(t,e,i)?(console.log("listShouldConvertType"),He(t,e,i)):ke(t,e)?(console.log("listShouldUnwrap"),Me(t,e,i)):Se(t,e,i)?(console.log("listShouldWrap"),De(t,e,i)):void 0:void 0}function ke(t,e){var i=mo(Si());return i.is(t)?!0:"blockquote"!==t||i.parent().is(t)?i.is(e)&&i.parent().is(t)?!0:i.parentsUntil(t,e).length?!0:!1:!1}function Ee(t,e,i){var n=Oi(),o=mo(Ye(n));if(Ze(n)){var a=o.closest(e,i);a.length?Ke(n,[a]):qe(n)}return o=mo(Ye(n)),"blockquote"!==t||ei(n,o.get(0))?mo(o).is(e)&&!mo(o).parent().is(t)?!0:!1:!1}function Se(t,e,i){return"blockquote"===t?ae(i,uo):ae(i,ho)}function xe(t,e,i,n){n="undefined"==typeof n?!0:n;var o=function(t){return mo(t).is("img")||mo(t).find("img").length?void 0:mo(t).text().trim()?void 0:(mo(t).remove(),!0)};t.find("> "+e).each(function(){return n&&o(this)?!0:(mo(this).contents().each(function(){if(n&&o(this))return!0;if("p"===e){if(!y(this)&&!ae(this,i))return mo(this).contents().unwrap(),!0}else{if(y(this))return!0;if(!ae(this,i))return mo(this).contents().unwrap(),o(this),!0}}),void 0)})}function De(t,e,i){{var n=Oi();Ye(n)}n.startContainer,n.endContainer;var o=n.extractContents(),a=Ce(o),s=r("<"+t+">"+a+"</"+t+">"),l=mo(s);return l.children().wrap("<li>"),mi(l),void 0;var o}function Re(t,e){return t=mo("<div/>").html(t),ne(t)?(t.contents().each(function(){return mo(this).is("img")?!0:de(mo(this))?mo(this).remove():(mo(this).wrap("<"+e+"/>"),ie(this)||mo(this).wrap("<p>"),void 0)}),t.html()):"p"===e?"<"+e+">"+t.html()+"</"+e+">":"<"+e+"><p>"+t.html()+"</p></"+e+">"}function Pe(t,e,i){var n=t.contents();return n.length?(n.each(function(){return""===mo(this).text().trim()?mo(this).remove():y(this)||!ie(this)?mo(this).wrap("<"+i+">"):void 0}),t.contents().unwrap()):ve(t,i)}function Ae(t,e,i){return t.find(e).each(function(){Pe(mo(this),i,"p")}),t.contents().unwrap()}function Ne(t,e,i){Be(t,e,i),Ie(t,e,i)}function Be(t,e,i){t.is(e)&&t.find(i).each(function(){""===mo(this).text().trim()&&mo(this).remove()})}function Ie(t,e){t.is(e)&&""===t.text().trim()&&t.remove()}function Oe(t,e,i,n){var o=Je(t),a=$e(t),s=be();qe(t);var r="blockquote"===e?uo:go;r=mo.grep(r,function(t){return"li"!==t}),ri(t,mo("<p/>").attr("id",s),n,r);var l=mo("#"+s);Ne(l.prev(),e,i),Ne(l.next(),e,i);var c=[o];return o!==a&&(mo(o).nextUntil(a).each(function(){this!==a&&c.push(this)}),c.push(a)),c.reverse(),mo(c).each(function(){l.after(this),Pe(mo(this),e,"p")}),l.remove(),xe(mo(Ye(t)),i,po)}function Me(t,e,i){var n=Oi();Ze(n)&&Ke(n,[e]);var o=mo(Ye(n));if(o.is(t)){var a=Je(n),s=$e(n);return mo(s).is(t)&&mo(a).is(t)?Ae(o,e,t):Oe(n,t,e,i)}return o.is(e)||(o=o.closest(e)),o.prev().length||o.next().length?o.next().length&&o.prev().length?Oe(n,t,e,i):o.next().length&&!o.prev().length?(o.parent().before(Pe(o,t,"p")),o.remove(),void 0):!o.next().length&&o.prev().length?(o.parent().after(Pe(o,"p",t)),o.remove(),void 0):void 0:Ae(o.closest(t),e,t)}function He(t,e,i){var n=Oi();Ze(n)&&Ke(n,[e]);var o=Je(n),a=$e(n),s=be();qe(n);var r=mo.grep(go,function(t){return t!==e});ri(n,mo("<p/>").attr("id",s),i,r);var l=mo("#"+s);Ne(l.prev(),t,e),Ne(l.next(),t,e);var c=[o];o!==a&&(mo(o).nextUntil(a).each(function(){this!==a&&c.push(this)}),c.push(a)),c.reverse(),mo(c).each(function(){l.after(this)}),l.remove();var p=mo(c).wrap("<"+t+">").parent();return xe(p,e,po)}function Le(t,e,i,n){var o=Ei();if(!o.closest(e).length)return!1;var a=o.closest(t);if(!a.length||i.get(0)===a.get(0))return!1;Ti(o),Qi();var s=mo("<"+t+"/>"),r=mo("<"+t+"/>"),l=!1;return a.children().each(function(){return o.closest(e).get(0)===this?(l=!0,s.append(this),void 0):(l?r.append(this):s.append(this),void 0)}),a.replaceWith(s),n=mo(n).appendTo(mo("body")),s.after(n,r),n}function Ue(t,e){var i=Ei();if(!i.closest(e).length)return!1;Qi(),Ti(i);var n=ki();""===n.trim()&&(n="&nbsp;"),Qi(),""===i.text().trim()&&i.html("&nbsp;");var o=mo("<"+e+">").html(n);return i.closest(e).after(o),xe(i.closest(t),e,po,!1),o}function Fe(t){for(;t.nodeType===Node.TEXT_NODE;)t=t.parentNode;return t}function je(t){for(var e=[],i=/^\s*$/,n=0,o=t.childNodes.length;o>n;n++)t.childNodes[n].nodeType==Node.TEXT_NODE&&(i.test(t.childNodes[n].nodeValue)||e.push(t.childNodes[n]));return e}function ze(t,e){for(var i=t.parentNode;null!=i;){if(i==e)return!0;i=i.parentNode}return!1}function We(t,e){if(localStorage){var i;i=localStorage.raptor?JSON.parse(localStorage.raptor):{},i[t]=e,localStorage.raptor=JSON.stringify(i)}}function Ge(t){if(localStorage){var e;return e=localStorage.raptor?JSON.parse(localStorage.raptor):{},e[t]}}function qe(t){t.setStartBefore(t.startContainer),t.setEndAfter(t.endContainer)}function Ve(t,e){t.selectNode(mo(e)[0])}function Xe(t,e){t.selectNodeContents(mo(e).get(0))}function Ke(t,e){do{qe(t);for(var i=0,n=e.length;n>i;i++)if(mo(t.commonAncestorContainer).is(e[i]))return}while(t.commonAncestorContainer)}function _e(t,e){var i=[],n=mo("<div/>").append(e)[0].childNodes;return t.deleteContents(),void 0===n.length||1===n.length?t.insertNode(n[0].cloneNode(!0)):mo.each(n,function(e,n){i.unshift(n.cloneNode(!0)),t.insertNodeAtEnd(i[0])}),i}function Qe(t){var e=li(t);return"string"==typeof e&&(e=e.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")),tn(e)}function Je(t){return Fe(t.startContainer)}function $e(t){return Fe(t.endContainer)}function Ye(t){return Fe(t.commonAncestorContainer)}function Ze(t){return t.startOffset===t.endOffset&&t.startContainer===t.endContainer}function ti(t,e){var i=t.cloneRange();return i.selectNodeContents(e),i.containsRange(t)}function ei(t,e){return t.containsNode(e)}function ii(t,e){return t.containsNodeText(e)}function ni(t){if(t.startContainer.data)for(;/\s/.test(t.startContainer.data.substr(t.startOffset,1));)t.setStart(t.startContainer,t.startOffset+1);if(t.endContainer.data)for(;t.endOffset>0&&/\s/.test(t.endContainer.data.substr(t.endOffset-1,1));)t.setEnd(t.endContainer,t.endOffset-1)}function oi(t,e){return rangy.serializeRange(t,!0,e)}function ai(t,e){for(var i=t.split("|"),n=[],o=0,a=i.length;a>o;o++)n[o]=rangy.deserializeRange(i[o],e);return n}function si(t,e,i,n){var o=Ye(t);ae(o,n)||(o=se(o,n,i));var a=rangy.createRange();a.setStartBefore(o),a.setEnd(t.startContainer,t.startOffset);var s=a.cloneContents(),r=rangy.createRange();r.setStart(t.endContainer,t.endOffset),r.setEndAfter(o);var l=r.cloneContents(),c=te(mo(Ce(s)));return c+=te(mo(e).attr("data-replacement",!0)),c+=te(mo(Ce(l))),c=mo(c),mo(o).replaceWith(c),c=c.parent().find("[data-replacement]").removeAttr("data-replacement"),c.prev().is(o.tagName.toLowerCase())&&!c.prev().html().trim()&&c.prev().remove(),c.next().is(o.tagName.toLowerCase())&&!c.next().html().trim()&&c.next().remove(),c}function ri(t,e,i,n){var o=Fe(t.startContainer),a=Fe(t.endContainer),s=Ye(t),r=ae(s,n),l=ae(o,n),c=ae(a,n);return r&&l&&c?_e(t,e):si(t,e,i,n)}function li(t){return Ce(t.cloneContents())}function ci(){var t=rangy.getSelection();return t.rangeCount>0?t.getRangeAt(0):null}function pi(t){(!fo||t)&&(fo=rangy.saveSelection())}function hi(){fo&&(rangy.restoreSelection(fo),fo=!1)}function ui(){fo&&rangy.removeMarkers(fo),fo=!1}function di(){return fo!==!1}function gi(t,e,i){e=e||rangy.getSelection();for(var n,o=0;n=e.getAllRanges()[o++];)t.call(i,n)}function fi(t){rangy.getSelection().setSingleRange(t)}function mi(t,e){var i=[];return gi(function(e){i=i.concat(_e(e,t))},e,this),i}function bi(t,e){e=e||rangy.getSelection();var i=rangy.createRange();i.selectNodeContents(t),e.setSingleRange(i)}function vi(t){var e=rangy.createRange();e.selectNode(t),rangy.getSelection().setSingleRange(e)}function yi(t,e,i){e=e||rangy.getSelection(),e.removeAllRanges(),mo(t).each(function(){var t=rangy.createRange();t.selectNodeContents(this),t.collapse(i),e.addRange(t)})}function Ci(t,e){yi(t,e,!1)}function wi(t,e){yi(t,e,!0)}function Ti(t,e){e=e||rangy.getSelection();var i=Oi();e.removeAllRanges(),i.setEndAfter(t.get(0)),e.addRange(i)}function ki(t){return t=t||rangy.getSelection(),t.toHtml()}function Ei(t,e){if(e=e||rangy.getSelection(),!Ii())return new jQuery;var i,t=Oi();return i=t.commonAncestorContainer.nodeType===Node.TEXT_NODE?t.commonAncestorContainer.parentNode:t.commonAncestorContainer,mo(i)}function Si(t){var e=new jQuery;return gi(function(t){e.push(Ei(t)[0])},t,this),e}function xi(){var t=rangy.getSelection();return null===t.anchorNode?null:t.isBackwards()?t.focusNode.nodeType===Node.TEXT_NODE?mo(t.focusNode.parentElement):mo(t.focusNode):(t.anchorNode||console.trace(),t.anchorNode.nodeType===Node.TEXT_NODE?mo(t.anchorNode.parentElement):mo(t.anchorNode))}function Di(){var t=rangy.getSelection();return null===t.anchorNode?null:t.isBackwards()?t.anchorNode.nodeType===Node.TEXT_NODE?mo(t.anchorNode.parentElement):mo(t.anchorNode):t.focusNode.nodeType===Node.TEXT_NODE?mo(t.focusNode.parentElement):mo(t.focusNode)}function Ri(){var t=rangy.getSelection(),e=t.isBackwards()?t.anchorNode:t.focusNode,i=t.isBackwards()?t.focusOffset:t.anchorOffset;if(i!==e.textContent.length)return!1;var n=e.nextSibling;return n&&""!==mo(n).html()?!1:!0}function Pi(){var t=rangy.getSelection(),e=t.isBackwards()?t.focusNode:t.anchorNode;if(t.isBackwards()?t.focusOffset:0!==t.anchorOffset)return!1;var i=e.previousSibling;return i&&""!==mo(i).html()?!1:!0}function Ai(){return""===rangy.getSelection().toHtml()}function Ni(t,e){e=e||{};var i=rangy.createCssClassApplier(e.classes||"",{normalize:!0,elementTagName:t,elementProperties:e.attributes||{}});gi(function(n){if(Qe(n)){var o=mo("<"+t+"/>").addClass(e.classes).attr(e.attributes||{}).append(Ce(n.cloneContents()));_e(n,o)}else i.toggleRange(n)},null,this)}function Bi(t,e,i){gi(function(n){var o=Ei(n);o.is(t)?o.attr(e):Ni(t,{classes:i,attributes:e})},null,this)}function Ii(){return 0!==rangy.getSelection().rangeCount}function Oi(){return rangy.getSelection().getRangeAt(0)}function Mi(t,e){e=e||rangy.getSelection();var i=i(),n=Si()[0],o=rangy.createRange();o.setStartBefore(n),o.setEnd(i.startContainer,i.startOffset);var a=o.cloneContents(),s=rangy.createRange();s.setStart(i.endContainer,i.endOffset),s.setEndAfter(n);var r=s.cloneContents(),l=te(mo(Ce(a)));return l+=te(mo(t).attr("data-replacement",!0)),l+=te(mo(Ce(r))),l=mo(l),mo(n).replaceWith(l),l.parent().find("[data-replacement]").removeAttr("data-replacement")}function Hi(t,e,i){if(i=i||rangy.getSelection(),Ii()){var n=xi()[0],o=Di()[0],a=Si()[0],s=ae(a,e),r=ae(n,e),l=ae(o,e);return s&&r&&l?mi(t):Mi(t,i)}}function Li(t,e){gi(function(i){for(var n=mo(i.commonAncestorContainer);n.length&&n[0]!==e[0]&&(n[0].nodeType===Node.TEXT_NODE||"inline"===n.css("display"));)n=n.parent();n[0]===e[0]&&"inline"!==e.css("display")&&(pe(e,"div"),n=e.children().first()),he(n,t)},null,this)}function Ui(t,e,i){gi(function(n){var o,a=me(mo(n.startContainer),e),s=me(mo(n.endContainer),e);if(a&&s){a.is(s)?o=a:a&&s&&(o=a.nextUntil(s).andSelf().add(s));for(var r=0,l=o.length;l>r;r++)t(o[r])}else t(pe(e,i).get(0))})}function Fi(t,e,i,n){var o=!1,a=new jQuery;Ui(function(e){if(a.push(e),!o)for(var i=0,n=t.length;n>i;i++)mo(e).hasClass(t[i])||(o=!0)},i,n),mo(a).removeClass(e.join(" ")),o?mo(a).addClass(t.join(" ")):mo(a).removeClass(t.join(" "))}function ji(t,e){e=e||rangy.getSelection();for(var i=e.getAllRanges(),n=[],o=0,a=i.length;a>o;o++){var s=i[o].cloneRange();i[o].startContainer===t||ze(i[o].startContainer,t)||s.setStart(t,0),i[o].endContainer===t||ze(i[o].endContainer,t)||s.setEnd(t,t.childNodes.length),n.push(s)}e.setRanges(n)}function zi(t,e){if(t=t||document.body,e=e||rangy.getSelection(),Ii()){var i=Oi().cloneRange(),n=i.extractContents();""===Ce(n)&&(Xe(i,i.commonAncestorContainer),e.setSingleRange(i),n=i.extractContents()),n=mo("<div/>").append(Ce(n)).html().replace(/(<\/?.*?>)/gi,function(t){return null!==t.match(/^<(img|object|param|embed|iframe)/)?t:""});for(var o=i.commonAncestorContainer;o&&o.parentNode!==t;)o=o.parentNode;if(o){i.setEndAfter(o);var a=i.extractContents();i.collapseAfter(o),i.insertNode(a),i.collapseAfter(o)}n=mo.parseHTML(n),null!==n&&mo(n.reverse()).each(function(){return mo(this).is("img")?(i.insertNode(mo(this).removeAttr("width height class style").get(0)),void 0):(i.insertNode(this),void 0)})}}function Wi(t,e,i,n){pi();var o="domTools"+Math.ceil(1e7*Math.random());gi(function(t){var a=rangy.createCssClassApplier(n,{elementTagName:i});a.isAppliedToRange(t)?a.toggleSelection():rangy.createCssClassApplier(e,{elementTagName:o}).toggleSelection()},null,this),mo(o).each(function(){mo(this).replaceWith(mo("<"+t+"/>").addClass(e).html(mo(this).html()))}),hi()}function Gi(){var t=rangy.getSelection().getAllRanges();1===t.length&&""===li(t[0])&&rangy.getSelection().expand("word")}function qi(t,e,i){for(var n=rangy.getSelection().getAllRanges(),o=0,a=n.length;a>o;o++){var s=mo(Fe(n[o].startContainer));(i||!s.is(t)&&!s.is(e))&&(s=s.parentsUntil(e,t)),s=i?s.last():s.first(),1!==s.length||s.is(e)||n[o].setStart(s[0],0),s=mo(Fe(n[o].endContainer)),(i||!s.is(t)&&!s.is(e))&&(s=s.parentsUntil(e,t)),s=i?s.last():s.first(),1!==s.length||s.is(e)||n[o].setEnd(s[0],s[0].childNodes.length)}rangy.getSelection().setRanges(n)}function Vi(){if(Ii()){var t=Oi();ni(t),fi(t)}}function Xi(t,e){var i=new jQuery;return gi(function(n){for(var o=n.startContainer;o.nodeType===Node.TEXT_NODE;)o=o.parentNode;for(var a=n.endContainer;a.nodeType===Node.TEXT_NODE;)a=a.parentNode;var s=function(){e.is(this)||i.push(this)};do{if(mo(o).filter(t).each(s),e.is(o)||0!==i.length||mo(o).parentsUntil(e,t).each(s),mo(o).find(t).each(s),mo(a).is(o))break;o=mo(o).next()}while(o.length>0&&0===mo(o).prevAll().has(a).length)}),i}function Ki(t,e,i){var n=Xi(e.join(","),i);if(n.length)pi(),ve(n,t),hi();else{var o=i.get(0);o.innerHTML.trim()?(pi(),o.innerHTML="<"+t+">"+o.innerHTML+"</"+t+">",hi()):(o.innerHTML="<"+t+">&nbsp;</"+t+">",bi(o.childNodes[0]))}}function _i(t,e){var i=!0;return gi(function(n){var o=mo(n.commonAncestorContainer).find("*");0!==mo(n.commonAncestorContainer).parentsUntil(e,t).length||0!==o.length&&o.length===o.filter(t).length||(i=!1)}),i}function Qi(t){t=t||rangy.getSelection(),t.deleteFromDocument()}function Ji(t){var e=ci();return{element:t.clone(!0),ranges:e?oi(e,t.get(0)):null}}function $i(t,e){t.replaceWith(e.element);var i=null;try{e.ranges&&(i=ai(e.ranges,e.element.get(0)))}catch(n){}return{element:e.element,ranges:i}}function Yi(t,e){allowed=[];for(var i=0;i<e.length;i++)e[i].match(/[a-z][a-z0-9]{0,}/g)&&allowed.push(e[i]);var n=/<\/?([a-z][a-z0-9]*)\b[^>]*\/?>/gi,o=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return t.replace(o,"").replace(n,function(t,e){return allowed.indexOf(e.toLowerCase())>-1?t:""})}function Zi(t,e){return t.replace(/([A-Z])/g,function(t){return(e||"-")+t.toLowerCase()})}function tn(t){return mo(mo.parseHTML(t)).is(":empty")}function en(t,e){var i=t.get(0),n={};for(var o in e)n[o]=i.style[o];for(o in e)t.css(o,e[o]);return n}function nn(t,e,i){var n=e.get(0),o={};for(var a in i)o[a]=n.style[a];for(a in i)t.css(a,e.css(a)),e.css(a,i[a]);return o}function on(t,e){for(var i in e)t.css(i,e[i]||"")}function an(t,e,i){i=i||{};for(var n=document.createElement("table");e--;)for(var o=n.insertRow(0),a=0;t>a;a++){var s=o.insertCell(0);i.placeHolder&&(s.innerHTML=i.placeHolder)}return n}function sn(t,e,i){return resizeTable(t,0,0,1,e,i||{})}function rn(t,e){resizeTable(t,0,0,-1,e)}function ln(t,e,i){var n=new GoogTable(t);return n.insertRow(e,i)}function cn(t,e){resizeTable(t,-1,e,0,0)}function pn(t){for(var e,i,n,o,a=[],s=t.parentNode.parentNode.parentNode.tBodies[0].rows,r=0;r<s.length;r++){i=s[r].sectionRowIndex,i=r;for(var l=0;l<s[r].cells.length;l++){for(e=l;a[i]&&a[i][e];)e++;for(n=e;n<e+(s[r].cells[l].colSpan||1);++n)for(o=i;o<i+(s[r].cells[l].rowSpan||1);++o)a[o]||(a[o]=[]),a[o][n]=!0;if(t===s[r].cells[l])return{x:e,y:i}}}}function hn(t,e){for(var i=t.tBodies[0].rows,n=0;n<i.length;n++)for(var o=0;o<i[n].cells.length;o++){var a=pn(i[n].cells[o]);if(a.x===e.x&&a.y===e.y)return i[n].cells[o]}return null}function un(t,e,i){for(var n=Math.min(e.x,i.x),o=n,a=Math.min(e.y,i.y),s=Math.max(e.x,i.x),r=Math.max(e.y,i.y),l=[];r>=a;){for(;s>=o;){var c=hn(t,{x:o,y:a});null!==c&&l.push(c),o++}o=n,a++}return l}function dn(){}function gn(t,e,i,n,o){var a=new GoogTable(t);a.mergeCells(e,i,n,o)}function fn(){}function mn(t,e,i){var n=new GoogTable(t);n.splitCell(e,i)}function bn(t){for(var e=0,i=t.rows.length;i>e;e++)if(t.rows[e].cells.length>0)return!1;return!0}function vn(t){return t instanceof rangy.WrappedRange}function yn(t){return t instanceof rangy.WrappedSelection}function Cn(){if(void 0===bo){bo=!0,vo=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),vo&&(mo("html").addClass("raptor-ios"),vo&&mo(document).on("scroll",function(){setInterval(function(){mo("body").css("height","+=1").css("height","-=1")},0)})),Co=/Firefox/i.test(navigator.userAgent),Co&&mo("html").addClass("raptor-ff");var t=function(){var t=-1;return-1!=navigator.appVersion.indexOf("MSIE")&&(t=parseFloat(navigator.appVersion.split("MSIE")[1])),t}();wo=-1!==t,wo&&9>t&&(bo=!1,mo(function(){var t=mo("<div/>").addClass("raptor-unsupported").html('<div class="raptor-unsupported-overlay"></div><div class="raptor-unsupported-content">    It has been detected that you a using a browser that is not supported by Raptor, please    use one of the following browsers:    <ul>        <li><a href="http://www.google.com/chrome">Google Chrome</a></li>        <li><a href="http://www.firefox.com">Mozilla Firefox</a></li>        <li><a href="http://windows.microsoft.com/ie">Internet Explorer</a></li>    </ul>    <div class="raptor-unsupported-input">        <button class="raptor-unsupported-close">Close</button>        <input name="raptor-unsupported-show" type="checkbox" />        <label>Don\'t show this message again</label>    </div><div>').appendTo("body"),e=function(t){var e=1;t.siblings().each(function(){var t=mo(this).css("z-index");!isNaN(t)&&t>e&&(e=t+1)}),t.css("z-index",e)};e(t),t.find(".raptor-unsupported-close").click(function(){t.remove()})})),yo=void 0!==jQuery.hotkeys}return bo}function wn(t){this.name=t}function Tn(t,e){this.name=t;for(var i in e)this[i]=e[i]}function kn(t,e){this.raptor=t,this.uiOrder=e}function En(){wn.call(this,"toolbar"),this.wrapper=null}function Sn(){wn.call(this,"hoverPanel"),this.hoverPanel=null,this.visible=!1}function xn(){wn.call(this,"elementHoverPanel"),this.elements="img",this.hoverPanel=null,this.visible=!1,this.target=null,this.enabled=!0}function Dn(t){this.text=!1,this.label=null,this.icon=null,this.hotkey=null;for(var e in t)this[e]=t[e]}function Rn(t){this.preview=!0,this.previewing=!1,Dn.call(this,t)}function Pn(t){this.disable=!1,Dn.call(this,t)}function An(t){Rn.call(this,t)}function Nn(t){Dn.call(this,t)}function Bn(t){An.call(this,t)}function In(t){this.state=null,Dn.call(this,t)}function On(t){In.call(this,t),Pn.call(this,t)}function Mn(t,e){this.menu=t,this.name=t.name,this.raptor=t.raptor,this.options=t.options,Dn.call(this,e)}function Hn(t){this.menu=null,this.menuContent="",this.button=null;for(var e in t)this[e]=t[e]}function Ln(t){Hn.call(this,t)}function Un(){Ln.call(this,{name:"classMenu"})}function Fn(){this.colors=["white","black","grey","blue","red","green","purple","orange"],this.currentColor="automatic",Ln.call(this,{name:"colorMenuBasic"})}function jn(t,e){this.options={dockToElement:!1,docked:!1,position:"top",spacer:!0,persist:!0},this.dockState=!1,this.marker=!1,Tn.call(this,t||"dock",e)}function zn(t){this.raptor=t,this.label=a("linkTypeDocumentLabel")}function Wn(t){this.raptor=t,this.label=a("linkTypeEmailLabel")}function Gn(t){this.raptor=t,this.label=a("linkTypeExternalLabel")}function qn(t){this.raptor=t,this.label=a("linkTypeInternalLabel")}function Vn(t,e){Tn.call(this,t||"noBreak",e)}function Xn(t,e){Tn.call(this,t||"normaliseLineBreaks",e)}function Kn(t,e){this.options={allowedTags:["h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","p","a","span","hr","br","strong","em"],allowedAttributes:["href","title"],allowedEmptyTags:["hr","br"],panels:["formatted-clean","plain-text","formatted-unclean","source"]},Tn.call(this,t||"paste",e)}function _n(t,e){this.options={content:a("placeholderPluginDefaultContent"),tag:"p",select:!0},Tn.call(this,t||"placeholder",e)}function Qn(){Ln.call(this,{name:"snippetMenu"})}function Jn(t){Nn.call(this,t)}function $n(){Hn.call(this,{name:"tableCreate"})}function Yn(t,e){Tn.call(this,t||"tableSupport",e)}function Zn(){Ln.call(this,{name:"tagMenu"})}function to(t){An.call(this,t)}function eo(t,e){Tn.call(this,t||"toolTip",e)}function io(t,e){Tn.call(this,t||"unsavedEditWarning",e)}var no={};no.x=function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return new XMLHttpRequest}}},no.prepare=function(t){var e=[];for(var i in t)e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")},no.send=function(t,e,i,n,o){var a=no.x();a.open(i,t,o),a.onreadystatechange=function(){4==a.readyState&&e(a.responseText,a)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==i&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(n)},no.get=function(t,e,i,n){no.send(t+(e?"?"+no.prepare(e):""),i,"GET",null,n)},no.post=function(t,e,i,n){var o=[];for(var a in e)o.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));no.send(t,i,"POST",no.prepare(e),n)};var oo=null,ao="en",so={},ro={};c.prototype.init=function(){};var lo={};jQuery(window).on("beforeunload",p);var co={unsupported:'<div class="{{baseClass}}-unsupported-overlay"></div> <div class="{{baseClass}}-unsupported-content"> It has been detected that you a using a browser that is not supported by Raptor, please use one of the following browsers: <ul> <li><a href="http://www.google.com/chrome">Google Chrome</a></li> <li><a href="http://www.firefox.com">Mozilla Firefox</a></li> <li><a href="http://www.google.com/chromeframe">Internet Explorer with Chrome Frame</a></li> </ul> <div class="{{baseClass}}-unsupported-input"> <button class="{{baseClass}}-unsupported-close">Close</button> <input name="{{baseClass}}-unsupported-show" type="checkbox" /> <label>Don\'t show this message again</label> </div> <div>',"class-menu.item":'<li><a data-value="{{value}}">{{label}}</a></li>',"click-button-to-edit.button":"<button class=\"{{baseClass}}-button\">tr('clickButtonToEditPluginButton')</button>","color-menu-basic.menu":'<li><a data-color="automatic"><div class="{{baseClass}}-swatch" style="display: none"></div> <span>tr(\'colorMenuBasicAutomatic\')</span></a></li> <li><a data-color="white"><div class="{{baseClass}}-swatch" style="background-color: #ffffff"></div> <span>tr(\'colorMenuBasicWhite\')</span></a></li> <li><a data-color="black"><div class="{{baseClass}}-swatch" style="background-color: #000000"></div> <span>tr(\'colorMenuBasicBlack\')</span></a></li> <li><a data-color="grey"><div class="{{baseClass}}-swatch" style="background-color: #999"></div> <span>tr(\'colorMenuBasicGrey\')</span></a></li> <li><a data-color="blue"><div class="{{baseClass}}-swatch" style="background-color: #4f81bd"></div> <span>tr(\'colorMenuBasicBlue\')</span></a></li> <li><a data-color="red"><div class="{{baseClass}}-swatch" style="background-color: #c0504d"></div> <span>tr(\'colorMenuBasicRed\')</span></a></li> <li><a data-color="green"><div class="{{baseClass}}-swatch" style="background-color: #9bbb59"></div> <span>tr(\'colorMenuBasicGreen\')</span></a></li> <li><a data-color="purple"><div class="{{baseClass}}-swatch" style="background-color: #8064a2"></div> <span>tr(\'colorMenuBasicPurple\')</span></a></li> <li><a data-color="orange"><div class="{{baseClass}}-swatch" style="background-color: #f79646"></div> <span>tr(\'colorMenuBasicOrange\')</span></a></li>',"embed.dialog":'<div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a>tr(\'embedDialogTabCode\')</a></li> <li class="ui-state-default ui-corner-top"><a>tr(\'embedDialogTabPreview\')</a></li> </ul> <div class="{{baseClass}}-code-tab"> <p>tr(\'embedDialogTabCodeContent\')</p> <textarea></textarea> </div> <div class="{{baseClass}}-preview-tab" style="display: none"> <p>tr(\'embedDialogTabPreviewContent\')</p> <div class="{{baseClass}}-preview"></div> </div> </div>',"image-resize.dialog":'<div class="raptor-resize-image"> <div> <label for="{{baseClass}}-width">tr(\'imageResizeDialogWidth\')</label> <input class="form-text" id="{{baseClass}}-width" name="width" type="text" placeholder="tr(\'imageResizeDialogWidthPlaceHolder\')"/> </div> <div> <label for="{{baseClass}}-height">tr(\'imageResizeDialogHeight\')</label> <input class="form-text" id="{{baseClass}}-height" name="height" type="text" placeholder="tr(\'imageResizeDialogHeightPlaceHolder\')"/> </div> <div class="{{baseClass}}-lock-proportions-container"> <span class="{{baseClass}}-lock-proportions"> <span class="ui-button-text">Constrain proportions</span> <span class="ui-icon ui-icon-locked"></span> </span> </div> </div>',"insert-file.dialog":'<div> <div> <label class="form-label">tr(\'insertFileURLLabel\')</label> <input type="text" name="location" class="form-text" placeholder="tr(\'insertFileURLPlaceHolder\')"/> </div> <div> <label class="form-label">tr(\'insertFileNameLabel\')</label> <input type="text" name="name" class="form-text" placeholder="tr(\'insertFileNamePlaceHolder\')"/> </div> </div>',"link.dialog":'<div style="display:none" class="{{baseClass}}-panel"> <div class="{{baseClass}}-menu"> <p>tr(\'linkCreateDialogMenuHeader\')</p> <fieldset data-menu=""></fieldset> </div> <div class="{{baseClass}}-wrap"> <div class="{{baseClass}}-content" data-content=""></div> </div> </div>',"link.document":'<h2>tr(\'linkTypeDocumentHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-href">tr(\'linkTypeDocumentLocationLabel\')</label> <input id="{{baseClass}}-document-href" value="http://" name="location" class="{{baseClass}}-document-href" type="text" placeholder="tr(\'linkTypeDocumentLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeDocumentNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-target"> <input id="{{baseClass}}-document-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeDocumentNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeDocumentInfo\')',"link.email":'<h2>tr(\'linkTypeEmailHeader\')</h2> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email">tr(\'linkTypeEmailToLabel\')</label> <input id="{{baseClass}}-email" name="email" type="text" placeholder="tr(\'linkTypeEmailToPlaceHolder\')"/> </fieldset> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email-subject">tr(\'linkTypeEmailSubjectLabel\')</label> <input id="{{baseClass}}-email-subject" name="subject" type="text" placeholder="tr(\'linkTypeEmailSubjectPlaceHolder\')"/> </fieldset>',"link.error":'<div style="display:none" class="ui-widget {{baseClass}}-error-message {{messageClass}}"> <div class="ui-state-error ui-corner-all"> <p> <span class="ui-icon ui-icon-alert"></span> {{message}} </p> </div> </div>',"link.external":'<h2>tr(\'linkTypeExternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'linkTypeExternalLocationLabel\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'linkTypeExternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeExternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeExternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeExternalInfo\')',"link.file-url":'<h2>tr(\'Link to a document or other file\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'Location\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'Enter your URL\')" /> </fieldset> <h2>tr(\'New window\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'Check this box to have the file open in a new browser window\')</span> </label> </fieldset> <h2>tr(\'Not sure what to put in the box above?\')</h2> <ol> <li>tr(\'Ensure the file has been uploaded to your website\')</li> <li>tr(\'Open the uploaded file in your browser\')</li> <li>tr("Copy the file\'s URL from your browser\'s address bar and paste it into the box above")</li> </ol>',"link.internal":'<h2>tr(\'linkTypeInternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-href">tr(\'linkTypeInternalLocationLabel\') {{domain}}</label> <input id="{{baseClass}}-internal-href" value="" name="location" class="{{baseClass}}-internal-href" type="text" placeholder="tr(\'linkTypeInternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeInternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-target"> <input id="{{baseClass}}-internal-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeInternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeInternalInfo\')',"link.label":'<label> <input type="radio" name="link-type" autocomplete="off"/> <span>{{label}}</span> </label>',"paste.dialog":'<div class="{{baseClass}}-panel ui-dialog-content ui-widget-content"> <div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="{{baseClass}}-tab-formatted-clean ui-state-default ui-corner-top ui-state-active ui-tabs-selected" style="display: none"><a>tr(\'pasteDialogFormattedCleaned\')</a></li> <li class="{{baseClass}}-tab-plain-text ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogPlain\')</a></li> <li class="{{baseClass}}-tab-formatted-unclean ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogFormattedUnclean\')</a></li> <li class="{{baseClass}}-tab-source ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogSource\')</a></li> </ul> <div class="{{baseClass}}-content-formatted-clean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-markup"></div> </div> <div class="{{baseClass}}-content-plain-text" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-plain"></textarea> </div> <div class="{{baseClass}}-content-formatted-unclean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-rich"></div> </div> <div class="{{baseClass}}-content-source" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-source"></textarea> </div> </div> </div>',"snippet-menu.item":'<li><a data-name="{{name}}">{{name}}</a></li>',"special-characters.dialog":"<div> tr('specialCharactersHelp') <br/> <ul></ul> </div>","special-characters.tab-button":'<button data-setKey="{{setKey}}" data-charactersIndex="{{charactersIndex}}" title="{{description}}">{{htmlEntity}}</button>',"special-characters.tab-content":'<div id="{{baseClass}}-{{key}}"></div>',"special-characters.tab-li":'<li><a href="#{{baseClass}}-{{key}}">{{name}}</a></li>',"table.create-menu":'<table class="{{baseClass}}-menu"> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table>',"tag-menu.menu":"<li><a data-value=\"na\">tr('tagMenuTagNA')</a></li> <li><a data-value=\"p\">tr('tagMenuTagP')</a></li> <li><a data-value=\"h1\">tr('tagMenuTagH1')</a></li> <li><a data-value=\"h2\">tr('tagMenuTagH2')</a></li> <li><a data-value=\"h3\">tr('tagMenuTagH3')</a></li> <li><a data-value=\"h4\">tr('tagMenuTagH4')</a></li> <li><a data-value=\"div\">tr('tagMenuTagDiv')</a></li> <li><a data-value=\"pre\">tr('tagMenuTagPre')</a></li> <li><a data-value=\"address\">tr('tagMenuTagAddress')</a></li>","unsaved-edit-warning.warning":'<div class="{{baseClass}} ui-corner-tl"> <span class="ui-icon ui-icon-alert"></span> <span>tr(\'unsavedEditWarningText\')</span> </div>',"view-source.dialog":'<div class="{{baseClass}}-inner-wrapper"> <textarea></textarea> </div>'};
e("en","English",{alignCenterTitle:"Align text center",alignJustifyTitle:"Align text justify",alignLeftTitle:"Align text left",alignRightTitle:"Align text right",cancelDialogCancelButton:"Continue Editing",cancelDialogContent:"Are you sure you want to cancel editing? All changes will be lost!",cancelDialogOKButton:"Cancel Editing",cancelDialogTitle:"Cancel Editing",cancelTitle:"Cancel editing",classMenuTitle:"Style picker",cleanBlockTitle:"Clean block",clearFormattingTitle:"Clear formatting",clickButtonToEditText:"Edit",clickButtonToEditTitle:null,closeTitle:"Close this toolbar",colorMenuBasicAutomatic:"Automatic",colorMenuBasicBlack:"Black",colorMenuBasicBlue:"Blue",colorMenuBasicGreen:"Green",colorMenuBasicGrey:"Grey",colorMenuBasicOrange:"Orange",colorMenuBasicPurple:"Purple",colorMenuBasicRed:"Red",colorMenuBasicTitle:"Change text color",colorMenuBasicWhite:"White",dockToElementTitle:"Dock/undock editor to element",dockToScreenTitle:"Dock/undock editor to screen",embedTitle:"Embed object",embedDialogTitle:"Embed Object",embedDialogTabCode:"Embed Code",embedDialogTabCodeContent:"Paste your embed code into the text area below:",embedDialogTabPreview:"Preview",embedDialogTabPreviewContent:"A preview of your embedded object is displayed below:",embedDialogOKButton:"Embed Object",embedDialogCancelButton:"Cancel",errorUINoName:'UI "{{ui}}" is invalid (must have a name property)',errorUINotObject:'UI "{{ui}}" is invalid (must be an object)',errorUIOverride:'UI "{{name}}" has already been registered, and will be overwritten',editPageDialogTitle:"Edit Page",editPageDialogOKButton:"Save",editPageDialogCancelButton:"Cancel",floatLeftTitle:"Align image to the left",floatNoneTitle:"Remove image align",floatRightTitle:"Align image to the right",fontFamilyMenuTitle:"Choose your font",fontFamilyMenuFontDefault:"Default Font",fontFamilyMenuFontArial:"Arial",fontFamilyMenuFontPalatino:"Palatino",fontFamilyMenuFontGeorgia:"Georgia",fontFamilyMenuFontTimes:"Times New Roman",fontFamilyMenuFontComicSans:"Comic Sans",fontFamilyMenuFontImpact:"Impact",fontFamilyMenuFontCourier:"Courier New",guidesTitle:"Show element guides",historyRedoTitle:"Redo",historyUndoTitle:"Undo",hrCreateTitle:"Insert Horizontal Rule",imageResizeDialogWidth:"Image width",imageResizeDialogHeight:"Image height",imageResizeDialogWidthPlaceHolder:"Width",imageResizeDialogHeightPlaceHolder:"Height",imageResizeDialogTitle:"Resize Image",imageResizeDialogOKButton:"Resize",imageResizeDialogCancelButton:"Cancel",imageResizeTitle:"Resize this image",insertFileTitle:"Insert file",insertFileDialogTitle:"Insert file",insertFileDialogOKButton:"Insert file",insertFileDialogCancelButton:"Cancel",insertFileURLLabel:"File URL",insertFileNameLabel:"File Name",insertFileURLPlaceHolder:"File URL...",insertFileNamePlaceHolder:"File Name...",languageMenuTitle:"Change Language",loremIpsumTitle:"Insert dummy text for testing",listOrderedTitle:"Ordered list",listUnorderedTitle:"Unordered list",linkCreateTitle:"Insert Link",linkRemoveTitle:"Remove Link",linkCreateDialogTitle:"Insert Link",linkCreateDialogOKButton:"Insert Link",linkCreateDialogCancelButton:"Cancel",linkCreateDialogMenuHeader:"Choose a link type",linkTypeEmailLabel:"Email address",linkTypeEmailHeader:"Link to an email address",linkTypeEmailToLabel:"Email:",linkTypeEmailToPlaceHolder:"Enter email address",linkTypeEmailSubjectLabel:"Subject (optional):",linkTypeEmailSubjectPlaceHolder:"Enter subject",linkTypeExternalLabel:"Page on another website",linkTypeExternalHeader:"Link to a page on another website",linkTypeExternalLocationLabel:"Location:",linkTypeExternalLocationPlaceHolder:"Enter a URL",linkTypeExternalNewWindowHeader:"New window",linkTypeExternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeExternalInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on the web you want to link to.</li>    <li>Copy the web address from your browser's address bar and paste it into the box above.</li></ol>",linkTypeDocumentLabel:"Document or other file",linkTypeDocumentHeader:"Link to a document or other file",linkTypeDocumentLocationLabel:"Location:",linkTypeDocumentLocationPlaceHolder:"Enter a URL",linkTypeDocumentNewWindowHeader:"New window",linkTypeDocumentNewWindowLabel:"Check this box to have the file open in a new browser window/tab.",linkTypeDocumentInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Ensure the file has been uploaded to your website.</li>    <li>Open the uploaded file in your browser.</li>    <li>Copy the file's URL from your browser's address bar and paste it into the box above.</li></ol>",linkTypeInternalLabel:"Page on this website",linkTypeInternalHeader:"Link to a page on this website",linkTypeInternalLocationLabel:"",linkTypeInternalLocationPlaceHolder:"Enter a URI",linkTypeInternalNewWindowHeader:"New window",linkTypeInternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeInternalInfo:'<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on this site link to.</li>    <li>Copy the web address from your browser\'s address bar, excluding "{{domain}}" and paste it into the box above.</li></ol>',logoTitle:"Learn More About the Raptor WYSIWYG Editor",navigateAway:"\nThere are unsaved changes on this page. \nIf you navigate away from this page you will lose your unsaved changes",pasteDialogTitle:"Paste",pasteDialogOKButton:"Insert",pasteDialogCancelButton:"Cancel",pasteDialogPlain:"Plain Text",pasteDialogFormattedCleaned:"Formatted &amp; Cleaned",pasteDialogFormattedUnclean:"Formatted Unclean",pasteDialogSource:"Source Code",placeholderPluginDefaultContent:"<br/>",saveTitle:"Save content",saveNotConfigured:"Save has not been configured, or is disabled.",saveJsonFail:"Failed to save {{failed}} content block(s)",saveJsonSaved:"Successfully saved {{saved}} content block(s).",saveRestFail:"Failed to save {{failed}} content block(s).",saveRestPartial:"Saved {{saved}} out of {{failed}} content blocks.",saveRestSaved:"Successfully saved {{saved}} content block(s).",snippetMenuTitle:"Snippets",specialCharactersArrows:"Arrows",specialCharactersDialogOKButton:"OK",specialCharactersDialogTitle:"Insert Special Characters",specialCharactersGreekAlphabet:"Greek Alphabet",specialCharactersHelp:'Click a special character to add it. Click "OK" when done to close this dialog',specialCharactersMathematics:"Mathematics",specialCharactersSymbols:"Symbols",specialCharactersTitle:"Insert a special character",statisticsButtonCharacterOverLimit:"{{charactersRemaining}} characters over limit",statisticsButtonCharacterRemaining:"{{charactersRemaining}} characters remaining",statisticsButtonCharacters:"{{characters}} characters",statisticsDialogCharactersOverLimit:"{{characters}} characters, {{charactersRemaining}} over the recommended limit",statisticsDialogCharactersRemaining:"{{characters}} characters, {{charactersRemaining}} remaining",statisticsDialogNotTruncated:"Content will not be truncated",statisticsDialogOKButton:"Ok",statisticsDialogSentence:"{{sentences}} sentence",statisticsDialogSentences:"{{sentences}} sentences",statisticsDialogTitle:"Content Statistics",statisticsDialogTruncated:"Content contains more than {{limit}} characters and may be truncated",statisticsDialogWord:"{{words}} word",statisticsDialogWords:"{{words}} words",statisticsTitle:"Click to view statistics",imageSwapTitle:"Swap this image",tableCreateTitle:"Create table",tableDeleteColumnTitle:"Delete table column",tableDeleteRowTitle:"Delete table row",tableInsertColumnTitle:"Insert table column",tableInsertRowTitle:"Insert table row",tableMergeCellsTitle:"Merge table cells",tableSplitCellsTitle:"Split table cells",tagMenuTagH1:"Heading&nbsp;1",tagMenuTagH2:"Heading&nbsp;2",tagMenuTagH3:"Heading&nbsp;3",tagMenuTagH4:"Heading&nbsp;4",tagMenuTagNA:"N/A",tagMenuTagP:"Paragraph",tagMenuTagDiv:"Div",tagMenuTagPre:"Pre-formatted",tagMenuTagAddress:"Address",tagMenuTitle:"Change element style",tagTreeElementLink:"Select {{element}} element",tagTreeElementTitle:'Click to select the contents of the "{{element}}" element',tagTreeRoot:"root",tagTreeRootLink:"Select all editable content",tagTreeRootTitle:"Click to select all editable content",textBlockQuoteTitle:"Block quote",textBoldTitle:"Bold",textItalicTitle:"Italic",textStrikeTitle:"Strike through",textSubTitle:"Sub-script",textSuperTitle:"Super-script",textUnderlineTitle:"Underline",textSizeDecreaseTitle:"Decrease text size",textSizeIncreaseTitle:"Increase text size",unsavedEditWarningText:"There are unsaved changes on this page",revisionsText:"Revisions",revisionsTextEmpty:"No Revisions",revisionsTitle:null,revisionsCreated:"Created",revisionsApplyButtonTitle:"Rollback",revisionsApplyButtonText:"Rollback",revisionsAJAXFailed:"Failed to retrieve revisions",revisionsApplyButtonDialogCancelButton:"Cancel",revisionsApplyButtonDialogOKButton:"Rollback",revisionsApplyButtonDialogTitle:"Rollback Confirmation",revisionsApplyDialogContent:"This will replace the current content with the selected revision.<br/>The current content will be added as a revision, and will be visible in the revisions list for this block.",revisionsDialogCancelButton:"Cancel",revisionsDialogTitle:"View content revisions",revisionsButtonCurrent:"Current",revisionsButtonViewDiffText:"Differences",revisionsButtonViewDiffTitle:null,revisionsDiffButtonDialogCancelButton:"Close",revisionsDiffButtonDialogTitle:"View differences",revisionsDiffButtonTitle:"View differences",revisionsDiffButtonText:"View differences",revisionsLoading:"Loading revisions...",revisionsNone:"No revisions for this element",revisionsPreviewButtonTitle:"Preview",revisionsPreviewButtonText:"Preview",fileManagerDialogTitle:"File Manager",fileManagerTitle:"File Manager",rfmClose:"Close",rfmContinue:"Continue",rfmDeleteTitle:"Delete",rfmDownloadTitle:"Download",rfmEditTitle:"Edit",rfmFileActions:"Actions",rfmFileModificationTime:"Modified",rfmFileName:"Name",rfmFileSize:"Size",rfmFileType:"Type",rfmFilteredTotal:"Showing {{start}} to {{end}} of {{filteredTotal}} files",rfmFirst:"First",rfmHeadingDirectories:"Directories",rfmHeadingSearch:"Search",rfmHeadingTags:"Tags",rfmHeadingUpload:"Upload",rfmInsertTitle:"Insert",rfmLast:"Last",rfmRenameTitle:"Rename",rfmSearch:"Go",rfmTagDocument:"Document",rfmTagImage:"Image",rfmTotal:", filtered from {{total}}",rfmUpload:"Upload",rfmUploadBrowse:"Browse",rfmUploadDrop:"Drop Files Here",rfmUploadFileRemove:"Remove",rfmUploadOr:"or",rfmViewTitle:"View",imageEditorDialogCancelButton:"Cancel",imageEditorDialogOKButton:"Save",imageEditorDialogTitle:"Image Editor",imageEditorTitle:"Edit Image",rieApply:"Apply",rieBlurTitle:"Blur",rieBrightnessTitle:"Brightness/Contrast",rieCancel:"Cancel",rieCancelTitle:"Cancel",rieColorAdjustTitle:"Adjsut Color",rieCropTitle:"Crop",rieDesaturateTitle:"Desaturate",rieFlipHTitle:"Flip Horizontally",rieFlipVTitle:"Flip Vertically",rieGlowTitle:"Glow",rieHslTitle:"Hue, Saturation, Lightness.",rieInvertTitle:"Invert",riePosterizeTitle:"Posterize",rieRedoTitle:"Redo",rieRemoveNoiseTitle:"Remove Noise",rieResizeTitle:"Resize",rieRevertTitle:"Revert",rieRotateLeftTitle:"Rotate Left",rieRotateRightTitle:"Rotate Right",rieSaveTitle:"Save",rieSaveTitle:"Save",rieSepiaTitle:"Sepia",rieSharpenTitle:"Sharpen",rieSolarizeTitle:"Solarize",rieUndoTitle:"Undo",rieUploadTitle:"Upload",rieActionColorAdjustRed:"Red",rieActionColorAdjustGreen:"Green",rieActionColorAdjustBlue:"Blue",rieActionBrightnessBrightness:"Brightness",rieActionBrightnessContrast:"Contrast",rieActionGlowAmount:"Glow Amount",rieActionGlowRadius:"Glow Radius",rieActionHsl:"Hue",rieActionHsl:"Saturation",rieActionHsl:"Lightness",rieActionPosterize:"Levels",viewSourceDialogCancelButton:"Close",viewSourceDialogOKButton:"Apply source code",viewSourceDialogTitle:"Content source code",viewSourceTitle:"View/edit source code"});var po=["a","abbr","acronym","applet","b","basefont","bdo","big","br","button","cite","code","dfn","em","font","i","iframe","img","input","kbd","label","map","object","p","q","s","samp","select","small","span","strike","strong","sub","sup","textarea","tt","u","var","h1","h2","h3","h4","h5","h6"],ho=["article","nav","section","footer","blockquote","body","button","center","dd","div","fieldset","form","iframe","li","noframes","noscript","object","td","th"],uo=["body","center","dd","div","dt","fieldset","form","iframe","li","td","th"],go=["address","blockquote","body","button","center","dd","div","fieldset","form","iframe","li","noframes","noscript","object","td","th"],fo=!1,mo=jQuery;mo(function(){rangy.initialized||rangy.init(),mo.isFunction(rangy.rangePrototype.insertNodeAtEnd)||(rangy.rangePrototype.insertNodeAtEnd=function(t){var e=this.cloneRange();e.collapse(!1),e.insertNode(t),e.detach(),this.setEndAfter(t)})}),mo("html").click(function(){mo(".ui-editor-selectmenu-visible").removeClass("ui-editor-selectmenu-visible")});var bo,vo,yo,Co,wo;Object.create||(Object.create=function(t){function e(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e}),"undefined"==typeof Node&&(Node={TEXT_NODE:3}),"".trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")});var To={globalDefaults:{},defaults:{},enableHotkeys:!0,hotkeys:{},plugins:{},ui:{},layouts:{},presets:{},hoverPanels:{},instances:[],getInstances:function(){return this.instances},eachInstance:function(t){for(var e=0;e<this.instances.length;e++)t.call(this.instances[e],this.instances[e])},urlPrefix:"/raptor/",getTemplate:function(t,e){var i;if(this.templates[t])i=this.templates[t];else{var n=e||this.urlPrefix,o=t.split(".");n+=1===o.length?"templates/"+o[0]+".html":"plugins/"+o[0]+"/templates/"+o.splice(1).join("/")+".html",mo.ajax({url:n,type:"GET",async:!1,timeout:15e3,error:function(){i=null},success:function(t){i=t}}),this.templates[t]=i}return i},isDirty:function(){for(var t=this.getInstances(),e=0;e<t.length;e++)if(t[e].isDirty())return!0;return!1},unloadWarning:function(){for(var t=this.getInstances(),e=0;e<t.length;e++)if(t[e].isDirty()&&t[e].isEditing()&&t[e].options.unloadWarning)return a("navigateAway")},registerUi:function(t){this.ui[t.name]=t},registerLayout:function(t){this.layouts[t.name]=t},registerPlugin:function(t){this.plugins[t.name]=t},registerPreset:function(t,e){this.presets[t.name]=t,e&&(this.defaults=t)},persist:function(t,e,i){t=i?i+"."+t:t;try{if(localStorage){var n;if(n=localStorage.uiWidgetEditor?JSON.parse(localStorage.uiWidgetEditor):{},void 0===e)return n[t];n[t]=e,localStorage.uiWidgetEditor=JSON.stringify(n)}}catch(o){}return e}},ko=!1,Eo={_init:function(){if(!this.element.attr("data-raptor-initialised")){this.element.attr("data-raptor-initialised",!0),-1===mo.inArray(this,To.instances)&&To.instances.push(this);var t=this,e=this.persist("locale")||this.options.initialLocale;e&&(oo=e);var i=this.options;this.options=this.options.preset?mo.extend(!0,{},To.globalDefaults,To.presets[this.options.preset],this.options):mo.extend(!0,{},To.globalDefaults,To.defaults,this.options),i.layouts&&i.layouts.toolbar&&i.layouts.toolbar.uiOrder&&(this.options.layouts.toolbar.uiOrder=i.layouts.toolbar.uiOrder),this.element.attr("id")||this.element.attr("id",be()),this.ready=!1,this.events={},this.plugins={},this.layouts={},this.templates=mo.extend({},To.templates),this.target=this.element,this.layout=null,this.previewState=null,this.pausedState=null,this.pausedScrollX=null,this.pausedScrollY=null,this.enabled=!1,this.initialised=!1,this.uiObjects={},this.hotkeys={},this.hotkeysSuspended=!1,this.options.enableHotkeys&&this.registerHotkey(this.hotkeys);for(var n in this.options.bind)this.bind(n,this.options.bind[n]);this.history=[],this.present=0,this.historyEnabled=!0,Cn()&&(this.setOriginalHtml(this.element.is(":input")?this.element.val():this.element.html()),this.historyPush(this.getOriginalHtml()),this.element.is(":input")&&this.replaceOriginal(),this.loadPlugins(),this.dirty=!1,this.previousContent=null,this.previousSelection=null,this.getElement().addClass("raptor-editable-block"),this.loadLayouts(),this.ready=!0,this.fire("ready"),this.options.autoEnable&&mo(function(){t.enableEditing()}))}},attach:function(){this.bind("change",this.historyPush),this.getElement().on("click.raptor","img",function(t){vi(t.target),this.checkSelectionChange()}.bind(this)),this.getElement().on("focus.raptor",this.showLayout.bind(this)),this.target.on("mouseup.raptor",this.checkSelectionChange.bind(this)),this.target.on("input.raptor",this.checkChange.bind(this)),mo(window).bind("beforeunload",To.unloadWarning.bind(To));var t=this;mo(window).resize(function(){t.fire("resize")})},detach:function(){this.unbind("change"),this.getElement().off("click.raptor","img"),this.getElement().off("focus.raptor"),this.getElement().blur(),this.target.off("mouseup.raptor"),this.target.off("keyup.raptor")},localeChange:function(){if(!this.ready){var t;return t=function(){this.unbind("ready",t),this.localeChange()},this.bind("ready",t),void 0}this.actionPreviewRestore();var e=[];for(var i in this.layouts)this.layouts[i].isVisible()&&e.push(i);this.layoutsDestruct(),this.events={},this.plugins={},this.uiObjects={},this.hotkeys={},this.loadPlugins(),this.loadLayouts();for(var n=0;n<e.length;n++)this.layouts[e[n]].show();this.checkSelectionChange()},restoreFocus:function(){this.getElement().focus()},getElement:function(){return this.target},getNode:function(){return this.target[0]},getOriginalElement:function(){return this.element},replaceOriginal:function(){if(this.target.is(":input")){for(var t=mo("<div/>").html(this.element.val()).insertBefore(this.element).attr("id",be()).addClass(this.element.attr("class")).addClass(this.options.classes),e=ce(this.element),i=0;i<this.options.replaceStyle.length;i++)t.css(this.options.replaceStyle[i],e[this.options.replaceStyle[i]]);this.element.hide(),this.bind("change",function(){this.getOriginalElement().is(":input")?this.getOriginalElement().val(this.getHtml()).trigger("input"):this.getOriginalElement().html(this.getHtml())}),this.target=t}},checkSelectionChange:function(){var t=rangy.serializeSelection(null,!1);this.previousSelection!==t&&this.fire("selectionChange"),this.previousSelection=t},checkChange:function(){var t=this.getHtml(),e=this.dirty;this.dirty=this.originalHtml!==t,this.previousHtml!==t&&(this.previousHtml=t,this.fire("change",[t]),e!==this.dirty&&(this.dirty?this.fire("dirty"):this.fire("cleaned")),this.checkSelectionChange())},change:function(){this.fire("change",[this.getHtml()])},destruct:function(){this.disableEditing(),this.fire("destroy"),this.events={},this.getElement().off(".raptor"),this.getOriginalElement().is(":input")&&(this.target.remove(),this.target=null,this.element.show()),this.layoutsDestruct()},actionPreview:function(t){this.actionPreviewRestore();try{var e=this.fire("selectionCustomise");e.length>0?this.previewState=M(this.previewState,this.target,function(){for(var i=0,n=e.length;n>i;i++)rangy.getSelection().setSingleRange(e[i]),this.selectionConstrain(),t()}.bind(this)):(this.selectionConstrain(),this.previewState=M(this.previewState,this.target,t)),this.checkSelectionChange()}catch(i){}},actionPreviewRestore:function(){this.previewState&&(this.target=H(this.previewState,this.target),this.previewState=null,this.checkSelectionChange())},actionApply:function(t){this.actionPreviewRestore();var e=this.stateSave();try{var i=this.fire("selectionCustomise");i.length>0?L(function(){for(var e=0,n=i.length;n>e;e++)rangy.getSelection().setSingleRange(i[e]),this.selectionConstrain(),L(t,this.history)}.bind(this),this.history):(this.selectionConstrain(),L(t,this.history)),this.checkChange()}catch(n){this.stateRestore(e)}},actionUndo:function(){},actionRedo:function(){},stateSave:function(){return this.selectionConstrain(),Ji(this.target)},stateRestore:function(t){var e=$i(this.target,t),i=rangy.getSelection();this.target=e.element,null!==e.ranges&&(i.setRanges(e.ranges),i.refresh())},selectionConstrain:function(){ji(this.target[0])},pause:function(){this.pausedState||(this.pausedState=this.stateSave(),this.suspendHotkeys(),this.pausedScrollX=window.scrollX,this.pausedScrollY=window.scrollY)},resume:function(){this.pausedState&&(this.stateRestore(this.pausedState),this.pausedState=null,this.resumeHotkeys(),this.restoreFocus(),window.scrollTo(this.pausedScrollX,this.pausedScrollY))},persist:function(t,e){return this.options.persistence?To.persist(t,e,this.options.namespace):null},enableEditing:function(){if(!this.enabled){if(this.fire("enabling"),this.attach(),this.enabled=!0,this.getElement().addClass(this.options.baseClass+"-editing").addClass(this.options.classes),this.options.partialEdit?this.getElement().find(this.options.partialEdit).prop("contenteditable",!0):this.getElement().prop("contenteditable",!0),!this.initialised){this.initialised=!0;for(var t in this.plugins)this.plugins[t].enable();this.bindHotkeys(),this.getElement().closest("form").on("submit.raptor",function(){K(this.getElement()),this.fire("change",[this.getHtml()])}.bind(this))}K(this.getElement()),this.fire("enabled"),this.showLayout();var e=this.options.partialEdit?this.getElement().find("[contenteditable]")[0]:this.getNode();switch(this.options.autoSelect){case"all":bi(e);break;case"start":var i=mo(e).find("*:first")[0];if(!i){bi(e);break}var n=rangy.createRange();n.setStartBefore(i),n.setEndBefore(i),fi(n);break;case"end":var i=mo(e).find("*:last")[0];if(!i){bi(e);break}bi(i);var n=rangy.createRange();n.setStartAfter(i),n.setEndAfter(i),fi(n)}}},disableEditing:function(){this.enabled&&(this.detach(),this.enabled=!1,this.getElement().prop("contenteditable",!1).removeClass(this.options.baseClass+"-editing").removeClass(this.options.classes),rangy.getSelection().removeAllRanges(),this.fire("disabled"),this.options.reloadOnDisable&&!ko&&(ko=!0,window.location.reload()))},cancelEditing:function(){this.unify(function(t){t.stopEditing()})},stopEditing:function(){this.fire("cancel"),this.options.reloadOnDisable||this.resetHtml(),this.disableEditing(),this.dirty=!1,ui()},isEditing:function(){return this.enabled},isRoot:function(t){return this.getElement()[0]===mo(t)[0]},unify:function(t,e){if(e!==!1&&t(this),this.options.unify){var i=this;To.eachInstance(function(e){e!==i&&e.options.unify&&t(e)})}},getLayout:function(t){return this.layouts[t]},loadLayouts:function(){for(var t in this.options.layouts)"undefined"!=typeof To.layouts[t]&&(this.layouts[t]=this.prepareComponent(To.layouts[t],this.options.layouts[t],"layout").instance,this.layouts[t].hotkeys&&this.registerHotkey(this.layouts[t].hotkeys,null,this.layouts[t]))},layoutsDestruct:function(){for(var t in this.layouts)this.layouts[t].destruct()},prepareComponent:function(t,e,i){var n=mo.extend({},t),o=mo.extend({},this.options,{baseClass:this.options.baseClass+"-"+i+"-"+h(t.name)},n.options,e);n.raptor=this,n.options=o;var a=n.init();return{init:a,instance:n}},showLayout:function(){this.unify(function(t){t.fire("layoutHide")},!1),this.fire("layoutShow"),this.fire("resize"),"undefined"==typeof this.getElement().attr("tabindex")&&this.getElement().attr("tabindex",-1)},getTemplate:function(t,e){return this.templates[t]||(this.templates[t]=u(t,this.options.urlPrefix)),d(this.templates[t],e)},historyPush:function(){if(this.historyEnabled){var t=this.getHtml();t!==this.historyPeek()&&(this.present!==this.history.length-1&&(this.history=this.history.splice(0,this.present+1)),this.history.push(this.getHtml()),this.present=this.history.length-1,this.fire("historyChange"))}},historyPeek:function(){return this.history.length?this.history[this.present]:null},historyBack:function(){this.present>0&&(this.present--,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},historyForward:function(){this.present<this.history.length-1&&(this.present++,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},registerHotkey:function(t,e){this.hotkeys[t]=e},bindHotkeys:function(){for(var t in this.hotkeys)this.getElement().on("keydown.raptor",t,function(t){if(this.isEditing()&&!this.hotkeysSuspended){var e=this.hotkeys[t.data]();e!==!1&&t.preventDefault()}}.bind(this))},suspendHotkeys:function(){this.hotkeysSuspended=!0},resumeHotkeys:function(){this.hotkeysSuspended=!1},isUiEnabled:function(t){return this.options.enableUi===!1&&"undefined"==typeof this.options.plugins[t]||this.options.plugins[t]===!1?!1:-1!==mo.inArray(t,this.options.disabledUi)||-1!==mo.inArray(t,this.options.disabledPlugins)?!1:!0},getUi:function(t){return this.uiObjects[t]},getPlugin:function(t){return this.uiObjects[t]||this.plugins[t]},loadPlugins:function(){var t=this;this.options.plugins||(this.options.plugins={});for(var e in To.plugins)this.options.enablePlugins===!1&&"undefined"==typeof this.options.plugins[e]||this.options.plugins[e]===!1||-1===mo.inArray(e,this.options.disabledUi)&&-1===mo.inArray(e,this.options.disabledPlugins)&&(t.plugins[e]=this.prepareComponent(To.plugins[e],t.options.plugins[e],"plugin").instance)},isDirty:function(){return this.dirty},getHtml:function(){return this.getElement().html()},clean:function(){this.actionApply(function(){K(this.getElement())}.bind(this))},setHtml:function(t){this.getElement().html(t),this.fire("html"),this.checkChange()},resetHtml:function(){this.setHtml(this.getOriginalHtml()),this.fire("cleaned")},getOriginalHtml:function(){return this.originalHtml},saved:function(t){this.setOriginalHtml(this.getHtml()),this.dirty=!1,this.fire("saved",t),this.fire("cleaned")},setOriginalHtml:function(t){this.originalHtml=t},bind:function(t,e,i){if("undefined"!=typeof e&&mo.isFunction(e))for(var n=t.split(/,\s*/),o=0,a=n.length;a>o;o++)this.events[n[o]]||(this.events[n[o]]=[]),this.events[n[o]].push({context:i,callback:e})},unbind:function(t,e,i){for(var n=0,o=this.events[t].length;o>n;n++)this.events[t][n]&&this.events[t][n].callback===e&&this.events[t][n].context===i&&this.events[t].splice(n,1)},fire:function(t,e){var i=[];if(this.events[t])for(var n=0,o=this.events[t].length;o>n;n++){var a=this.events[t][n];if("undefined"!=typeof a&&"undefined"!=typeof a.callback){var s=a.callback.apply(a.context||this,e);"undefined"!=typeof s&&(i=i.concat(s))}}return i}};mo.widget("ui.raptor",Eo),mo.fn.raptor.Raptor=To,wn.prototype.init=function(){},wn.prototype.destruct=function(){},wn.prototype.isVisible=function(){return!1},wn.prototype.show=function(){},wn.prototype.hide=function(){},Tn.prototype.init=function(){},Tn.prototype.enable=function(){},kn.prototype.appendTo=function(t,e){for(var i=0,n=this.uiOrder.length;n>i;i++){for(var o=mo("<div/>").addClass(this.raptor.options.baseClass+"-layout-toolbar-group"),a=this.uiOrder[i],s=0,r=a.length;r>s;s++)if(this.raptor.isUiEnabled(a[s])&&To.ui[a[s]]){var l=this.raptor.options.plugins[a[s]];if(l===!1)continue;var c=this.raptor.prepareComponent(To.ui[a[s]],l,"ui");c.instance.layout=t,this.raptor.uiObjects[a[s]]=c.instance,C(c.init)&&(c.init.removeClass("ui-corner-all"),o.append(c.init))}o.children().length>0&&o.appendTo(e)}e.find(".ui-button:first-child").addClass("ui-corner-left"),e.find(".ui-button:last-child").addClass("ui-corner-right")},En.prototype=Object.create(wn.prototype),En.prototype.init=function(){this.raptor.bind("enabled",this.show.bind(this)),this.raptor.bind("disabled",this.hide.bind(this)),this.raptor.bind("layoutShow",this.show.bind(this)),this.raptor.bind("layoutHide",this.hide.bind(this)),mo(window).resize(this.constrainPosition.bind(this))},En.prototype.destruct=function(){this.wrapper&&(this.wrapper.remove(),this.wrapper=null),this.raptor.fire("toolbarDestroy")},En.prototype.show=function(){this.isVisible()||(this.getElement().css("display",""),this.constrainPosition(),this.raptor.fire("toolbarShow"))},En.prototype.hide=function(){this.isReady()&&(this.getElement().css("display","none"),this.raptor.fire("toolbarHide"))},En.prototype.initDragging=function(){if(mo.fn.draggable&&this.options.draggable&&!this.getElement().data("ui-draggable")){this.getElement().draggable({cancel:"a, button",cursor:"move",stop:this.constrainPosition.bind(this)}),this.getElement().css("position","fixed");var t=this.raptor.persist("position")||this.options.dialogPosition;t||(t=[10,10]),parseInt(t[0],10)+this.getElement().outerHeight()>mo(window).height()&&(t[0]=mo(window).height()-this.getElement().outerHeight()),parseInt(t[1],10)+this.getElement().outerWidth()>mo(window).width()&&(t[1]=mo(window).width()-this.getElement().outerWidth()),this.getElement().css({top:Math.abs(parseInt(t[0],10)),left:Math.abs(parseInt(t[1],10))})}},En.prototype.enableDragging=function(){mo.fn.draggable&&this.options.draggable&&this.getElement().data("ui-draggable")&&this.getElement().draggable("enable")},En.prototype.disableDragging=function(){mo.fn.draggable&&this.options.draggable&&this.getElement().is(".ui-draggable")&&this.getElement().draggable("disable").removeClass("ui-state-disabled")},En.prototype.isReady=function(){return null!==this.wrapper},En.prototype.isVisible=function(){return this.isReady()&&this.getElement().is(":visible")},En.prototype.constrainPosition=function(){if(this.isVisible()){var t=parseInt(this.wrapper.css("left"))||-999,e=parseInt(this.wrapper.css("top"))||-999,i=this.wrapper.outerWidth(),n=this.wrapper.outerHeight(),o=mo(window).width(),a=mo(window).height(),s=Math.max(0,Math.min(t,o-i)),r=Math.max(0,Math.min(e,a-n));(s!==t||r!==e)&&this.wrapper.css({left:s,top:r}),this.raptor.persist("position",[this.wrapper.css("top"),this.wrapper.css("left")])}},En.prototype.getElement=function(){if(null===this.wrapper){if(!this.options.uiOrder){this.options.uiOrder=[[]];for(var t in To.ui)this.options.uiOrder[0].push(t)}var e=this.toolbar=mo("<div/>").addClass(this.options.baseClass+"-toolbar"),i=this.toolbarWrapper=mo("<div/>").addClass(this.options.baseClass+"-inner").addClass("ui-widget-content").mousedown(function(t){t.preventDefault()}).append(e),n=this.path=mo("<div/>").addClass(this.options.baseClass+"-path").addClass("ui-widget-header"),o=this.wrapper=mo("<div/>").addClass(this.options.baseClass+"-outer "+this.raptor.options.baseClass+"-layout").css("display","none").append(n).append(i),a=new kn(this.raptor,this.options.uiOrder);a.appendTo(this,this.toolbar),mo("<div/>").css("clear","both").appendTo(this.toolbar),mo(function(){o.appendTo("body"),this.initDragging(),this.constrainPosition(!0),this.raptor.fire("layoutReady",[this.wrapper]),this.raptor.fire("toolbarReady",[this])}.bind(this))}return this.wrapper},To.registerLayout(new En),Sn.prototype=Object.create(wn.prototype),Sn.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this)),this.raptor.bind("enabled",this.enabled.bind(this))},Sn.prototype.ready=function(){this.raptor.getElement().mouseenter(this.show.bind(this)).mouseleave(this.hide.bind(this))},Sn.prototype.enabled=function(){this.getElement().hide()},Sn.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=mo("<div/>").addClass(this.raptor.options.baseClass+"-layout "+this.options.baseClass).mouseleave(this.hide.bind(this));var t=new kn(this.raptor,this.options.uiOrder);t.appendTo(this,this.hoverPanel),mo(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},Sn.prototype.show=function(){this.raptor.isEditing()||(this.visible=!0,this.getElement().show(),this.position(),this.raptor.getElement().addClass(this.raptor.options.baseClass+"-editable-block-hover"))},Sn.prototype.hide=function(t){this.visible&&t&&(mo.contains(this.getElement().get(0),t.relatedTarget)||t.relatedTarget!==this.getElement().get(0)&&this.getElement().get(0)!==mo(t.relatedTarget).parent().get(0)&&(mo.contains(this.raptor.getElement().get(0),t.relatedTarget)||t.relatedTarget!==this.raptor.getElement().get(0)&&(this.visible=!1,this.getElement().hide(),this.raptor.getElement().removeClass(this.raptor.options.baseClass+"-editable-block-hover"))))
},Sn.prototype.position=function(){if(this.visible){var t=re(this.raptor.getElement());this.getElement().css({top:t.top+(t.height/2-this.getElement().outerHeight()/2),left:t.left+(t.width/2-this.getElement().outerWidth()/2)})}},Sn.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},To.registerLayout(new Sn),xn.prototype=Object.create(wn.prototype),xn.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this))},xn.prototype.ready=function(){this.raptor.getElement().on("mouseenter",this.options.elements,this.show.bind(this)).on("mouseleave",this.options.elements,this.hide.bind(this))},xn.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=mo("<div/>").addClass(this.raptor.options.baseClass+"-layout raptor-layout-hover-panel "+this.options.baseClass).mouseleave(this.hide.bind(this));var t=new kn(this.raptor,this.options.uiOrder);t.appendTo(this,this.hoverPanel),mo(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},xn.prototype.show=function(t){this.enabled&&this.raptor.isEditing()&&(this.target=t.target,this.visible=!0,ye(this.getElement().show(),mo(this.target)))},xn.prototype.hide=function(t){if(this.visible){if(t){if(mo.contains(this.getElement().get(0),t.relatedTarget))return;if(t.relatedTarget===this.getElement().get(0))return;if(this.getElement().get(0)===mo(t.relatedTarget).parent().get(0))return;if(mo.contains(this.raptor.getElement().get(0),t.relatedTarget))return;if(t.relatedTarget===this.raptor.getElement().get(0))return}this.visible=!1,this.getElement().hide()}},xn.prototype.close=function(){this.visible&&(this.enabled=!1,this.visible=!1,this.getElement().hide(),setTimeout(function(){this.enabled=!0}.bind(this),1e3))},xn.prototype.position=function(){this.visible&&ye(this.getElement(),mo(this.target))},xn.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},To.registerLayout(new xn),Dn.prototype.init=function(){if("string"==typeof this.hotkey)this.raptor.registerHotkey(this.hotkey,this.action.bind(this));else if(b(this.hotkey))for(var t=0,e=this.hotkey.length;e>t;t++)this.raptor.registerHotkey(this.hotkey[t],this.action.bind(this));return this.getButton()},Dn.prototype.getButton=function(){if(!this.button){var t=this.text||this.translate("Text",!1);this.button=mo("<div>").html(t).addClass(this.options.baseClass).attr("title",this.getTitle()).click(this.click.bind(this)),w(this.button,{icons:{primary:this.getIcon()},text:t,label:this.label})}return this.button},Dn.prototype.getTitle=function(){return this.title||this.translate("Title")},Dn.prototype.getIcon=function(){return null===this.icon?"ui-icon-"+Zi(this.name):this.icon},Dn.prototype.click=function(){S(this.button)&&this.raptor.actionApply(this.action.bind(this))},Dn.prototype.translate=function(t,e){return a(this.name+t,e)},Rn.prototype=Object.create(Dn.prototype),Rn.prototype.init=function(){return this.preview="undefined"==typeof this.options.preview?!0:!1,Dn.prototype.init.apply(this,arguments)},Rn.prototype.getButton=function(){return this.button||(this.button=Dn.prototype.getButton.call(this).mouseenter(this.mouseEnter.bind(this)).mouseleave(this.mouseLeave.bind(this))),this.button},Rn.prototype.mouseEnter=function(){this.canPreview()&&(this.previewing=!0,this.raptor.actionPreview(this.action.bind(this)))},Rn.prototype.mouseLeave=function(){this.previewing=!1,this.raptor.actionPreviewRestore()},Rn.prototype.click=function(){return this.previewing=!1,this.raptor.actionPreviewRestore(),Dn.prototype.click.apply(this,arguments)},Rn.prototype.canPreview=function(){return this.preview},Rn.prototype.isPreviewing=function(){return this.previewing},Pn.prototype=Object.create(Dn.prototype),Pn.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),Dn.prototype.init.apply(this,arguments)},Pn.prototype.selectionChange=function(){this.selectionToggle()?(D(this.button),this.disable&&E(this.button)):(R(this.button),this.disable&&x(this.button))},An.prototype=Object.create(Rn.prototype),An.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),Rn.prototype.init.apply(this,arguments)},An.prototype.selectionChange=function(){this.selectionToggle()?this.isPreviewing()||D(this.button):R(this.button)},Nn.prototype=Object.create(Rn.prototype),Nn.prototype.init=function(){var t=Rn.prototype.init.apply(this,arguments);return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),t},Nn.prototype.selectionChange=function(){this.isEnabled()?E(this.button):x(this.button)},Nn.prototype.canPreview=function(){return Rn.prototype.canPreview.call(this)&&this.isEnabled()},Nn.prototype.isEnabled=function(){var t=ci();return t?!!this.getElement(t):!!this.previewing},Nn.prototype.action=function(){gi(function(t){var e=this.getElement(t);e&&this.applyToElement(e)}.bind(this))},Bn.prototype=Object.create(An.prototype),Bn.prototype.action=function(){Gi(),this.raptor.selectionConstrain();for(var t=0,e=this.classes.length;e>t;t++){var i=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[t],{elementTagName:this.tag||"span"});i.toggleSelection()}},Bn.prototype.selectionToggle=function(){for(var t=0,e=this.classes.length;e>t;t++){var i=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[t],{elementTagName:this.tag||"span"});if(!i.isAppliedToSelection())return!1}return!0};var So={};In.prototype=Object.create(Dn.prototype),In.prototype.action=function(){this.openDialog()},In.prototype.validateDialog=function(){return!0},In.prototype.openDialog=function(){this.raptor.pause(),N(this.getDialog())},In.prototype.onDialogClose=function(){So[this.name].instance.raptor.resume()},In.prototype.okButtonClick=function(){var t=So[this.name].instance.validateDialog();t===!0&&(B(So[this.name].dialog),So[this.name].instance.applyAction.call(So[this.name].instance,So[this.name].dialog))},In.prototype.closeDialog=function(){B(So[this.name].dialog)},In.prototype.cancelButtonClick=In.prototype.closeDialog,In.prototype.getOkButton=function(t){return{text:a(t+"DialogOKButton"),click:this.okButtonClick.bind(this),icons:{primary:"ui-icon-circle-check"}}},In.prototype.getCancelButton=function(t){return{text:a(t+"DialogCancelButton"),click:this.cancelButtonClick.bind(this),icons:{primary:"ui-icon-circle-close"}}},In.prototype.getDefaultDialogOptions=function(t){var e={modal:!0,resizable:!0,autoOpen:!1,title:a(t+"DialogTitle"),dialogClass:this.options.baseClass+"-dialog "+this.options.dialogClass,close:this.onDialogClose.bind(this),buttons:[]},i=this.getOkButton(t),n=this.getCancelButton(t);return"undefined"!=typeof i&&i!==!1&&e.buttons.push(i),"undefined"!=typeof n&&n!==!1&&e.buttons.push(n),e},In.prototype.getDialog=function(){return"undefined"==typeof So[this.name]&&(So[this.name]={dialog:mo(this.getDialogTemplate())},A(So[this.name].dialog,mo.extend(this.getDefaultDialogOptions(this.name),this.dialogOptions))),So[this.name].instance=this,So[this.name].dialog},On.prototype=Object.create(In.prototype),On.prototype.init=Pn.prototype.init,On.prototype.selectionChange=Pn.prototype.selectionChange,Mn.prototype=Object.create(Dn.prototype),Mn.prototype.click=function(t){this.menu.getMenu().is(":visible")?mo(".raptor-menu").hide():this.menu.show(),t.preventDefault()},Hn.prototype.init=function(){this.setOptions();var t=this.getButton().init();return t.addClass("raptor-menu-button"),t},Hn.prototype.getButton=function(){return this.button||(this.button=new Mn(this)),this.button},Hn.prototype.setOptions=function(){this.options.title=a(this.name+"Title"),this.options.icon="ui-icon-"+this.name},Hn.prototype.getMenu=function(){return this.menu||(this.menu=mo("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().mousedown(function(t){t.preventDefault()}).children().appendTo("body")),this.menu},Hn.prototype.show=function(){mo(".raptor-menu").hide(),ge(this.getMenu().toggle(),this.getButton().getButton())},mo("html").click(function(t){mo(t.target).hasClass("raptor-menu-button")||0!==mo(t.target).closest(".raptor-menu-button").length||mo(".raptor-menu").hide()}),Hn.prototype.getMenu=function(){return this.menu||(this.menu=mo("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().appendTo("body").mousedown(function(t){t.preventDefault()})),this.menu},Ln.prototype=Object.create(Hn.prototype),Ln.prototype.menuItemMouseDown=function(t){t.preventDefault()},Ln.prototype.menuItemClick=function(t){return T(this.button.button,mo(t.target).html()),mo(this.menu).closest("ul").hide(),!1},Ln.prototype.menuItemMouseEnter=function(){},Ln.prototype.menuItemMouseLeave=function(){},Ln.prototype.getMenu=function(){return this.menu||(this.menu=mo("<ul>").addClass(this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.getMenuItems()).css("position","fixed").hide().find("a").mousedown(this.menuItemMouseDown.bind(this)).mouseenter(this.menuItemMouseEnter.bind(this)).mouseleave(this.menuItemMouseLeave.bind(this)).click(this.menuItemClick.bind(this)).end().appendTo("body"),P(this.menu)),this.menu},mo.extend(To,{Button:Dn,CSSClassApplierButton:Bn,DialogButton:In,DialogToggleButton:On,FilteredPreviewButton:Nn,HoverPanelLayout:Sn,Menu:Hn,MenuButton:Mn,PreviewButton:Rn,PreviewToggleButton:An,RaptorLayout:wn,RaptorPlugin:Tn,SelectMenu:Ln,TextAlignButton:to,ToggleButton:Pn,ToolbarLayout:En,UiGroup:kn,aButton:w,aButtonActive:D,aButtonDisable:x,aButtonEnable:E,aButtonInactive:R,aButtonIsEnabled:S,aButtonSetIcon:k,aButtonSetLabel:T,aDialog:A,aDialogClose:B,aDialogOpen:N,aMenu:P,aTabs:I,actionApply:L,actionPreview:M,actionPreviewRestore:H,actionRedo:F,actionUndo:U,clean:K,cleanEmptyAttributes:W,cleanEmptyElements:q,cleanRemoveComments:G,cleanReplaceElements:j,cleanUnnestElement:X,cleanUnwrapElements:z,cleanWrapTextNodes:V,dockToElement:J,dockToScreen:_,elementBringToTop:Z,elementChangeTag:ve,elementClosestBlock:me,elementContainsBlockElement:ne,elementDefaultDisplay:oe,elementDetachedManip:fe,elementFirstInvalidElementOfValidParent:se,elementGetAttributes:le,elementGetStyles:ce,elementIsBlock:ie,elementIsEmpty:de,elementIsValid:ae,elementOuterHtml:te,elementOuterText:ee,elementPositionUnder:ge,elementRemoveAttributes:Y,elementSwapStyles:ue,elementToggleStyle:he,elementUniqueId:be,elementVisibleRect:re,elementWrapInner:pe,extendLocale:e,fragmentInsertBefore:we,fragmentToHtml:Ce,getLocalizedString:o,listBreakAtSelection:Ue,listBreakByReplacingSelection:Le,listConvertItemsForList:Re,listConvertListItem:Pe,listConvertListType:He,listEnforceValidChildren:xe,listRemoveEmpty:Ie,listRemoveEmptyItems:Be,listShouldConvertType:Ee,listShouldUnwrap:ke,listShouldWrap:Se,listTidyModified:Ne,listToggle:Te,listUnwrap:Ae,listUnwrapSelectedListItems:Oe,listUnwrapSelection:Me,listWrapSelection:De,nodeFindParent:Fe,nodeFindTextNodes:je,nodeIsChildOf:ze,persistGet:Ge,persistSet:We,rangeContainsNode:ei,rangeContainsNodeText:ii,rangeDeserialize:ai,rangeEmptyTag:Qe,rangeExpandTo:Ke,rangeExpandToParent:qe,rangeGet:ci,rangeGetCommonAncestor:Ye,rangeGetEndElement:$e,rangeGetStartElement:Je,rangeIsContainedBy:ti,rangeIsEmpty:Ze,rangeReplace:_e,rangeReplaceSplitInvalidTags:si,rangeReplaceWithinValidTags:ri,rangeSelectElement:Ve,rangeSelectElementContent:Xe,rangeSerialize:oi,rangeToHtml:li,rangeTrim:ni,registerLocale:t,selectionAtEndOfElement:Ri,selectionAtStartOfElement:Pi,selectionChangeTags:Ki,selectionClearFormatting:zi,selectionConstrain:ji,selectionContains:_i,selectionDelete:Qi,selectionDestroy:ui,selectionEachBlock:Ui,selectionEachRange:gi,selectionExists:Ii,selectionExpandTo:qi,selectionExpandToWord:Gi,selectionFindWrappingAndInnerElements:Xi,selectionGetElement:Ei,selectionGetElements:Si,selectionGetEndElement:Di,selectionGetHtml:ki,selectionGetStartElement:xi,selectionInverseWrapWithTagClass:Wi,selectionIsEmpty:Ai,selectionRange:Oi,selectionReplace:mi,selectionReplaceSplittingSelectedElement:Mi,selectionReplaceWithinValidTags:Hi,selectionRestore:hi,selectionSave:pi,selectionSaved:di,selectionSelectEdge:yi,selectionSelectEnd:Ci,selectionSelectInner:bi,selectionSelectOuter:vi,selectionSelectStart:wi,selectionSelectToEndOfElement:Ti,selectionSet:fi,selectionToggleBlockClasses:Fi,selectionToggleBlockStyle:Li,selectionToggleWrapper:Ni,selectionTrim:Vi,selectionWrapTagWithAttribute:Bi,setLocale:n,stateRestore:$i,stateSave:Ji,stringCamelCaseConvert:Zi,stringHtmlStringIsEmpty:tn,stringStripTags:Yi,styleRestoreState:on,styleSwapState:en,styleSwapWithWrapper:nn,tableCanMergeCells:dn,tableCanSplitCells:fn,tableCellsInRange:un,tableCreate:an,tableDeleteColumn:rn,tableDeleteRow:cn,tableGetCellByIndex:hn,tableGetCellIndex:pn,tableInsertColumn:sn,tableInsertRow:ln,tableMergeCells:gn,tableSplitCells:mn,templateConvertTokens:d,templateGet:u,templateGetVariables:g,typeIsArray:b,typeIsElement:C,typeIsNode:v,typeIsNumber:f,typeIsRange:vn,typeIsSelection:yn,typeIsString:m,typeIsTextNode:y,undockFromElement:$,undockFromScreen:Q}),window.Raptor=To,To.globalDefaults={layouts:{},plugins:{},ui:{},bind:{},namespace:null,unify:!0,persistence:!0,persistenceName:"uiEditor",unloadWarning:!0,autoEnable:!1,partialEdit:!1,autoSelect:"end",enablePlugins:!0,disabledPlugins:[],enableUi:!0,disabledUi:[],replace:!1,replaceStyle:["display","position","float","width","padding-left","padding-right","padding-top","padding-bottom","margin-left","margin-right","margin-top","margin-bottom"],baseClass:"raptor",cssPrefix:"cms-",draggable:!0},To.registerPreset({name:"full",plugins:{imageSwap:{chooser:"insertFile"}},layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement","guides"],["viewSource"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease","fontFamilyMenu"],["clearFormatting","cleanBlock"],["linkCreate","linkRemove"],["embed","insertFile"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit"]]},elementHoverPanel:{elements:"img",uiOrder:[["imageResize","imageSwap","close"]]}}},!0),To.registerPreset({name:"micro",layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement"],["historyUndo","historyRedo"],["specialCharacters"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit","revisions"]]}},plugins:{placeholder:!1,paste:{panels:["plain-text"]},noBreak:{enabled:!0}}}),To.registerPreset({name:"inline",classes:"raptor-editing-inline",autoEnable:!0,draggable:!1,unify:!1,unloadWarning:!1,reloadOnDisable:!0,plugins:{unsavedEditWarning:!1,dock:{dockToElement:!0,docked:!0,persist:!1}},layouts:{toolbar:{uiOrder:[["textBold","textItalic","textUnderline","textStrike"],["colorMenuBasic"],["textBlockQuote"],["listOrdered","listUnordered"],["textSizeDecrease","textSizeIncrease"],["linkCreate","linkRemove"]]}}}),To.registerPreset({name:"mammoth",plugins:{imageSwap:{chooser:"fileManager"}},layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","guides"],["viewSource"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease"],["clearFormatting","cleanBlock"],["linkCreate","linkRemove"],["embed","fileManager"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters","loremIpsum"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"]]},hoverPanel:{uiOrder:[["clickButtonToEdit","revisions"]]},elementHoverPanel:{elements:"img",uiOrder:[["imageResize","imageSwap","imageEditor","close"]]},imageEditor:{uiOrder:[["save","cancel"],["revert","upload"],["undo","redo"],["flipV","flipH","rotateLeft","rotateRight","resize","crop"]]},fileManager:{uiOrder:[["insert","rename","edit","delete","download","view"]]}}},!0),To.registerPreset({name:"mammoth-inline",classes:"raptor-editing-inline",autoEnable:!0,draggable:!1,unify:!1,unloadWarning:!1,reloadOnDisable:!0,plugins:{unsavedEditWarning:!1,dock:{dockToElement:!0,docked:!0,persist:!1}},layouts:{toolbar:{uiOrder:[["viewSource","guides"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease"],["clearFormatting","cleanBlock"],["linkCreate","linkRemove"],["embed","fileManager"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"]]}}}),To.registerUi(new In({name:"cancel",hotkey:"esc",dialogOptions:{width:500},action:function(){this.raptor.isDirty()?In.prototype.action.call(this):this.applyAction()},applyAction:function(){this.raptor.cancelEditing()},getDialogTemplate:function(){return mo("<div>").html(a("cancelDialogContent"))}})),Un.prototype=Object.create(Ln.prototype),Un.prototype.init=function(){var t=Ln.prototype.init.call(this);return"object"==typeof this.options.classes&&Object.keys(this.options.classes).length>0?(this.raptor.bind("selectionChange",this.updateButton.bind(this)),t):void 0},Un.prototype.changeClass=function(t){Fi(t,[],this.raptor.getElement())},Un.prototype.menuItemClick=function(t){Ln.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeClass([mo(t.currentTarget).data("value")])}.bind(this))},Un.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.changeClass([mo(t.currentTarget).data("value")])}.bind(this))},Un.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Un.prototype.updateButton=function(){},Un.prototype.getMenuItems=function(){var t="";for(var e in this.options.classes)t+=this.raptor.getTemplate("class-menu.item",{label:e,value:this.options.classes[e]});return t},To.registerUi(new Un),To.registerUi(new Rn({name:"cleanBlock",action:function(){this.raptor.getElement().find("[style]").removeAttr("style"),this.raptor.getElement().find("span:empty").remove()}})),To.registerUi(new Rn({name:"clearFormatting",action:function(){zi(this.raptor.getElement().get(0)),q(this.raptor.getElement(),["a","b","i","sub","sup","strong","em","big","small","p"]),V(this.raptor.getElement()[0],"p")}})),To.registerUi(new Dn({name:"clickButtonToEdit",action:function(){this.raptor.enableEditing()}})),To.registerUi(new Dn({name:"close",click:function(){this.layout.close()}})),Fn.prototype=Object.create(Ln.prototype),Fn.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),this.updateButton(),Ln.prototype.init.apply(this,arguments)},Fn.prototype.updateButton=function(){var t=Si()[0],e=this.getButton().getButton(),i=null,n=null;if(T(e,a("colorMenuBasicAutomatic")),k(e,!1),t){t=mo(t);for(var o=0;o<this.colors.length;o++)if(n=mo(t).closest("."+this.options.cssPrefix+this.colors[o]),n.length){i=this.colors[o];break}return i?(T(e,a("colorMenuBasic"+(i.charAt(0).toUpperCase()+i.slice(1)))),k(e,"ui-icon-swatch"),e.find(".ui-icon").css("background-color",n.css("color")),void 0):void 0}},Fn.prototype.changeColor=function(t,e){e&&(this.currentColor=t),this.raptor.actionApply(function(){if(Gi(),"automatic"===t)Si().parents("."+this.options.cssPrefix+"color").addBack().each(function(){var t=mo(this).attr("class");if(null!==t&&"undefined"!=typeof t&&(t=t.match(/(cms-(.*?))( |$)/gi),null!==t&&"undefined"!=typeof t))for(var e=0,i=t.length;i>e;e++)mo(this).removeClass(mo.trim(t[e]))});else{var e=be();Ni("span",{classes:this.options.cssPrefix+"color "+this.options.cssPrefix+t,attributes:{id:e}});var i=mo("#"+e);if(i.length){bi(i.removeAttr("id").get(0));var n;do n=mo("#"+e),n.removeAttr("id");while(n.length)}}}.bind(this))},Fn.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.changeColor(mo(t.currentTarget).data("color"))}.bind(this))},Fn.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Fn.prototype.menuItemClick=function(t){Ln.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeColor(mo(t.currentTarget).data("color"),!0)}.bind(this))},Fn.prototype.getMenuItems=function(){return this.raptor.getTemplate("color-menu-basic.menu",this.options)},To.registerUi(new Fn),jn.prototype=Object.create(Tn.prototype),jn.prototype.init=function(){var t;this.options.persist&&(t=this.raptor.persist("docked")),"undefined"==typeof t&&(t=this.options.docked),"undefined"==typeof t&&(t=!1),t&&(this.raptor.bind("toolbarReady",function(){t&&this.toggleState()}.bind(this)),this.raptor.bind("toolbarHide",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.addClass(this.options.baseClass+"-hidden"),this.dockState.spacer.removeClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarShow",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.removeClass(this.options.baseClass+"-hidden"),this.dockState.spacer.addClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarDestroy",function(){this.dockState&&this.dockState.spacer&&this.dockState.spacer.remove()}.bind(this)))},jn.prototype.toggleState=function(){return this.options.dockToElement?this.toggleDockToElement():this.toggleDockToScreen()},jn.prototype.toggleDockToElement=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?this.undockFromElement():(this.undockFromScreen(),this.dockToElement()):this.dockToElement()},jn.prototype.dockToElement=function(){var t=this.raptor.getElement(),e=this.raptor.getLayout("toolbar").getElement();this.marker=mo("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(e),this.raptor.getLayout("toolbar").getElement().addClass(this.options.baseClass+"-docked-to-element"),this.dockState=J(this.raptor.getLayout("toolbar").getElement(),t,{position:this.options.position,spacer:!1,wrapperClass:this.options.baseClass+"-inline-wrapper"}),this.activateButton(this.raptor.getPlugin("dockToElement"))},jn.prototype.undockFromElement=function(){this.marker.replaceWith($(this.dockState)),this.dockState=null,this.raptor.getLayout("toolbar").getElement().removeClass(this.options.baseClass+"-docked-to-element"),this.deactivateButton(this.raptor.getPlugin("dockToElement"))},jn.prototype.toggleDockToScreen=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?(this.undockFromElement(),this.dockToScreen()):this.undockFromScreen():this.dockToScreen()},jn.prototype.dockToScreen=function(){if(!this.dockState){var t=this.raptor.getLayout("toolbar");if(t.isReady()){this.raptor.persist("docked",!0);var e=t.getElement();this.marker=mo("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(e),e.addClass(this.options.baseClass+"-docked"),t.disableDragging(),this.dockState=_(e,{position:this.options.position,spacer:this.options.spacer,under:this.options.under}),t.isVisible()||(this.dockState.spacer.removeClass(this.options.baseClass+"-visible"),this.dockState.spacer.addClass(this.options.baseClass+"-hidden")),this.activateButton(this.raptor.getPlugin("dockToScreen"))}}},jn.prototype.undockFromScreen=function(){if(this.dockState){this.raptor.persist("docked",!1);var t=this.raptor.getLayout("toolbar"),e=Q(this.dockState);this.marker.replaceWith(e),t.enableDragging(),t.constrainPosition(),this.dockState=null,e.removeClass(this.options.baseClass+"-docked"),this.deactivateButton(this.raptor.getPlugin("dockToScreen"))}},jn.prototype.deactivateButton=function(t){"undefined"!=typeof t&&"undefined"!=typeof t.button&&R(t.button)},jn.prototype.activateButton=function(t){"undefined"!=typeof t&&"undefined"!=typeof t.button&&D(t.button)},To.registerPlugin(new jn),To.registerUi(new Dn({name:"dockToScreen",action:function(){this.raptor.unify(function(t){t.plugins.dock.toggleDockToScreen()})}})),To.registerUi(new Dn({name:"dockToElement",action:function(){this.raptor.unify(function(t){t.plugins.dock.toggleDockToElement()})}})),To.registerUi(new In({name:"embed",state:null,dialogOptions:{width:600,height:400},applyAction:function(t){this.raptor.actionApply(function(){mi(t.find("textarea").val())})},getDialogTemplate:function(){var t=mo("<div>").html(this.raptor.getTemplate("embed.dialog",this.options));t.find("textarea").change(function(e){t.find("."+this.options.baseClass+"-preview").html(mo(e.target).val())}.bind(this));var e=t.find("."+this.options.baseClass+"-panel-tabs");return e.find("li").click(function(){e.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),mo(this).addClass("ui-state-active").addClass("ui-tabs-selected"),e.children("div").hide().eq(mo(this).index()).show()}),t}})),To.registerUi(new Nn({name:"floatLeft",applyToElement:function(t){t.removeClass(this.options.cssPrefix+"float-right"),t.toggleClass(this.options.cssPrefix+"float-left"),W(t,["class"])},getElement:function(t){var e=mo(t.commonAncestorContainer).find("img");return e.length?e:null}})),To.registerUi(new Nn({name:"floatNone",applyToElement:function(t){t.removeClass(this.options.cssPrefix+"float-right"),t.removeClass(this.options.cssPrefix+"float-left"),W(t,["class"])},getElement:function(t){var e=mo(t.commonAncestorContainer).find("img");return e.length?e:null}})),To.registerUi(new Nn({name:"floatRight",applyToElement:function(t){t.removeClass(this.options.cssPrefix+"float-left"),t.toggleClass(this.options.cssPrefix+"float-right"),W(t,["class"])},getElement:function(t){var e=mo(t.commonAncestorContainer).find("img");return e.length?e:null}})),To.registerUi(new Rn({name:"guides",action:function(){this.raptor.getElement().toggleClass(this.getClassName()),this.updateButtonState()},updateButtonState:function(){this.raptor.getElement().hasClass(this.getClassName())?D(this.button):R(this.button)},init:function(){return this.raptor.bind("cancel",this.removeClass.bind(this)),this.raptor.bind("saved",this.removeClass.bind(this)),Rn.prototype.init.call(this)},removeClass:function(){this.raptor.getElement().removeClass(this.getClassName())},getClassName:function(){return this.options.baseClass+"-visible"},mouseEnter:function(){Rn.prototype.mouseEnter.call(this),this.updateButtonState()},mouseLeave:function(){Rn.prototype.mouseLeave.call(this),this.updateButtonState()}})),To.registerUi(new Dn({name:"historyRedo",hotkey:["ctrl+y","ctrl+shift+z"],action:function(){this.raptor.historyForward()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),Dn.prototype.init.apply(this,arguments),x(this.button),this.button},historyChange:function(){this.raptor.present<this.raptor.history.length-1?E(this.button):x(this.button)}})),To.registerUi(new Dn({name:"historyUndo",hotkey:"ctrl+z",action:function(){this.raptor.historyBack()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),Dn.prototype.init.apply(this,arguments),x(this.button),this.button},historyChange:function(){0===this.raptor.present?x(this.button):E(this.button)}})),To.registerUi(new Rn({name:"hrCreate",action:function(){mi("<hr/>")}})),To.registerUi(new In({name:"imageResize",proportional:!0,image:null,dialogOptions:{width:450},action:function(){var t=this.getDialog();this.image=s(this.layout.target),this.originalWidth=this.layout.target.width,this.originalHeight=this.layout.target.height,t.find("[name=width]").val(this.layout.target.width),t.find("[name=height]").val(this.layout.target.height),this.openDialog()},applyAction:function(){var t=this.getDialog(),e=t.find("[name=width]").val(),i=t.find("[name=height]").val();this.raptor.actionApply(function(){mo("#"+this.image).css({width:e,height:i}).attr("width",e).attr("height",i),vi(mo("#"+this.image)[0])}.bind(this))},getDialogTemplate:function(){var t=mo("<div>").html(this.raptor.getTemplate("image-resize.dialog",this.options)),e=this;t.find("."+this.options.baseClass+"-lock-proportions").hover(function(){mo(this).addClass("ui-state-hover")},function(){mo(this).removeClass("ui-state-hover")}).click(function(){So[e.name].instance.proportional=!So[e.name].instance.proportional,mo(this).find(".ui-icon").toggleClass("ui-icon-locked",e.proportional).toggleClass("ui-icon-unlocked",!e.proportional)});var i=t.find("[name=width]"),n=t.find("[name=height]");return i.on("input.raptor",function(){var t=parseInt(mo(this).val());isNaN(t)||So[e.name].instance.proportional&&n.val(Math.round(Math.abs(So[e.name].instance.originalHeight/So[e.name].instance.originalWidth*t)))}),n.on("input.raptor",function(){var t=parseInt(mo(this).val());isNaN(t)||So[e.name].instance.proportional&&i.val(Math.round(Math.abs(So[e.name].instance.originalWidth/So[e.name].instance.originalHeight*t)))}),t}})),To.registerUi(new Dn({name:"imageSwap",chooser:null,click:function(){vi(this.layout.target),this.raptor.getPlugin(this.options.chooser).action(this.layout.target)}})),To.registerUi(new In({name:"insertFile",state:!1,imageTypes:["jpeg","jpg","png","gif"],options:{customAction:!1},action:function(t){return this.options.customAction&&this.options.customAction.call(this,t)!==!1?void 0:("undefined"!=typeof t?(this.getDialog().find("[name=location]").val(t.getAttribute("src")||t.getAttribute("href")),this.getDialog().find("[name=name]").val(t.innerHTML)):(this.getDialog().find("[name=location]").val(""),this.getDialog().find("[name=name]").val("")),this.openDialog())},applyAction:function(){var t=this.getDialog(),e=t.find("[name=location]").val(),i=t.find("[name=name]").val();this.raptor.actionApply(function(){this.insertFiles([{location:e,name:i}])}.bind(this))},getDialogTemplate:function(){return mo(this.raptor.getTemplate("insert-file.dialog"))},getFileType:function(t){if("undefined"!=typeof t.extension)return t.extension.toLowerCase();var e=t.location.split(".");return e.length>0?e.pop().toLowerCase():"unknown"},isImage:function(t){return-1!==mo.inArray(this.getFileType(t),this.imageTypes)},insertFiles:function(t){this.raptor.resume(),t.length&&this.raptor.actionApply(function(){1===t.length?this.isImage(t[0])&&mo(ki()).is("img")||Ai()?this.replaceFiles(t):this.linkFiles(t):this.linkFiles(t)}.bind(this))},linkFiles:function(t){qi("a",this.raptor.getElement()),Vi();var e=rangy.createApplier({tag:"a",attributes:{href:t[0].location.replace(/([^:])\/\//g,"$1/"),title:t[0].name,"class":this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(t[0])}});e.applyToSelection()},replaceFiles:function(t){for(var e=[],i=0;i<t.length;i++)e.push(this.prepareElement(t[i]));mi(e.join(", "))},prepareElement:function(t,e){return this.isImage(t)?this.prepareImage(t,this.options.cssPrefix+this.getFileType(t),e):this.prepareAnchor(t,this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(t),e)},prepareImage:function(t,e,i){return mo("<div/>").html(mo("<img/>").attr({src:t.location.replace(/([^:])\/\//g,"$1/"),title:i||t.name,"class":e})).html()},prepareAnchor:function(t,e,i){return mo("<div/>").html(mo("<a/>").attr({href:t.location.replace(/([^:])\/\//g,"$1/"),title:t.name,"class":e}).html(i||t.name)).html()}}));
var xo,Do,Ro,Po;To.registerUi(new On({name:"linkCreate",dialogOptions:{width:850},applyAction:function(){this.raptor.actionApply(function(){Gi(),qi("a",this.raptor.getElement()),Vi();var t=rangy.createApplier({tag:"a",attributes:Po});Po!==!1&&""!==mo.trim(Po.href)&&(t.applyToSelection(),q(this.raptor.getElement(),["a"]))}.bind(this))},openDialog:function(){var t=Ei();if(t.is("a"))for(var e=0,i=Do.length;i>e;e++){var n=Do[e].updateInputs(t,Ro.children("div:eq("+e+")"));n&&xo.find(":radio:eq("+e+")").trigger("click")}On.prototype.openDialog.call(this)},validateDialog:function(){var t=xo.find(":radio:checked").val();return Po=Do[t].getAttributes(Ro.children("div:eq("+t+")")),Po!==!1},selectionToggle:function(){var t=Ei();return t?t.closest("a").length?!0:!1:!1},getDialogTemplate:function(){var t=mo(this.raptor.getTemplate("link.dialog",this.options));xo=t.find("[data-menu]"),Ro=t.find("[data-content]"),Do=[new qn(this.raptor),new Gn(this.raptor),new zn(this.raptor),new Wn(this.raptor)];for(var e=0,i=Do.length;i>e;e++)mo(this.raptor.getTemplate("link.label",Do[e])).click(function(){Ro.children("div").hide(),Ro.children("div:eq("+mo(this).index()+")").show()}).find(":radio").val(e).end().appendTo(xo),mo("<div>").append(Do[e].getContent()).hide().appendTo(Ro);return xo.find(":radio:first").prop("checked",!0),Ro.children("div:first").show(),t}})),To.registerUi(new An({name:"linkRemove",disable:!0,action:function(){this.raptor.actionApply(function(){var t=rangy.createApplier({tag:"a"});Gi(),this.raptor.selectionConstrain(),t.undoToSelection(),q(this.raptor.getElement(),["a"])}.bind(this))},selectionToggle:function(){var t=Ei();return t?t.closest("a").length?!0:!1:!1}})),zn.prototype=Object.create(Gn.prototype),zn.prototype.getContent=function(){return this.raptor.getTemplate("link.document",this.raptor.options)},Wn.prototype.getContent=function(){return this.raptor.getTemplate("link.email",this.raptor.options)},Wn.prototype.getAttributes=function(t){var e=t.find("[name=email]").val(),i=t.find("[name=subject]").val();return mo.trim(i)&&(i="?Subject="+encodeURIComponent(i)),""===mo.trim(e)?!1:{href:"mailto:"+e+i}},Wn.prototype.updateInputs=function(t,e){var i=!1;if(email="",subject="",href=t.attr("href"),0===href.indexOf("mailto:")){var n=href.indexOf("?Subject=");n>0?(email=href.substring(7,n),subject=href.substring(n+9)):(email=href.substring(7),subject=""),i=!0}return e.find("[name=email]").val(email),e.find("[name=subject]").val(subject),i},Gn.prototype.getContent=function(){return this.raptor.getTemplate("link.external",this.raptor.options)},Gn.prototype.getAttributes=function(t){var e=t.find("[name=location]").val(),i=t.find("[name=blank]").is(":checked"),n={href:e};return i&&(n.target="_blank"),"http://"===mo.trim(n.href)?!1:n},Gn.prototype.updateInputs=function(t,e){var i=!1,n=t.attr("href");return 0===n.indexOf("http://")?(e.find("[name=location]").val(n),i=!0):e.find("[name=location]").val("http://"),"_blank"===t.attr("target")?e.find("[name=blank]").prop("checked",!0):e.find("[name=blank]").prop("checked",!1),i},qn.prototype.getContent=function(){return this.raptor.getTemplate("link.internal",{baseClass:this.raptor.options.baseClass,domain:window.location.protocol+"//"+window.location.host})},qn.prototype.getAttributes=function(t){var e=t.find("[name=location]").val(),i=t.find("[name=blank]").is(":checked"),n={href:e};return i&&(n.target="_blank"),n},qn.prototype.updateInputs=function(t,e){var i=t.attr("href");return-1===i.indexOf("http://")&&-1===i.indexOf("mailto:")?e.find("[name=location]").val(i):e.find("[name=location]").val(""),"_blank"===t.attr("target")?e.find("[name=blank]").prop("checked",!0):e.find("[name=blank]").prop("checked",!1),!1},To.registerUi(new Dn({name:"listOrdered",action:function(){document.execCommand("insertorderedlist")}})),To.registerUi(new Dn({name:"listUnordered",action:function(){document.execCommand("insertunorderedlist")}})),To.registerUi(new Dn({name:"logo",action:function(){window.open("http://www.raptor-editor.com/about/VERSION","_blank")}})),Vn.prototype=Object.create(Tn.prototype),Vn.prototype.init=function(){this.raptor.getElement().on("keypress.raptor",this.preventReturn.bind(this)),this.raptor.getElement().on("drop.raptor",this.preventDrop.bind(this))},Vn.prototype.preventReturn=function(t){return this.options.enabled&&13===t.which?!1:void 0},Vn.prototype.preventDrop=function(){return this.options.enabled},To.registerPlugin(new Vn),Xn.prototype=Object.create(Tn.prototype),Xn.prototype.init=function(){this.raptor.registerHotkey("return",this.returnPressed.bind(this)),this.raptor.registerHotkey("shift+return",this.shiftReturnPressed.bind(this))},Xn.prototype.returnPressedList=function(t){var e=t.closest("li");if(!e.length)return!1;var i=e.closest("ul, ol"),n=i.get(0).tagName.toLowerCase(),o=!1;if(de(e)){var a=e.next();a.length&&a.is("li")?(o=Le(n,"li",this.raptor.getElement(),"<p>&nbsp;</p>"),o&&bi(o.get(0))):(e.remove(),bi(mo("<p>&nbsp;</p>").insertAfter(i).get(0)))}else o=Ue(n,"li",this.raptor.getElement()),o&&wi(o.get(0));return!0},Xn.prototype.returnPressed=function(){var t=Ei();return this.returnPressedList(t)?!0:!1},Xn.prototype.shiftReturnPressedList=function(t){if(t.closest("li").length){var e=t.closest("ul, ol").get(0).tagName.toLowerCase(),i=Le(e,"li",this.raptor.getElement(),"<p>&nbsp;</p>");return i&&bi(i.get(0)),!0}return!1},Xn.prototype.shiftReturnPressed=function(){var t=Ei();return this.shiftReturnPressedList(t)?!0:!1},To.registerPlugin(new Xn);var Ao=!1,No=null,Bo=null,Io=null;Kn.prototype=Object.create(Tn.prototype),Kn.prototype.enable=function(){this.raptor.getElement().on("paste.raptor",this.capturePaste.bind(this))},Kn.prototype.capturePaste=function(){return Io?void 0:Ao?!1:(pi(),Ao=!0,mo(".raptorPasteBin").remove(),mo('<div class="raptorPasteBin" contenteditable="true" style="width: 1px; height: 1px; overflow: hidden; position: fixed; top: -1px;" />').appendTo("body"),mo(".raptorPasteBin").focus(),window.setTimeout(this.showPasteDialog.bind(this),0),!0)},Kn.prototype.showPasteDialog=function(){N(this.getDialog(this))},Kn.prototype.pasteContent=function(t){this.raptor.actionApply(function(){var e=be();hi(),t=this.filterAttributes(t),t=this.filterChars(t),mi(mo('<placeholder id="'+e+'">'+t+"</placeholder>")),mo(".raptorPasteBin").remove();var i=mo("#"+e);bi(i.get(0)),pi(),i.contents().unwrap(),hi()}.bind(this))},Kn.prototype.getDialog=function(t){if(Bo=t,!No){No=mo("<div>").html(this.raptor.getTemplate("paste.dialog",this.options));for(var e=0,i=this.options.panels.length;i>e;e++)No.find("."+this.options.baseClass+"-tab-"+this.options.panels[e]).css("display",""),0===e&&No.find("."+this.options.baseClass+"-content-"+this.options.panels[e]).css("display","");No.find("."+this.options.baseClass+"-panel-tabs > div:visible:not(:first)").hide(),A(No,{modal:!0,resizable:!0,autoOpen:!1,width:800,height:500,title:a("pasteDialogTitle"),dialogClass:this.options.baseClass+"-dialog",close:function(){Ao=!1},buttons:[{text:a("pasteDialogOKButton"),click:function(){var t=null,e=No.find("."+this.options.baseClass+"-area:visible");t=e.hasClass(this.options.baseClass+"-plain")||e.hasClass(this.options.baseClass+"-source")?e.val():e.html(),B(No),Bo.pasteContent(t)}.bind(this),icons:{primary:"ui-icon-circle-check"}},{text:a("pasteDialogCancelButton"),click:function(){ui(),mo(".raptorPasteBin").remove(),B(No)},icons:{primary:"ui-icon-circle-close"}}]});var n=No.find("."+this.options.baseClass+"-panel-tabs");n.find("li").click(function(){n.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),mo(this).addClass("ui-state-active").addClass("ui-tabs-selected"),n.children("div").hide().eq(mo(this).index()).show()})}return this.updateAreas(),No},Kn.prototype.filterAttributes=function(t){var e=[{regexp:/(<meta\s*[^>]*\s*>)|(<\s*link\s* href="file:[^>]*\s*>)|(<\/?\s*\w+:[^>]*\s*>)/gi,handler:""},{regexp:/(class="Mso[^"]*")|(<!--(.|\s){1,}?-->)/gi,handler:""},{regexp:/(class="Apple-(style|converted)-[a-z]+\s?[^"]+")/,handle:""},{regexp:/id="internal-source-marker_[^"]+"|dir="[rtl]{3}"/,handle:""},{regexp:/(<p[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/p[^>]*>)|(<p[^>]*>\s*<font[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/\s*font\s*>\s<\/p[^>]*>)/gi,handler:""},{regexp:/(style="[^"]*mso-[^;][^"]*")|(style="margin:\s*[^;"]*;")/gi,handler:""},{regexp:/(?:<style([^>]*)>([\s\S]*?)<\/style>|<link\s+(?=[^>]*rel=['"]?stylesheet)([^>]*?href=(['"])([^>]*?)\4[^>\/]*)\/?>)/gi,handler:""},{regexp:/(<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>)|(<\s*script\b([^<>]|\s)*>?)|(<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>)/gi,handler:""}];return mo.each(e,function(e,i){t=t.replace(i.regexp,i.handler)}),t},Kn.prototype.filterChars=function(t){var e=t;return e=e.replace(/[\u2018|\u2019|\u201A]/g,"'"),e=e.replace(/[\u201C|\u201D|\u201E]/g,'"'),e=e.replace(/\u2026/g,"..."),e=e.replace(/[\u2013|\u2014]/g,"-"),e=e.replace(/\u02C6/g,"^"),e=e.replace(/\u2039/g,"<"),e=e.replace(/\u203A/g,">"),e=e.replace(/[\u02DC|\u00A0]/g," ")},Kn.prototype.stripAttributes=function(t){t=mo("<div/>").html(t);var e=this.options.allowedAttributes;return mo(t.find("*")).each(function(){var t=[];mo.each(this.attributes,function(i,n){-1===mo.inArray(n.nodeName,e)&&t.push(n.nodeName)});for(var i=0;i<t.length;i++)mo(this).attr(t[i],null)}),t.html()},Kn.prototype.stripEmpty=function(t){var e=mo("<div/>").html(t),i=this.options.allowedEmptyTags;return e.find("*").filter(function(){return-1!==mo.inArray(this.tagName.toLowerCase(),i)?!1:mo(this).find(i.join(",")).length?!1:""===mo.trim(mo(this).text())}).remove(),e.html()},Kn.prototype.stripSpans=function(t){var e=mo("<div/>").html(t);return e.find("span").each(function(){this.attributes.length||mo(this).replaceWith(mo(this).html())}),e.html()},Kn.prototype.updateAreas=function(){var t=mo(".raptorPasteBin").html();t=this.filterAttributes(t),t=this.filterChars(t),t=this.stripEmpty(t),t=this.stripAttributes(t),t=this.stripSpans(t),t=Yi(t,this.options.allowedTags);var e=mo("<div/>").html(mo(".raptorPasteBin").html()).text(),i=mo(".raptorPasteBin").html();No.find("."+this.options.baseClass+"-plain").val(mo("<div/>").html(e).text()),No.find("."+this.options.baseClass+"-rich").html(t),No.find("."+this.options.baseClass+"-source").html(i),No.find("."+this.options.baseClass+"-markup").html(t)},mo(document).on("keyup.raptor keydown.raptor",function(t){Io=t.shiftKey}),To.registerPlugin(new Kn),_n.prototype=Object.create(Tn.prototype),_n.prototype.init=function(){this.raptor.bind("enabled",this.enabled.bind(this)),this.raptor.bind("change",this.check.bind(this))},_n.prototype.enabled=function(){this.check(this.raptor.getHtml())},_n.prototype.check=function(t){if(t=t.trim(),!t||"<br>"===t||"<div><br></div>"===t){var e=this.raptor.getNode(),i=document.createElement(this.options.tag);i.innerHTML=this.options.content,e.innerHTML="",e.appendChild(i),this.options.select&&bi(e.childNodes[0]),this.raptor.checkChange()}},To.registerPlugin(new _n),To.registerUi(new Dn({name:"save",action:function(){this.getPlugin()?this.getPlugin().save():O({text:a("saveNotConfigured"),type:"error"})},init:function(){if(null!==this.options.plugin){var t=Dn.prototype.init.apply(this,arguments);return this.raptor.bind("dirty",this.dirty.bind(this)),this.raptor.bind("cleaned",this.clean.bind(this)),this.clean(),t}},getPlugin:function(){return this.raptor.getPlugin(this.options.plugin)},dirty:function(){E(this.button)},clean:function(){x(this.button)}})),Qn.prototype=Object.create(Ln.prototype),Qn.prototype.init=function(){var t=Ln.prototype.init.call(this);return"undefined"!=typeof this.options.snippets&&Object.keys(this.options.snippets).length>0?t:void 0},Qn.prototype.insertSnippet=function(t){mi(this.options.snippets[t])},Qn.prototype.menuItemMouseDown=function(t){this.raptor.actionApply(function(){this.insertSnippet(mo(t.currentTarget).data("name"))}.bind(this))},Qn.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.insertSnippet(mo(t.currentTarget).data("name"))}.bind(this))},Qn.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Qn.prototype.getMenuItems=function(){var t="";for(var e in this.options.snippets)t+=this.raptor.getTemplate("snippet-menu.item",{name:e});return t},To.registerUi(new Qn);var Oo=!1;To.registerUi(new In({name:"specialCharacters",dialogOptions:{width:645},options:{setOrder:["symbols","mathematics","arrows","greekAlphabet"],characterSets:{symbols:{name:a("specialCharactersSymbols"),characters:[["<","&lt;","less than"],[">","&gt;","greater than"],["&","&amp;","ampersand"],['"',"&quot;","quotation mark"],["&nbsp;","non-breaking space: ' '"],["&emsp;","em space: '  '"],["&ensp;","en space: ' '"],["&thinsp;","thin space: ''"],["&mdash;","em dash"],["&ndash;","en dash"],["&minus;","minus"],["-","hyphen"],["&oline;","overbar space"],["&cent;","cent"],["&pound;","pound"],["&euro;","euro"],["&sect;","section"],["&dagger;","dagger"],["&Dagger;","double dagger"],["&lsquo;","left single quotes"],["&rsquo;","right single quotes"],["'","single quotes"],["&#x263a;","smiley face"],["&#x2605;","black star"],["&#x2606;","white star"],["&#x2610;","check box"],["&middot;","middle dot"],["&bull;","bullet"],["&copy;","copyright"],["&reg;","registered"],["&trade;","trade"],["&iquest;","inverted question mark"],["&iexcl;","inverted exclamation mark"],["&Aring;","Angström"],["&hellip;","ellipsis"],["&#x2295;","earth"],["&#x2299;","sun"],["&#x2640;","female"],["&#x2642;","male"],["&clubs;","clubs or shamrock"],["&spades;","spades"],["&hearts;","hearts or valentine"],["&diams;","diamonds"],["&loz;","diamond"]]},mathematics:{name:a("specialCharactersMathematics"),characters:[["&lt;","less than"],["&le;","less than or equal to"],["&gt;","greater than"],["&ge;","greater than or equal to"],["&ne;","not equal"],["&asymp;","approximately equal to"],["&equiv;","identically equal to"],["&cong;","congruent to"],["&prop;","proportional"],["&there4;","therefore"],["&sum;","summation"],["&prod;","product"],["&prime;","prime or minutes"],["&Prime;","double prime or seconds"],["&Delta;","delta"],["&nabla;","del"],["&part;","partial"],["&int;","integral"],["&middot;","middle dot"],["&sdot;","dot operator"],["&bull;","bullet"],["&minus;","minus sign"],["&times;","multipllcation sign"],["&divide;","division sign"],["&frasl;","fraction slash, (ordinary / \\)"],["&plusmn;","plus or minus"],["&deg;","degree sign"],["&lfloor;","floor function"],["&rfloor;","floor function"],["&lceil;","ceiling function"],["&rceil;","ceiling function"],["&lowast;","asterisk operator, (ordinary *)"],["&oplus;","circled plus"],["&otimes;","circled times"],["&ordm;","masculine ordinal"],["&lang;","bra"],["&rang;","ket"],["&infin;","infinity"],["&pi;","pi"],["&frac12;","half"],["&alefsym;","aleph"],["&radic;","radical"],["&ang;","angle"],["&perp;","perpendicular"],["&real;","real"],["&isin;","is an element of"],["&notin;","not an element of"],["&empty;","null set"],["&sub;","subset of"],["&sube;","subset or or equal to"],["&nsub;","not a subset"],["&cap;","intersection"],["&cup;","union"],["&sim;","tilde operator (ordinary ~)"],["&Oslash;","slash O"],["&and;","logical and"],["&Lambda;","lambda (and)"],["&or;","logical or"],["&not;","not sign"],["&sim;","tilde operator (ordinary ~)"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},arrows:{name:a("specialCharactersArrows"),characters:[["&darr;","down arrow"],["&dArr;","down double arrow"],["&uarr;","up arrow"],["&uArr;","up double arrow"],["&crarr;","arriage return arrow"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},greekAlphabet:{name:a("specialCharactersGreekAlphabet"),characters:[["&alpha;","alpha"],["&beta;","beta"],["&gamma;","gamma"],["&delta;","delta"],["&epsilon;","epsilon"],["&zeta;","zeta"],["&eta;","eta"],["&theta;","theta"],["&iota;","iota"],["&kappa;","kappa"],["&lambda;","lambda"],["&mu;","mu"],["&nu;","nu"],["&xi;","xi"],["&omicron;","omicron"],["&pi;","pi"],["&rho;","rho"],["&sigma;","sigma"],["&tau;","tau"],["&upsilon;","upsilon"],["&phi;","phi"],["&chi;","chi"],["&psi;","psi"],["&omega;","omega"],["&Alpha;","alpha"],["&Beta;","beta"],["&Gamma;","gamma"],["&Delta;","delta"],["&Epsilon;","epsilon"],["&Zeta;","zeta"],["&Eta;","eta"],["&Theta;","theta"],["&Iota;","iota"],["&Kappa;","kappa"],["&Lambda;","lambda"],["&Mu;","mu"],["&Nu;","nu"],["&Xi;","xi"],["&Omicron;","omicron"],["&Pi;","pi"],["&Rho;","rho"],["&Sigma;","sigma"],["&Tau;","tau"],["&Upsilon;","upsilon"],["&Phi;","phi"],["&Chi;","chi"],["&Psi;","psi"],["&Omega;","omega"]]}}},applyAction:function(){this.raptor.actionApply(function(){Oo&&mi(Oo),Oo=!1})},getDialogTemplate:function(){for(var t,e,i,n,o=mo(this.raptor.getTemplate("special-characters.dialog")).appendTo("body").hide(),a=0;a<this.options.setOrder.length;a++){t=this.options.setOrder[a],o.find("ul").append(this.raptor.getTemplate("special-characters.tab-li",{baseClass:this.options.baseClass,name:this.options.characterSets[t].name,key:t})),e=mo(this.raptor.getTemplate("special-characters.tab-content",{baseClass:this.options.baseClass,key:t}));for(var s=[],r=0;r<this.options.characterSets[t].characters.length;r++)i=this.options.characterSets[t].characters[r],n=this.raptor.getTemplate("special-characters.tab-button",{htmlEntity:i[0],description:i[1],setKey:t,charactersIndex:r}),s.push(n);e.append(s.join("")),o.find("ul").after(e)}o.show();var l=this;return o.find("button").each(function(){w(mo(this))}).click(function(){var t=mo(this).attr("data-setKey"),e=mo(this).attr("data-charactersIndex");Oo=l.options.characterSets[t].characters[e][0],l.getOkButton(l.name).click.call(this)}),I(o),o},getCancelButton:function(){}})),Jn.prototype=Object.create(Nn.prototype),Jn.prototype.getElement=function(t){var e=mo(t.commonAncestorContainer.parentNode).closest("td, th");return e.length?e[0]:null},$n.prototype=Object.create(Hn.prototype),$n.prototype.createTable=function(t){this.raptor.actionApply(function(){mi(te(mo(an(t.target.cellIndex+1,t.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},$n.prototype.highlight=function(t){var e=un(this.menuTable.get(0),{x:0,y:0},{x:t.target.cellIndex,y:t.target.parentNode.rowIndex});this.highlightRemove(t),mo(e).addClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreview(function(){mi(te(mo(an(t.target.cellIndex+1,t.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},$n.prototype.highlightRemove=function(){this.menuTable.find("."+this.options.baseClass+"-menu-hover").removeClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreviewRestore()},$n.prototype.getMenu=function(){return this.menu||(this.menuContent=this.raptor.getTemplate("table.create-menu",this.options),Hn.prototype.getMenu.call(this).on("click","td",this.createTable.bind(this)).on("mouseenter","td",this.highlight.bind(this)).mouseleave(this.highlightRemove.bind(this)),this.menuTable=this.menu.find("table:eq(0)")),this.menu},To.registerUi(new $n),To.registerUi(new Jn({name:"tableDeleteColumn",applyToElement:function(t){var e,i=pn(t),n=t.parentNode.parentNode.parentNode;return rn(t.parentNode.parentNode.parentNode,i.x),bn(n)?(n.parentNode.removeChild(n),void 0):(e=hn(n,i),!e&&i.x>0&&(e=hn(n,{x:i.x-1,y:i.y})),bi(e),void 0)}})),To.registerUi(new Jn({name:"tableDeleteRow",applyToElement:function(t){var e,i=pn(t),n=t.parentNode.parentNode.parentNode;return cn(t.parentNode.parentNode.parentNode,i.y),bn(n)?(n.parentNode.removeChild(n),void 0):(e=hn(n,i),!e&&i.y>0&&(e=hn(n,{x:i.x,y:i.y-1})),bi(e),void 0)}})),To.registerUi(new Jn({name:"tableInsertColumn",applyToElement:function(t){sn(t.parentNode.parentNode.parentNode,pn(t).x+1,{placeHolder:"&nbsp;"})}})),To.registerUi(new Jn({name:"tableInsertRow",applyToElement:function(t){ln(t.parentNode.parentNode.parentNode,pn(t).y+1,{placeHolder:"&nbsp;"})}})),To.registerUi(new Dn({name:"tableMergeCells",action:function(){}})),To.registerUi(new Dn({name:"tableSplitCells",action:function(){}}));var Mo=!1,Ho=null;Yn.prototype=Object.create(Tn.prototype),Yn.prototype.init=function(){this.raptor.bind("selectionCustomise",this.selectionCustomise.bind(this)),this.raptor.registerHotkey("tab",this.tabToNextCell.bind(this)),this.raptor.registerHotkey("shift+tab",this.tabToPrevCell.bind(this)),this.raptor.getElement().on("mousedown","tbody td",this.cellMouseDown.bind(this)).on("mouseover","tbody td",this.cellMouseOver.bind(this)).mouseup(this.cellMouseUp.bind(this))},Yn.prototype.selectionCustomise=function(){var t,e=[];return mo("."+this.options.baseClass+"-cell-selected").each(function(){t=rangy.createRange(),t.selectNodeContents(this),e.push(t)}),e},Yn.prototype.cellMouseDown=function(t){this.raptor.isEditing()&&(Ho=pn(t.target),null!==Ho&&(Mo=!0,mo(t.target).closest("table").addClass(this.options.baseClass+"-selected")))},Yn.prototype.cellMouseUp=function(t){Mo=!1;var e=mo(t.target).closest("td"),i=!1;if(e.length>0&&null!==Ho){var n=pn(e.get(0));(null===n||n.x==Ho.x&&n.y==Ho.y)&&(i=!0)}else i=!0;i&&(mo("."+this.options.baseClass+"-selected").removeClass(this.options.baseClass+"-selected"),mo("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"))},Yn.prototype.cellMouseOver=function(t){if(Mo){var e=un(mo(t.target).closest("table").get(0),Ho,pn(t.target));mo("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"),mo(e).addClass(this.options.baseClass+"-cell-selected"),rangy.getSelection().removeAllRanges()}},Yn.prototype.tabToNextCell=function(){var t=rangy.getSelection().getRangeAt(0),e=Ye(t),i=mo(e).closest("td");if(0===i.length)return!1;var n=i.next("td");0===n.length&&(n=i.closest("tr").next("tr").find("td:first"),0===n.length&&(n=i.closest("tbody").find("td:first"))),Xe(t,n),rangy.getSelection().setSingleRange(t)},Yn.prototype.tabToPrevCell=function(){var t=rangy.getSelection().getRangeAt(0),e=Ye(t),i=mo(e).closest("td");if(0===i.length)return!1;var n=i.prev("td");0===n.length&&(n=i.closest("tr").prev("tr").find("td:last"),0===n.length&&(n=i.closest("tbody").find("td:last"))),Xe(t,n),rangy.getSelection().setSingleRange(t)},To.registerPlugin(new Yn),Zn.prototype=Object.create(Ln.prototype),Zn.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),Ln.prototype.init.apply(this,arguments)},Zn.prototype.changeTag=function(t){if("undefined"!=typeof t&&"na"!==t){var e=Ei(),i=this.raptor.getElement();if(e&&!e.is(i)){var n=e.closest("td, li, #"+i.attr("id"));0!==n.length&&(i=n)}Ki(t,["h1","h2","h3","h4","h5","h6","p","div","pre","address"],i)}},Zn.prototype.menuItemClick=function(t){Ln.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeTag(mo(t.currentTarget).data("value"))}.bind(this))},Zn.prototype.menuItemMouseEnter=function(t){this.raptor.actionPreview(function(){this.changeTag(mo(t.currentTarget).data("value"))}.bind(this))},Zn.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Zn.prototype.updateButton=function(){var t=Si()[0],e=this.getButton().getButton();if(t){var i=t.tagName.toLowerCase(),n=this.getMenu().find("[data-value="+i+"]");n.length?T(e,n.html()):T(e,a("tagMenuTagNA"))}},Zn.prototype.getMenuItems=function(){return this.raptor.getTemplate("tag-menu.menu",this.options)},To.registerUi(new Zn),to.prototype=Object.create(An.prototype),to.prototype.action=function(){Fi([this.getClass()],[this.options.cssPrefix+"center",this.options.cssPrefix+"left",this.options.cssPrefix+"right",this.options.cssPrefix+"justify"],this.raptor.getElement(),"span"),this.selectionChange()},to.prototype.selectionToggle=function(){return rangy.getSelection().getAllRanges().length>0&&_i("."+this.getClass(),this.raptor.getElement())},To.registerUi(new to({name:"alignCenter",getClass:function(){return this.options.cssPrefix+"center"}})),To.registerUi(new to({name:"alignJustify",getClass:function(){return this.options.cssPrefix+"justify"}})),To.registerUi(new to({name:"alignLeft",getClass:function(){return this.options.cssPrefix+"left"}})),To.registerUi(new to({name:"alignRight",getClass:function(){return this.options.cssPrefix+"right"}})),To.registerUi(new Bn({name:"textBold",hotkey:"ctrl+b",tag:"strong",classes:["bold"]})),To.registerUi(new Bn({name:"textItalic",hotkey:"ctrl+i",tag:"em",classes:["italic"]})),To.registerUi(new Bn({name:"textStrike",tag:"del",classes:["strike"]})),To.registerUi(new Rn({name:"textSizeDecrease",action:function(){Gi(),this.raptor.selectionConstrain(),Wi("small",this.options.cssPrefix+"small","big",this.options.cssPrefix+"big"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),To.registerUi(new Rn({name:"textSizeIncrease",action:function(){Gi(),this.raptor.selectionConstrain(),Wi("big",this.options.cssPrefix+"big","small",this.options.cssPrefix+"small"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),To.registerUi(new Bn({name:"textUnderline",hotkey:"ctrl+u",tag:"u",classes:["underline"]})),To.registerUi(new Bn({name:"textSub",tag:"sub",classes:["sub"]})),To.registerUi(new Bn({name:"textSuper",tag:"sup",classes:["sup"]})),eo.prototype=Object.create(Tn.prototype),eo.prototype.init=function(){this.raptor.bind("layoutReady",function(t){mo(t).on("mouseover","[title]",function(){mo(this).attr("data-title",mo(this).attr("title")).removeAttr("title")})})},To.registerPlugin(new eo);var Lo=0,Uo=null;io.prototype=Object.create(Tn.prototype),io.prototype.enable=function(){this.raptor.bind("dirty",this.show.bind(this)),this.raptor.bind("cleaned",this.hide.bind(this))},io.prototype.show=function(){Lo++,Z(this.getElement()),this.getElement().addClass(this.options.baseClass+"-visible")},io.prototype.hide=function(){0===--Lo&&this.getElement().removeClass(this.options.baseClass+"-visible")},io.prototype.getElement=function(){if(!Uo){var t="raptor-plugin-unsaved-edit-warning-dirty";Uo=mo(this.raptor.getTemplate("unsaved-edit-warning.warning",this.options)).mouseenter(function(){To.eachInstance(function(e){e.isDirty()&&e.getElement().addClass(t)})}).mouseleave(function(){mo("."+t).removeClass(t)}).appendTo("body")}return Uo},To.registerPlugin(new io),To.registerUi(new In({name:"viewSource",dialogOptions:{width:600,height:400},applyAction:function(t){var e=t.find("textarea").val();this.raptor.actionApply(function(){this.raptor.setHtml(e),wi(this.raptor.getElement().first()),this.raptor.checkSelectionChange()}.bind(this))},openDialog:function(){var t=this.getDialog().find("textarea");t.val(this.raptor.getHtml()),In.prototype.openDialog.call(this),t.select()},getDialogTemplate:function(){return mo("<div>").html(this.raptor.getTemplate("view-source.dialog",this.options))}}))}();